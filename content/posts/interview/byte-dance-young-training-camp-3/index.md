---
title: "ã€ç¬¬ä¸‰å±Šå­—èŠ‚è·³åŠ¨é’è®­è¥ï½œåˆ·é¢˜æ‰“å¡ã€‘"
date: 2022-04-19T19:18:38+08:00
draft: false
slug: 537fd5d3
tags: ["é¢è¯•","Go"]
categories: ["é¢è¯•"]
featured: false 
comment: false 
toc: true 
diagram: true 
series: [  ] 
pinned: false
weight: 100
---

ã€ç¬¬ä¸‰å±Šå­—èŠ‚è·³åŠ¨é’è®­è¥ï½œåˆ·é¢˜æ‰“å¡ã€‘è®°å½•

<!--more-->

## day-one

### ã€å¤šé€‰ã€‘Golang é€šè¿‡`plugin.(*Plugin).Lookup`å‡½æ•°å¯ä»¥æŸ¥æ‰¾åˆ°æ’ä»¶é‡Œé¢å®šä¹‰çš„å“ªäº›ä¸œè¥¿ï¼Ÿ

A. å˜é‡				B. å‡½æ•°
C. ç±»å‹				D. åŒ…

#### è‡ªå·±ç­”æ¡ˆ

ç­”æ¡ˆ: ab æ¥æº`src/plugin/plugin.go:35`

```go
 // A symbol is any exported variable or function.
 func (p *Plugin) Lookup(symName string) (Symbol, error) {
    return lookup(p, symName)
 }
```

#### å®˜æ–¹è§£æ

`a`å’Œ`b`éƒ½æ˜¯èƒ½è¢«èµ‹å€¼ç»™`interface{}`ç±»å‹çš„å˜é‡ï¼Œä½†æ˜¯`c`å’Œ`d`ä¸èƒ½ã€‚å› æ­¤`Lookup`æ–¹æ³•è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª`interface{}`ç±»å‹ï¼ˆ`Symbol`ç±»å‹ï¼‰çš„å˜é‡ï¼Œå› æ­¤`c`å’Œ`d`ä¸èƒ½é€šè¿‡`Lookup`è¿”å›ã€‚

[Goè¿›é˜¶25:Goæ’ä»¶pluginæ•™ç¨‹ | ğŸ¶â¤ï¸ğŸ¦€ (mojotv.cn)](https://link.juejin.cn/?target=https%3A%2F%2Fmojotv.cn%2Fgo%2Fgolang-plugin-tutorial)è¿™ç¯‡æ–‡ç« ä»‹ç»äº†pluginã€‚

### å‡å¦‚åœ¨æŠ–éŸ³ä¸­å‘å¸ƒè§†é¢‘æ—¶ï¼Œå¯ä»¥é€‰æ‹©å¸¦ä¸Šä½ç½®ä¿¡æ¯ï¼Œè¯·è®¾è®¡ä¸€ç§æ•°æ®ç»“æ„æˆ–æ–¹æ¡ˆï¼Œç”¨äºå­˜å‚¨æ£€ç´¢ä½ç½®ä¿¡æ¯ï¼ˆç®€åŒ–ä¸ºå¹³é¢åæ ‡ x, yï¼‰ï¼Œä»¥å®ç°æœç´¢é™„è¿‘è§†é¢‘çš„åŠŸèƒ½ï¼ˆå¦‚é™„è¿‘ 3kmï¼‰

#### è‡ªå·±ç­”æ¡ˆ

ä½¿ç”¨äº†GeohashåŸç†ã€‚é¡ºä¾¿äº†è§£ä¸€ä¸‹Geohashçš„åŸç†ã€‚

å¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹åé¢çš„å‚è€ƒæ–‡ç« ï¼Œä»¥ä¸‹å†…å®¹éƒ½æ˜¯ä»å‚è€ƒæ–‡ç« ä¸­æ‘˜å½•å‡ºæ¥ï¼Œæ–¹ä¾¿ç†è§£ç”¨çš„ã€‚

#### ä»‹ç»

é¦–å…ˆï¼ŒGeoHashç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºXå’ŒYä¸¤ä¸ªåæ ‡ã€‚æŸäº›æƒ…å†µä¸‹æ— æ³•åœ¨ä¸¤åˆ—ä¸ŠåŒæ—¶åº”ç”¨ç´¢å¼•ï¼Œåˆ©ç”¨GeoHashã€‚åªéœ€è¦åœ¨ä¸€åˆ—ä¸Šåº”ç”¨ç´¢å¼•å³å¯ã€‚

GeoHashæœ¬è´¨ä¸Šæ˜¯ç©ºé—´ç´¢å¼•çš„ä¸€ç§æ–¹å¼ï¼Œå…¶åŸºæœ¬åŸç†æ˜¯å°†åœ°çƒç†è§£ä¸ºä¸€ä¸ªäºŒç»´å¹³é¢ï¼Œå°†å¹³é¢é€’å½’åˆ†è§£æˆæ›´å°çš„å­å—ï¼Œæ¯ä¸ªå­å—åœ¨ä¸€å®šç»çº¬åº¦èŒƒå›´å†…æ‹¥æœ‰ç›¸åŒçš„ç¼–ç ã€‚ä»¥GeoHashæ–¹å¼å»ºç«‹ç©ºé—´ç´¢å¼•ï¼Œå¯ä»¥æé«˜å¯¹ç©ºé—´poi([POIæ•°æ®ä»‹ç» - çŸ¥ä¹ (zhihu.com)](https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F364102315))æ•°æ®è¿›è¡Œç»çº¬åº¦æ£€ç´¢çš„æ•ˆç‡ã€‚

ç»åº¦èŒƒå›´æ˜¯ä¸œç»180åˆ°è¥¿ç»180ï¼Œçº¬åº¦èŒƒå›´æ˜¯å—çº¬90åˆ°åŒ—çº¬90ï¼Œæˆ‘ä»¬è®¾å®šè¥¿ç»ä¸ºè´Ÿï¼Œå—çº¬ä¸ºè´Ÿï¼Œæ‰€ä»¥åœ°çƒä¸Šçš„ç»åº¦èŒƒå›´å°±æ˜¯[-180ï¼Œ 180]ï¼Œçº¬åº¦èŒƒå›´å°±æ˜¯[-90ï¼Œ90]ã€‚å¦‚æœä»¥æœ¬åˆå­åˆçº¿ã€èµ¤é“ä¸ºç•Œï¼Œåœ°çƒå¯ä»¥åˆ†æˆ4ä¸ªéƒ¨åˆ†ã€‚

å¦‚æœçº¬åº¦èŒƒå›´[-90Â°, 0Â°)ç”¨äºŒè¿›åˆ¶0ä»£è¡¨ï¼Œï¼ˆ0Â°, 90Â°]ç”¨äºŒè¿›åˆ¶1ä»£è¡¨ï¼Œç»åº¦èŒƒå›´[-180Â°, 0Â°)ç”¨äºŒè¿›åˆ¶0ä»£è¡¨ï¼Œï¼ˆ0Â°, 180Â°]ç”¨äºŒè¿›åˆ¶1ä»£è¡¨ï¼Œé‚£ä¹ˆåœ°çƒå¯ä»¥åˆ†æˆå¦‚ä¸‹4ä¸ªéƒ¨åˆ†

![image-20220408145056064.png](index/811302988b9a4ab988e500196922ca08tplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp)

å¦‚æœåœ¨å°å—èŒƒå›´å†…é€’å½’å¯¹åŠåˆ’åˆ†å‘¢ï¼Ÿ

![image-20220408145141283.png](index/ef35f95a37794b78b24c85535260414btplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp)

å¯ä»¥çœ‹åˆ°ï¼Œåˆ’åˆ†çš„åŒºåŸŸæ›´å¤šäº†ï¼Œä¹Ÿæ›´ç²¾ç¡®äº†ã€‚geohashç®—æ³•å°±æ˜¯åŸºäºè¿™ç§æ€æƒ³ï¼Œåˆ’åˆ†çš„æ¬¡æ•°æ›´å¤šï¼ŒåŒºåŸŸæ›´å¤šï¼ŒåŒºåŸŸé¢ç§¯æ›´å°äº†ã€‚é€šè¿‡å°†ç»çº¬åº¦ç¼–ç ï¼Œç»™åœ°ç†ä½ç½®åˆ†åŒºã€‚

#### å®ç°

Geohashç®—æ³•ä¸€å…±æœ‰ä¸‰æ­¥ã€‚

##### é¦–å…ˆå°†åæ ‡å˜æˆäºŒè¿›åˆ¶

è¿™é‡Œä¸ºäº†ç®€åŒ–æ–‡ç« ä¸­çš„ç»çº¬åº¦çš„æè¿°ï¼Œæ”¹ä¸ºå¹³é¢ç›´è§’åæ ‡ç³»çš„åæ ‡ä¸ºæè¿°ã€‚æ­¤æ—¶xçš„èŒƒå›´æ˜¯ï¼ˆ-90ï¼Œ90ï¼‰ï¼Œyçš„èŒƒå›´æ˜¯ï¼ˆ-180ï¼Œ180ï¼‰

æ¯”å¦‚è¿™æ ·ä¸€ä¸ªç‚¹ **ï¼ˆ39.923201, 116.390705**ï¼‰ã€‚xçš„èŒƒå›´ï¼ˆ-90ï¼Œ90ï¼‰ï¼Œå…¶ä¸­é—´å€¼ä¸º0ã€‚å¯¹äºçº¬åº¦39.923201ï¼Œåœ¨åŒºé—´ï¼ˆ0ï¼Œ90ï¼‰ä¸­ï¼Œå› æ­¤å¾—åˆ°ä¸€ä¸ª1ï¼›ï¼ˆ0ï¼Œ90ï¼‰åŒºé—´çš„ä¸­é—´å€¼ä¸º45åº¦ï¼Œçº¬åº¦39.923201å°äº45ï¼Œå› æ­¤å¾—åˆ°ä¸€ä¸ª0ï¼Œä¾æ¬¡è®¡ç®—ä¸‹å»ï¼Œå³å¯å¾—åˆ°åæ ‡xçš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå¦‚ä¸‹è¡¨ï¼š

| x         | 0åŒºé—´         | 1åŒºé—´      | 39.923201 |
| --------- | ------------- | ---------- | --------- |
| -90ï¼Œ90   | -90ï¼Œ0        | 0ï¼Œ90      | 1         |
| 0ï¼Œ90     | 0ï¼Œ45         | 45ï¼Œ90     | 0         |
| 0ï¼Œ45     | 0ï¼Œ22.5       | 22.5ï¼Œ45   | 1         |
| 22.5ï¼Œ45  | 22.5ï¼Œ33.75   | 33.75ï¼Œ45  | 1         |
| 33.75ï¼Œ45 | 33.75ï¼Œ39.375 | 39.375ï¼Œ45 | 1         |
| ...       | ...           | ...        | ...       |

å¦‚æœæˆ‘ä»¬æƒ³è¦æ›´ç²¾ç¡®çš„åæ ‡å¯ä»¥ä¸€ç›´åˆ†ä¸‹å»ï¼Œç›´åˆ°æ»¡è¶³è‡ªå·±çš„è¦æ±‚ä¸ºæ­¢ã€‚`10111000110001111001`

åŒç†æˆ‘ä»¬å¯ä»¥å¯¹yåæ ‡ä¹Ÿè¿›è¡Œå¤„ç†ã€‚

| y          | 0åŒºé—´         | 1åŒºé—´       | 116.390705 |
| ---------- | ------------- | ----------- | ---------- |
| -180ï¼Œ180  | 180ï¼Œ0        | 0ï¼Œ180      | 1          |
| 0ï¼Œ180     | 0ï¼Œ90         | 90ï¼Œ180     | 1          |
| 90ï¼Œ180    | 90ï¼Œ135       | 135ï¼Œ180    | 0          |
| 90ï¼Œ135    | 90ï¼Œ112.5     | 112.5ï¼Œ135  | 1          |
| 112.5ï¼Œ135 | 112.5ï¼Œ123.75 | 123.75ï¼Œ135 | 0          |
| ...        | ...           | ...         | ...        |

å¾—åˆ°`11010010110001000100`

##### å°†äºŒè¿›åˆ¶åˆå¹¶

Xåæ ‡å å¶æ•°ä½ï¼ŒYå å¥‡æ•°ä½ï¼Œæ³¨æ„ï¼Œ0ä¹Ÿæ˜¯å¶æ•°ä½ã€‚

```
 11100 11101 00100 01111 00000 01101 01011 00001
å¤åˆ¶ä»£ç 
```

##### æŒ‰ç…§Base32è¿›è¡Œç¼–ç 

Base32ç¼–ç è¡¨çš„å…¶ä¸­ä¸€ç§å¦‚ä¸‹ï¼Œæ˜¯ç”¨0-9ã€b-zï¼ˆå»æ‰a, i, l, oï¼‰è¿™32ä¸ªå­—æ¯è¿›è¡Œç¼–ç ã€‚å…·ä½“æ“ä½œæ˜¯å…ˆå°†ä¸Šä¸€æ­¥å¾—åˆ°çš„åˆå¹¶åäºŒè¿›åˆ¶è½¬æ¢ä¸º10è¿›åˆ¶æ•°æ®ï¼Œç„¶åå¯¹åº”ç”ŸæˆBase32ç ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°†5ä¸ªäºŒè¿›åˆ¶ä½è½¬æ¢æˆä¸€ä¸ªbase32ç ã€‚ä¸Šä¾‹æœ€ç»ˆå¾—åˆ°çš„å€¼ä¸ºï¼š`wx4g0ec1`

| åè¿›åˆ¶ | 0    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   | 11   | 12   | 13   | 14   | 15   |
| ------ | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| base32 | 0    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | b    | c    | d    | e    | f    | g    |
| åè¿›åˆ¶ | 16   | 17   | 18   | 19   | 20   | 21   | 22   | 23   | 24   | 25   | 26   | 27   | 28   | 29   | 30   | 31   |
| base32 | h    | j    | k    | m    | n    | p    | q    | r    | s    | t    | u    | v    | w    | x    | y    | z    |

- Geohashæ¯”ç›´æ¥ç”¨ç»çº¬åº¦çš„é«˜æ•ˆå¾ˆå¤šï¼Œè€Œä¸”ä½¿ç”¨è€…å¯ä»¥å‘å¸ƒåœ°å€ç¼–ç ï¼Œæ—¢èƒ½è¡¨æ˜è‡ªå·±ä½äºåŒ—æµ·å…¬å›­é™„è¿‘ï¼Œåˆä¸è‡³äºæš´éœ²è‡ªå·±çš„ç²¾ç¡®åæ ‡ï¼Œæœ‰åŠ©äºéšç§ä¿æŠ¤ã€‚
- GeoHashç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºç»åº¦å’Œçº¬åº¦ä¸¤ä¸ªåæ ‡ã€‚åœ¨æ•°æ®åº“ä¸­å¯ä»¥å®ç°åœ¨ä¸€åˆ—ä¸Šåº”ç”¨ç´¢å¼•ï¼ˆæŸäº›æƒ…å†µä¸‹æ— æ³•åœ¨ä¸¤åˆ—ä¸ŠåŒæ—¶åº”ç”¨ç´¢å¼•ï¼‰
- GeoHashè¡¨ç¤ºçš„å¹¶ä¸æ˜¯ä¸€ä¸ªç‚¹ï¼Œè€Œæ˜¯ä¸€ä¸ªçŸ©å½¢åŒºåŸŸ
- GeoHashç¼–ç çš„å‰ç¼€å¯ä»¥è¡¨ç¤ºæ›´å¤§çš„åŒºåŸŸã€‚ä¾‹å¦‚wx4g0ec1ï¼Œå®ƒçš„å‰ç¼€wx4g0eè¡¨ç¤ºåŒ…å«ç¼–ç wx4g0ec1åœ¨å†…çš„æ›´å¤§èŒƒå›´ã€‚ è¿™ä¸ªç‰¹æ€§å¯ä»¥ç”¨äºé™„è¿‘åœ°ç‚¹æœç´¢

ç¼–ç è¶Šé•¿ï¼Œè¡¨ç¤ºçš„èŒƒå›´è¶Šå°ï¼Œä½ç½®ä¹Ÿè¶Šç²¾ç¡®ã€‚å› æ­¤æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ¯”è¾ƒGeoHashåŒ¹é…çš„ä½æ•°æ¥åˆ¤æ–­ä¸¤ä¸ªç‚¹ä¹‹é—´çš„å¤§æ¦‚è·ç¦»ã€‚

![image-20220408155639181.png](index/77f084a17c2441b491d639b40421c1d8tplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp)

#### é—®é¢˜

geohashç®—æ³•æœ‰ä¸¤ä¸ªé—®é¢˜ã€‚

##### è¾¹ç¼˜é—®é¢˜

![image-20220408160032211.png](index/6ee68c6950bc47f381ca4c13015218f6tplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp) å¦‚å›¾ï¼Œå¦‚æœè½¦åœ¨çº¢ç‚¹ä½ç½®ï¼ŒåŒºåŸŸå†…è¿˜æœ‰ä¸€ä¸ªé»„ç‚¹ã€‚ç›¸é‚»åŒºåŸŸå†…çš„ç»¿ç‚¹æ˜æ˜¾ç¦»çº¢ç‚¹æ›´è¿‘ã€‚ä½†å› ä¸ºé»„ç‚¹çš„ç¼–ç å’Œçº¢ç‚¹ä¸€æ ·ï¼Œæœ€ç»ˆæ‰¾åˆ°çš„å°†æ˜¯é»„ç‚¹ã€‚è¿™å°±æœ‰é—®é¢˜äº†ã€‚

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¾ˆç®€å•ï¼Œåªè¦å†æŸ¥æ‰¾å‘¨è¾¹8ä¸ªåŒºåŸŸå†…çš„ç‚¹ï¼Œçœ‹å“ªä¸ªç¦»è‡ªå·±æ›´è¿‘å³å¯ã€‚

###### æ›²çº¿çªå˜

æœ¬æ–‡ç¬¬2å¼ å›¾ç‰‡æ¯”è¾ƒå¥½åœ°è§£é‡Šäº†è¿™ä¸ªé—®é¢˜ã€‚å…¶ä¸­0111å’Œ1000ä¸¤ä¸ªç¼–ç éå¸¸ç›¸è¿‘ï¼Œä½†å®ƒä»¬çš„å®é™…è·ç¦»ç¡®å¾ˆè¿œã€‚æ‰€ä»¥ç¼–ç ç›¸è¿‘çš„ä¸¤ä¸ªå•ä½ï¼Œå¹¶ä¸ä¸€å®šçœŸå®è·ç¦»å¾ˆè¿‘ï¼Œè¿™éœ€è¦å®é™…è®¡ç®—ä¸¤ä¸ªç‚¹çš„è·ç¦»æ‰è¡Œã€‚

#### å®˜æ–¹è§£æ

åæ ‡èŒƒå›´æ£€ç´¢ï¼Œæœ‰å››å‰æ ‘ã€geohash ç­‰å‡ ç§æ ‡å‡†è§£æ³•ã€‚è¿™é“é¢˜æœ¬è´¨**å¹¶ä¸æ˜¯**è€ƒå¯Ÿå¯¹é«˜é˜¶ç®—æ³•çš„æŒæ¡ï¼Œè€Œæ˜¯æƒ³å‘æ˜åœ¨å­¦ä¹ æ•™æ btree ç­‰åŸºç¡€äºŒåˆ†æ€æƒ³åï¼Œèƒ½å¦è¿›ä¸€æ­¥æ€è€ƒè§£å‡ºæ›´å¤æ‚çš„é—®é¢˜ï¼›
 å¦å¤–è€ƒå¯Ÿæ€ç»´çµæ´»ç¨‹åº¦ï¼Œçœ‹æ˜¯å¦èƒ½å˜é€šçš„è§£å†³é—®é¢˜ï¼Œå¦‚è·ç¦»å¹¶æ²¡æœ‰é™å®šå¿…é¡»æ˜¯**æ¬§å¼è·ç¦»**ï¼›ä½ç½®å¯ä»¥ä¸ç²¾ç¡®ï¼Œå¯ä»¥å®¹å¿æœ‰è¯¯å·®ç­‰ã€‚

- **æ–¹æ³• 1ï¼Œå››å‰æ ‘ï¼ˆQTreeï¼‰**ï¼šåœ¨äºŒå‰æ ‘å·¦ã€å³èŠ‚ç‚¹çš„æ€æƒ³ä¸‹ï¼ŒåŠ å…¥ä¸Šã€ä¸‹ã€å‰ã€åç­‰æ›´å¤šçš„æ–¹å‘ï¼Œæ¼”è¿›ä¸ºå››å‰æ ‘å’Œå…«å‰æ ‘ã€‚é«˜é˜¶æ ‘æ¯”è¾ƒè¶…çº²ï¼Œç›¸å…³å®ç°çœç•¥ã€‚å››å‰æ ‘æ‰¾åˆ°å‘¨å›´çš„ç¯ç»•çš„ç‚¹åº”è¯¥æ˜¯æœ€å¿«çš„ã€‚
- **æ–¹æ³• 2ï¼Œgeohash**ï¼šæŠŠäºŒç»´é—®é¢˜é™ä¸ºä¸€ç»´
  å¦‚åæ ‡ï¼ˆç¤ºä¾‹éæ ‡å‡† geohashï¼Œåªæ˜¯æ¼”ç¤ºäº†æ€æƒ³ï¼‰ï¼š
  (12, 345) -> (**0**12, 345) -> "031425"
  (13, 348) -> (**0**13, 348) -> "031438"
  (2, 789) -> (**00**2, 789) -> "070829"
  æœ€ç»ˆåšå­—ç¬¦ä¸²å‰ç¼€åŒ¹é…ï¼Œå¯å¾— "031425" å’Œ "031438" åŒ¹é…åˆ°çš„ä½æ•°æœ€å¤šï¼ŒäºŒè€…è·ç¦»æœ€è¿‘ã€‚æ±‚ 3km å†…çš„åæ ‡ï¼Œåªéœ€æå‰ç®—å‡ºéœ€åŒ¹é…å‰å‡ ä½å³å¯ï¼Œå¦‚åŒ¹é…å‰ 4 ä½ï¼ŒæŒ‰ sql è¡¨è¾¾æ˜¯ LIKE '0314%'
- **æ–¹æ³• 3ï¼Œå˜é€šè·ç¦»ä¸º æ–¹åœ† 3kmï¼ˆæ›¼å“ˆé¡¿è·ç¦»ï¼‰**ï¼Œå³ deltaX = 1500, deltaY = 1500ï¼Œé€šè¿‡æ•°æ®åº“è§£å†³ Create table tb_name ( x int, y int ) å¹¶æ·»åŠ ç´¢å¼•ã€‚
  å‡å¦‚åŸç‚¹æ˜¯ (x0, y0)ï¼Œsql å¦‚ä¸‹ï¼š
  WHERE (x > x0 - 1500) AND (x < x0 + 1500) AND (y > y0 - 1500) AND (y < y0 + 1500)

## day-two

### ã€å¤šé€‰ã€‘ä¸‹åˆ—å…³äºJoin è¿ç®—ä¸æ­£ç¡®çš„æ˜¯ï¼š

a. Nested Loop Join ä¸èƒ½ä½¿ç”¨ç´¢å¼•åšä¼˜åŒ–ã€‚
 b. å¦‚æœå·¦è¡¨å¤ªå¤§ï¼Œä¸èƒ½æ”¾å…¥å†…å­˜ä¸­ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ Hash Joinã€‚
 c. å¦‚æœ Join çš„ä¸€ä¸ªè¾“å…¥è¡¨åœ¨ Join Key ä¸Šæœ‰åºï¼Œåˆ™ä¸€å®šä¼šä½¿ç”¨ Sort Merge Joinã€‚
 d. Broadcast Join é€‚ç”¨äºä¸€å¼ è¡¨å¾ˆå°ï¼Œå¦ä¸€å¼ è¡¨å¾ˆå¤§çš„åœºæ™¯ã€‚

#### è‡ªå·±è§£æ

A:å¯ä»¥åš [Nested Loop Join - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/81398139)

B: å¯ä»¥ä½¿ç”¨ï¼Œ[æ•°æ®åº“å¤šè¡¨è¿æ¥æ–¹å¼ä»‹ç»ï¼HASH-JOIN - _é›¨ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/shangyu/p/6055181.html)

Cï¼šä¸æ˜¯çš„[(21æ¡æ¶ˆæ¯) Merge joinã€Hash joinã€Nested loop joinå¯¹æ¯”åˆ†æ_KPLivesçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/horace20/article/details/16360109)

D: æ­£ç¡®çš„



### ç»™å®šä¸€ä¸ªæ­£æ•´æ•°æ•°ç»„ arrs å’Œæ•´æ•° K ï¼Œè¯·æ‰¾å‡ºè¯¥æ•°ç»„å†…ä¹˜ç§¯å°äºç­‰äº k çš„è¿ç»­çš„å­æ•°ç»„çš„ä¸ªæ•°ï¼Œç®—æ³•æ—¶é—´å¤æ‚åº¦o(n)

#### è§£æ

å¯¹äºè¿ç»­çš„å­æ•°ç»„çš„é—®é¢˜æƒ³åˆ°äº†åŒæŒ‡é’ˆçš„æ–¹æ³•ã€‚ç¬¬ä¸€ç‰ˆçš„ä»£ç å¦‚ä¸‹ã€‚ä½†æ˜¯è¿™ä¸ªä»£ç å…¶å®è¿˜æ˜¯æš´åŠ›æœç´¢ï¼Œæ¯é‡åˆ°ä¸€ä¸ª`arr[i]`å°±ä»iå¼€å§‹æšä¸¾ï¼Œæ»¡è¶³è¦æ±‚çš„åŠ å…¥åˆ°`res`ä¸­ï¼Œä¸æ»¡è¶³å°±ä¸‹ä¸€ä¸ªã€‚ç›¸å½“äºæ—¶é—´å¤æ‚åº¦ä¸ºOn^2

```c++
int subArr(vector<int> &arr, int target) {
    int slow = 0, fast = 0;
    int res = 0;
    for (; slow < arr.size(); slow++) {
        int temp = 1;
        for (fast = slow; fast < arr.size(); fast++) {
            temp *= arr[fast];
            if (temp <= target) {
                res++;
            } else {
                break;
            }
        }
    }
    return res;
}
```

æˆ‘ä»¬çŸ¥é“ï¼Œæ¯æ¬¡éƒ½æ˜¯ä¹˜ä»¥`æ­£æ•´æ•°`ï¼Œæ¯æ¬¡ç›¸ä¹˜åªä¼šè¶Šæ¥è¶Šå¤§ã€‚æˆ‘ä»¬è¦æƒ³åŠæ³•ç”¨åˆ°`è¶Šä¹˜è¶Šå¤§`è¿™ä¸ªç‰¹æ€§ã€‚

å®šä¹‰ä¸€ä¸ªæ…¢æŒ‡é’ˆ`slow`ï¼Œæ‰€æ±‚çš„ä¸ªæ•°`res`ï¼Œå½“å‰çš„ä¹˜ç§¯`mul`ã€‚

å¿«æŒ‡é’ˆ`fast`å¿«é€Ÿå‘å‰è®¡ç®—è¿ç»­æ•°ç»„çš„ä¹˜ç§¯ï¼Œå¦‚æœè®¡ç®—çš„ä¹˜ç§¯`å¤§äº`ç›®æ ‡å€¼`target`äº†ï¼Œå°±ç§»åŠ¨`slow`æŒ‡é’ˆï¼Œç›´åˆ°`mul`å°äº`target`ã€‚

å‰©ä¸‹ä¸€ä¸ªæœ€æ£˜æ‰‹çš„é—®é¢˜`å¦‚ä½•æ±‚res`

é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹ä»£ç 

```c++
int subArr(vector<int> &arr, int target) {
    int slow = 0;
    int res = 0;
    int mul = 1;
    for (int fast = 0; fast < arr.size(); fast++) {
        // è®¡ç®—å½“å‰çš„ä¹˜ç§¯
        mul *= arr[fast];
        // å¦‚æœä¹˜ç§¯è¶…è¿‡äº†æ…¢æŒ‡é’ˆå°±è¦å¼€å§‹ç§»åŠ¨ã€‚
        while (mul > target) {
            // mul = mul/arr[slow];
            // slow ++; çš„ç®€å†™
            mul /= arr[slow++];
        }
        // å¿«æŒ‡é’ˆæ¯å‘æœ‰ç§»åŠ¨ä¸€æ¬¡å¢åŠ çš„ç¬¦åˆæ¡ä»¶çš„ä¸ªæ•°ã€‚
        res += (fast - slow + 1);

    }
    return res;
}
```

1. æˆ‘ä»¬è¦ç»´æŠ¤ä¸€ä¸ªæ»‘çª—ã€‚çª—å£ä¸æ–­å‘å³æ»‘åŠ¨ï¼Œçª—å£å³è¾¹ç•Œ(fast)ä¸ºå›ºå®šè½´ï¼Œå·¦è¾¹ç•Œ(slow)åˆ™æ˜¯ä¸€ä¸ªå˜åŠ¨è½´ã€‚

2. æ­¤çª—å£ä»£è¡¨çš„æ„ä¹‰ä¸ºï¼šä»¥çª—å£å³è¾¹ç•Œä¸ºç»“æŸç‚¹çš„åŒºé—´ï¼Œå…¶æ»¡è¶³ä¹˜ç§¯å°äºtargetæ‰€èƒ½ç»´æŒçš„æœ€å¤§çª—å£ã€‚
   **å› æ­¤ï¼Œæœ¬é¢˜æœ€é‡è¦çš„æ˜¯æ±‚çª—å£åœ¨æ¯ä¸ªä½ç½®æ—¶ï¼Œçª—å£çš„æœ€å¤§é•¿åº¦ã€‚(æœ€å¤§é•¿åº¦æ˜¯é‡ç‚¹)**

3. æœ€ç»ˆçš„ç­”æ¡ˆä¾¿æ˜¯çª—å£åœ¨æ¯ä¸ªä½ç½®çš„æœ€å¤§é•¿åº¦çš„ç´¯è®¡å’Œã€‚
   ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªå°±éœ€è¦æˆ‘ä»¬æ‰¾è§„å¾‹äº†ã€‚å› ä¸ºé’ˆå¯¹ä¸Šä¸€ä½ç½®çš„çª—å£ï¼Œç§»åŠ¨ä¸€æ¬¡åç›¸å¯¹å¢åŠ å‡ºæ¥çš„ä¸ªæ•°ä¾¿æ˜¯`(fast - slow + 1)`ã€‚

> ä¸¾ä¸ªä¾‹å­:
>
> çª—å£å·¦è¾¹ç•Œï¼šl,çª—å£å³è¾¹ç•Œï¼šr
>
> k=100
>
> ä½ç½®iï¼š    		0, 1, 2, 3
>
> æ•°ç»„numsï¼š 10, 5, 2, 6
>
> çª—å£1(l=1,r=2)ï¼š   l, r   
>
> çª—å£2(l=1,r=3):    l,    r
>
> çª—å£1ä¸­ç¬¦åˆçš„æœ‰[5],[2],[5,2]
>
> çª—å£2ä¸­ç¬¦åˆçš„æœ‰[5],[2],[5,2],[6],[2,6],[5,2,6]


â€‹	å¯ä»¥çœ‹å‡ºï¼Œ`çª—å£2`å¯¹æ¯”`çª—å£1`å¤šå‡ºæ¥çš„æ•°ç»„éƒ½æ˜¯ç”±äºçª—å£`å³æ»‘ä¸€æ¬¡`æ‰€å¸¦æ¥çš„ï¼Œå³**å¤šå‡ºæ¥çš„é‚£å‡ ä¸ªå¿…ç„¶æ˜¯åŒ…å«æ–°çª—å£çš„è¾¹ç•Œfast**

â€‹	å› æ­¤å¯ä»¥å¾—å‡ºï¼Œæœ€ç»ˆç­”æ¡ˆå¯ä»¥æ˜¯æ¯æ¬¡çª—å£æœ€å¤§é•¿åº¦çš„ç´¯åŠ ã€‚

4. ä¸ºäº†æ±‚å‡ºæ¯æ¬¡çª—å£çš„æœ€å¤§é•¿åº¦(æˆ–ç†è§£ä¸ºå®½åº¦ä¹Ÿè®¸)ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹å˜åŠ¨è½´å·¦è¾¹ç•Œ(l)è¿›è¡Œè°ƒæ•´ã€‚
   å³è°ƒæ•´å·¦è¾¹ç•Œï¼Œä½¿ä¹‹èƒ½è¾¾åˆ°æ±‚å‡ºçª—å£çš„æœ€å¤§é•¿åº¦

## day-three

### ã€å¤šé€‰ã€‘ç»å¤§å¤šæ•°ç¡¬ç›˜å¯ä»¥æä¾›å“ªäº›å†™å…¥ä¿è¯ï¼Ÿ

a. å•ä¸ªsectoråŸå­å†™å…¥
b. å•ä¸ªpageåŸå­å†™å…¥
c. ç¡¬ç›˜é¡ºåºæ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿå‘é€çš„æ“ä½œ
d. ä»¥ä¸Šéƒ½ä¸å¯ä»¥

 åœ¨éšæ—¶å¯èƒ½æ–­ç”µçš„æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°ç¡¬ä»¶èƒ½æä¾›å•ä¸ªsectorçš„åŸå­æ€§å†™å…¥ï¼›

ä½†æ˜¯ä¹Ÿæœ‰å°‘æ•°ç¡¬ä»¶è¿å•ä¸ªsectorçš„å†™å…¥éƒ½æ— æ³•ä¿è¯ï¼›

å¦‚æœä¸€ä¸ªpageå¯¹åº”å¤šä¸ªsectorï¼Œåˆ™å•ä¸ªpageçš„å®Œæ•´å†™å…¥æ€»æ˜¯æ— æ³•å¾—åˆ°ä¿éšœã€‚æ›´åŠ è¯¦ç»†çš„æƒ…å†µå¯ä»¥æŸ¥çœ‹è¿™ä¸ªè®¨è®ºï¼š[crash - Are disk sector writes atomic?](https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%3A%2F%2Fstackoverflow.com%2Fquestions%2F2009063%2Fare-disk-sector-writes-atomic)ã€‚

å¯¹äºåŒæ—¶å‘ç»™ç¡¬ç›˜çš„å¤šä¸ªæ“ä½œï¼ˆæ¯”å¦‚å†™å¤šä¸ªä¸è¿ç»­çš„sectorï¼‰ï¼Œç¡¬ç›˜å¹¶ä¸ä¿è¯æ“ä½œçš„é¡ºåºã€‚ç»“åˆå…¶å¼±åŸå­æ€§ï¼Œæ‰€ä»¥ç¡¬ç›˜å¯èƒ½å¤„åœ¨ä»»ä½•ä¸€ä¸ªä¸­é—´çŠ¶æ€ã€‚è¿™ä¸»è¦æ˜¯ç”±äºæœºæ¢°ç¡¬ç›˜çš„å¯»å€ä¼˜åŒ–ç­–ç•¥å’Œå›ºæ€/æœºæ¢°ç¡¬ç›˜çš„ç¼“å­˜ç­–ç•¥å¯¼è‡´çš„ã€‚

### åˆ¤æ–­ä¸€æ£µäºŒå‰æ ‘æ˜¯å¦æ˜¯å¹³è¡¡äºŒå‰æ ‘ã€‚ï¼ˆå¹³è¡¡äºŒå‰æ ‘è¦æ±‚ï¼šæ ‘ä¸­èŠ‚ç‚¹å·¦å³å­æ ‘æ ‘é«˜å·®ä¸è¶…è¿‡1ã€‚ï¼‰

äºŒå‰æ ‘çš„å®šä¹‰

> 1.å·¦å³å­æ ‘çš„é«˜åº¦å·®ä¸èƒ½è¶…è¿‡1
> 2.å·¦å³å­æ ‘ä¹Ÿæ˜¯å¹³è¡¡äºŒå‰æ ‘

#### è§£æ³•ä¸€

è¿™æ ·çš„è¯ï¼Œå¦‚æœæ˜¯ç©ºæ ‘åˆ™æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œå¦‚æœä¸æ˜¯ç©ºæ ‘ï¼Œæˆ‘ä»¬å°±å»åˆ¤æ–­å·¦å­æ ‘æ˜¯ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œåˆ¤æ–­çš„ä¾æ®å°±æ˜¯å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡1ï¼Œä»£ç å¦‚ä¸‹ï¼š

```c++
#include<iostream>
#include<vector>

using namespace std;

struct Node {
    int val;
    Node *left;
    Node *right;

    Node(int x) : val(x), left(nullptr), right(nullptr) {}

    Node(int x, Node *left, Node *right) : val(x), left(left), right(right) {}
};
// è·å¾—æ ‘çš„é«˜åº¦
int getTreeHeight(Node *tree) {
    if (tree == nullptr) {
        return 0;
    }
    int left = getTreeHeight(tree->left);
    int right = getTreeHeight(tree->right);
    return left > right ? left + 1 : right + 1;
}

bool isBalance(Node *tree) {
    if (tree == nullptr) {
        return true;
    }
    // æ‹¿åˆ°å·¦å­æ ‘çš„é«˜åº¦
    int leftHeight = getTreeHeight(tree->left);
    // æ‹¿åˆ°å³å­æ ‘çš„é«˜åº¦
    int rightHeight = getTreeHeight(tree->right);
    // æ˜¯å¦æ»¡è¶³è¦æ±‚
    if (abs(leftHeight - rightHeight) > 1) {
        return false;
    }
    // åˆ¤æ–­å·¦å­æ ‘å’Œå³å­æ ‘æ˜¯å¦æ˜¯äºŒå‰å¹³è¡¡æ ‘
    return isBalance(tree->right) && isBalance(tree->left);
}

int main() {
    Node *node = new Node(1,
                          new Node(1,
                                   new Node(3,
                                            new Node(4),
                                            nullptr),
                                   new Node(1)),
                          new Node(1));
    cout << isBalance(node) << endl;
    Node *node1 = new Node(1,
                           new Node(1),
                           new Node(1));
    cout << isBalance(node1) << endl;
    return 0;
}

```

è¿™æ ·åšæ˜¯æœ‰ä¸€ä¸ªåå¤„å°±æ˜¯ç»“ç‚¹çš„é«˜åº¦ä¼šè¢«é‡å¤è®¡ç®—ã€‚

![preload](index/1n0nrxx3q3.png)

æˆ‘ä»¬é¦–å…ˆåˆ¤æ–­æ ¹`èŠ‚ç‚¹1`æ˜¯ä¸æ˜¯å¹³è¡¡çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦è°ƒç”¨`getTreeHeight`å‡½æ•°æ±‚æ ¹èŠ‚ç‚¹å·¦å­æ ‘çš„é«˜åº¦ï¼Œéœ€è¦éå†èŠ‚ç‚¹`4ã€5ã€7`ã€‚æ¥ä¸‹æ¥éœ€è¦åˆ¤æ–­ä»¥`èŠ‚ç‚¹2`ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘æ˜¯ä¸æ˜¯å¹³è¡¡æ ‘çš„æ—¶å€™ï¼Œåˆ†åˆ«æ±‚ä»¥èŠ‚ç‚¹2ä¸ºæ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘çš„é«˜åº¦å’Œå³å­æ ‘çš„é«˜åº¦ï¼Œè¿™æ—¶åˆéå†äº†èŠ‚ç‚¹`4ã€5ã€7`ã€‚

#### è§£æ³•äºŒ

è¿™æ—¶æå‡ºä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼š

 é‡‡ç”¨ååºéå†çš„æ–¹å¼éå†äºŒå‰æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåœ¨éå†åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¹‹å‰æˆ‘ä»¬å°±å·²ç»éå†äº†å®ƒçš„å·¦å³å­æ ‘ã€‚æ­¤æ—¶ï¼Œè®°å½•æ¯ä¸ªèŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„æ ‘çš„é«˜åº¦ï¼Œå°±å¯ä»¥ä¸€è¾¹éå†ä¸€è¾¹åˆ¤æ–­æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯å¹³è¡¡çš„ã€‚

```c++
bool IsBalanced(Node *node, int *depth) {
    // ä¸ºç©ºé«˜åº¦ä¸º0
    if (node == nullptr) {
        *depth = 0;
        return true;
    }

    int nLeftDepth, nRightDepth;
    // å·¦å­æ ‘
    bool bLeft = IsBalanced(node->left, &nLeftDepth);
    // å³å­æ ‘
    bool bRight = IsBalanced(node->right, &nRightDepth);

    if (bLeft && bRight) {
        int diff = nRightDepth - nLeftDepth;
        if (abs(diff) < 2) //å·¦å³å­—æ ‘é«˜åº¦å·®ç»å¯¹å€¼ä¸è¶…è¿‡1
        {
            *depth = 1 + (nLeftDepth > nRightDepth ? nLeftDepth : nRightDepth);
            return true;
        }
    }
    return false;
}

bool IsBalanced(Node *pRoot) {
    int depth = 0;

    return IsBalanced(pRoot, &depth);
}
```

è¿™é‡Œçš„boolå€¼ä¹Ÿå¯ä»¥ä¼˜åŒ–æ‰ã€‚ç”¨`-1`æ¥ä»£æ›¿

```c++
int IsBalanced(Node *node) {
    // ä¸ºç©ºé«˜åº¦ä¸º0
    if (node == nullptr) {
        return 0;
    }

    // å·¦å­æ ‘
    int left = IsBalanced(node->left);
    if (left == -1) return -1;
    int right = IsBalanced(node->right);
    if (right == -1) return -1;
    // -1 è¡¨ç¤ºä¸æ»¡è¶³é«˜åº¦è¦æ±‚
    return abs(left - right) < 2 ? max(left, right) + 1 : -1;

}

bool isBalanced(Node *pRoot) {
    return IsBalanced(pRoot) != -1;
}
```



## day-four

### ã€å•é€‰ã€‘go test é»˜è®¤æ˜¯ä»¥ä»€ä¹ˆé¡ºåºæ‰§è¡Œæµ‹è¯•çš„ï¼Ÿ

a. å¤šä¸ª module å¹¶å‘æ‰§è¡Œï¼Œå• module ä¸‹å¤šä¸ªæµ‹è¯•å¹¶å‘æ‰§è¡Œ
 b. å¤šä¸ª module å¹¶å‘æ‰§è¡Œï¼Œå• module ä¸‹å¤šä¸ªæµ‹è¯•ä¸²è¡Œæ‰§è¡Œ
 c. å¤šä¸ª module ä¸²è¡Œæ‰§è¡Œï¼Œå• module ä¸‹å¤šä¸ªæµ‹è¯•å¹¶å‘æ‰§è¡Œ
 d. å¤šä¸ª module ä¸²è¡Œæ‰§è¡Œï¼Œå• module ä¸‹å¤šä¸ªæµ‹è¯•ä¸²è¡Œæ‰§è¡Œ

#### è§£æ

bï¼›
 å¤šä¸ª modules ä¼šå¹¶å‘ç¼–è¯‘ï¼Œç„¶åå¹¶å‘æ‰§è¡Œæµ‹è¯•ï¼Œé™¤éæ·»åŠ äº†é¢å¤–çš„å‚æ•°`-p=1`ã€‚å•ä¸ª modules ä¸‹å¤šä¸ªæµ‹è¯•ä¼šä¸²è¡Œæ‰§è¡Œï¼Œé™¤éåœ¨æµ‹è¯•å‡½æ•°å†…æ‰§è¡Œ`t.Parallel()`ã€‚

åªæœ‰æµ‹è¯•æºç æ–‡ä»¶çš„åç§°å¯¹äº†ï¼Œæµ‹è¯•å‡½æ•°çš„åç§°å’Œç­¾åä¹Ÿå¯¹äº†ï¼Œå½“æˆ‘ä»¬è¿è¡Œgo testå‘½ä»¤çš„æ—¶å€™ï¼Œå…¶ä¸­çš„æµ‹è¯•ä»£ç æ‰æœ‰å¯èƒ½è¢«è¿è¡Œ

go testå‘½ä»¤åœ¨å¼€å§‹è¿è¡Œæ—¶ï¼Œä¼šå…ˆåšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚ï¼Œç¡®å®šå†…éƒ¨éœ€è¦ç”¨åˆ°çš„å‘½ä»¤ï¼Œæ£€æŸ¥æˆ‘ä»¬æŒ‡å®šçš„ä»£ç åŒ…æˆ–æºç æ–‡ä»¶çš„æœ‰æ•ˆæ€§ï¼Œä»¥åŠåˆ¤æ–­æˆ‘ä»¬ç»™äºˆçš„æ ‡è®°æ˜¯å¦åˆæ³•ï¼Œç­‰ç­‰

åœ¨å‡†å¤‡å·¥ä½œé¡ºåˆ©å®Œæˆä¹‹åï¼Œgo testå‘½ä»¤å°±ä¼šé’ˆå¯¹æ¯ä¸ªè¢«æµ‹ä»£ç åŒ…ï¼Œä¾æ¬¡åœ°è¿›è¡Œæ„å»ºã€æ‰§è¡ŒåŒ…ä¸­ç¬¦åˆè¦æ±‚çš„æµ‹è¯•å‡½æ•°ï¼Œæ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼Œæ‰“å°æµ‹è¯•ç»“æœ
å¯¹äºæ¯ä¸ªè¢«æµ‹ä»£ç åŒ…ï¼Œgo testå‘½ä»¤ä¼šä¸²è¡Œåœ°æ‰§è¡Œæµ‹è¯•æµç¨‹ä¸­çš„æ¯ä¸ªæ­¥éª¤

ä½†æ˜¯ï¼Œä¸ºäº†åŠ å¿«æµ‹è¯•é€Ÿåº¦ï¼Œå®ƒé€šå¸¸ä¼šå¹¶å‘åœ°å¯¹å¤šä¸ªè¢«æµ‹ä»£ç åŒ…è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ï¼Œåªä¸è¿‡ï¼Œåœ¨æœ€åæ‰“å°æµ‹è¯•ç»“æœçš„æ—¶å€™ï¼Œå®ƒä¼šä¾ç…§æˆ‘ä»¬ç»™å®šçš„é¡ºåºé€ä¸ªè¿›è¡Œï¼Œè¿™ä¼šè®©æˆ‘ä»¬æ„Ÿè§‰åˆ°å®ƒæ˜¯åœ¨å®Œå…¨ä¸²è¡Œåœ°æ‰§è¡Œæµ‹è¯•æµç¨‹ã€‚

å¦ä¸€æ–¹é¢ï¼Œç”±äºå¹¶å‘çš„æµ‹è¯•ä¼šè®©æ€§èƒ½æµ‹è¯•çš„ç»“æœå­˜åœ¨åå·®ï¼Œæ‰€ä»¥æ€§èƒ½æµ‹è¯•ä¸€èˆ¬éƒ½æ˜¯ä¸²è¡Œè¿›è¡Œçš„ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œåªæœ‰åœ¨æ‰€æœ‰æ„å»ºæ­¥éª¤éƒ½åšå®Œä¹‹åï¼Œgo testå‘½ä»¤æ‰ä¼šçœŸæ­£åœ°å¼€å§‹è¿›è¡Œæ€§èƒ½æµ‹è¯•ã€‚å¹¶ä¸”ï¼Œä¸‹ä¸€ä¸ªä»£ç åŒ…æ€§èƒ½æµ‹è¯•çš„è¿›è¡Œï¼Œæ€»ä¼šç­‰åˆ°ä¸Šä¸€ä¸ªä»£ç åŒ…æ€§èƒ½æµ‹è¯•çš„ç»“æœæ‰“å°å®Œæˆæ‰ä¼šå¼€å§‹ï¼Œè€Œä¸”æ€§èƒ½æµ‹è¯•å‡½æ•°çš„æ‰§è¡Œä¹Ÿéƒ½ä¼šæ˜¯ä¸²è¡Œçš„ã€‚

### ã€åˆ†å¸ƒå¼æ–‡ä»¶å¤„ç†ï¼Œè·å–æœ€å¤šçš„ URLã€‘å¦‚æœæœ‰ä¸€ä¸ª 20g çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ—¥å¿—æ–‡ä»¶è®°å½•ç€ç”¨æˆ·è®¿é—®è¿‡çš„ urlï¼Œæ¯ä¸€è¡Œä¸ºä¸€ä¸ª urlï¼Œç»™ä½ ä¸€å° 512M çš„ä¸»æœºï¼Œæ‰¾å‡ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„ 10 ä¸ª urlã€‚

#### è§£æ

**Top Kç®—æ³•ï¼šä½¿ç”¨å †æ’åºç®—æ³•ã€‚**

- å¯ä»¥è€ƒè™‘é‡‡ç”¨â€œåˆ†è€Œæ²»ä¹‹â€çš„æ€æƒ³ï¼ŒæŒ‰ç…§ Hash(url)%100 è¿›è¡Œåˆ†æµï¼ŒæŠŠæµ·é‡ url æ—¥å¿—åˆ†åˆ«å­˜å‚¨åˆ° 100 ä¸ªå°æ–‡ä»¶ä¸­ã€‚
- å¯¹äºæ¯ä¸€ä¸ªå°æ–‡ä»¶ï¼Œå¯ä»¥æ„å»ºä¸€ä¸ª url ä¸º keyï¼Œå‡ºç°æ¬¡æ•°ä¸º value çš„ Hash mapï¼ŒåŒæ—¶è®°å½•å½“å‰æ–‡ä»¶å‡ºç°æ¬¡æ•°æ’åå‰10çš„url
- å¯ä»¥å¾—åˆ° 100ä¸ªå°æ–‡ä»¶ä¸­çš„å‡ºç°æ¬¡å‰1000çš„ urlï¼Œå†ä¾æ®å¸¸è§„çš„æ’åºç®—æ³•å¾—åˆ°æ€»ä½“ä¸Šå‡ºç°æ¬¡æ•°æœ€å¤šçš„ urlï¼›



## day-five

### ã€å•é€‰ã€‘ä½¿ç”¨ SQL è¯­å¥è¿›è¡Œåˆ†ç»„æ£€ç´¢æ—¶ï¼Œä¸ºäº†å»æ‰ä¸æ»¡è¶³æ¡ä»¶çš„åˆ†ç»„ï¼Œåº”å½“:

a. ä½¿ç”¨ WHERE å­å¥
 b. åœ¨ GROUPBY åé¢ä½¿ç”¨ HAVING å­å¥
 c. å…ˆä½¿ç”¨ WHERE å­å¥ï¼Œå†ä½¿ç”¨ HAVING å­å¥
 d. å…ˆä½¿ç”¨ HAVING å­å¥ï¼Œå†ä½¿ç”¨ WHERE å­å¥

#### è§£æ

å…ˆä½¿ç”¨`where`ç­›é€‰å‡ºåŸºç¡€æ•°æ®ï¼Œå†ä½¿ç”¨`group by`è¿›è¡Œåˆ†ç»„ï¼Œæœ€åä½¿ç”¨`having`æŒ‘é€‰é™¤åˆ†ç»„ä¸­æ»¡è¶³è¦æ±‚çš„æ•°æ®ã€‚

ä¸‹é¢çš„æ˜¯æŒ‘é€‰åœ¨`1650434852`ä¹‹åä¸Šæ¶çš„ï¼Œå¹³å‡ä»·æ ¼å¤§äº2500çš„å•†å“ã€‚

```sql
SELECT product_type, AVG(sale_price)
FROM Product
where product_create_at >1650434852 
GROUP BY product_type
HAVING AVG(sale_price) >= 2500;	
```

ä¼˜å…ˆä½¿ç”¨`where`èƒ½é™ä½`group by`ä¸­çš„æ•°æ®é‡ã€‚

### å®ç°ä¸€ä¸ª key ä¸ºå­—ç¬¦ä¸²ï¼Œvalue ä¹Ÿæ˜¯å­—ç¬¦ä¸²çš„ï¼Œè€Œä¸”å¹¶å‘å®‰å…¨çš„ mapï¼Œæ‹¥æœ‰æ–¹æ³• set(key string, value string)ã€get(key string) stringã€del(key string)ã€‚

**æ‰©å±•è¦æ±‚1ï¼š** å­—å…¸åˆå§‹æœ‰64ä¸ªæ¡¶ï¼Œå½“æœ‰ä¸€åŠä»¥ä¸Šçš„é˜Ÿåˆ—æœ‰å¤šä¸ªå…ƒç´ æ—¶ï¼Œè¿›è¡Œè‡ªåŠ¨æ‰©å®¹ï¼Œå°†æ¡¶çš„æ•°é‡ç¿»å€ã€‚
 **æ‰©å±•è¦æ±‚2ï¼š** å½“ä¸€åŠä»¥ä¸Šçš„é˜Ÿåˆ—éƒ½ä¸ºç©ºæˆ–åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”è¿™ç§æƒ…å†µæŒç»­1åˆ†é’Ÿï¼Œåˆ™è‡ªåŠ¨ç¼©å®¹ï¼Œæœ€å°ç¼©å®¹åˆ°64é˜Ÿåˆ—ã€‚

#### æ»¡è¶³åŸºæœ¬è¦æ±‚

```go
package exp5

import "sync"

// è‡ªå·±çš„mapçš„æ•°æ®ç»“æ„
type MyMap struct {
	data map[string]string
    // åŠ è¯»å†™é”
	lock sync.RWMutex
}

func NewMyMap() *MyMap {
	return &MyMap{
		data: make(map[string]string),
	}
}

func (myMap *MyMap) Set(key, value string) {
	if myMap.data == nil {
		myMap.data = make(map[string]string)
	}
    // åŠ é”
	myMap.lock.Lock()
	defer myMap.lock.Unlock()
	myMap.data[key] = value

}

func (myMap *MyMap) Get(key string) string {
	if myMap.data == nil {
		return ""
	}
    // åŠ  è¯»é”
	myMap.lock.RLock()
	defer myMap.lock.RUnlock()
	return myMap.data[key]
}

func (myMap *MyMap) Del(key string) {
	if myMap.data == nil {
		return
	}
	myMap.lock.Lock()
	delete(myMap.data, key)
	myMap.lock.Unlock()
}

```

##### æµ‹è¯•

```go
func createMap(t *testing.T) *MyMap {
	m := NewMyMap()
	require.NotNil(t, m)
	return m
}

func TestMyMap(t *testing.T) {
	m := createMap(t)
	n := 10000
	for i := 0; i < n; i++ {
		j := i
		// å¼€å¯ 1000 ä¸ªåç¨‹ï¼Œæ¯ä¸ªåç¨‹éƒ½ä¼šè°ƒç”¨ Get æ–¹æ³•
		for k := 0; k < 1000; k++ {
			k := k
			go func() {
				m.Set(strconv.Itoa(j), strconv.Itoa(j+k))
			}()
		}
	}

	for i := 0; i < n; i++ {
		j := i
		// å¼€å¯ 1000 ä¸ªåç¨‹ï¼Œæ¯ä¸ªåç¨‹éƒ½ä¼šè°ƒç”¨ Get æ–¹æ³•
		for k := 0; k < 1000; k++ {
			go func() {
				_ = m.Get(strconv.Itoa(j))
			}()
		}

	}

	for i := 0; i < n; i++ {
		j := i
		// å¼€å¯ 1000 ä¸ªåç¨‹ï¼Œæ¯ä¸ªåç¨‹éƒ½ä¼šè°ƒç”¨ Del æ–¹æ³•
		for k := 0; k < 1000; k++ {
			go func() {
				m.Del(strconv.Itoa(j))
			}()
		}

	}
}

```

å¦‚æœæ˜¯æ™®é€šçš„mapï¼Œå¼€å¤šä¸ª`goroutinue`ä¼šæŠ¥`fatal error: concurrent map read and map write`çš„è‡´å‘½é”™è¯¯ã€‚åŠ é”ä¹‹åçš„`MyMap`æ˜¯æ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ã€‚

å¯¹äºæ‰©å±•è¦æ±‚ï¼Œmapçš„æºç è¿˜æ²¡æœ‰çœ‹å®Œå…ˆ`todo`

## day-six

### ã€å•é€‰ã€‘ä¸‹åˆ—å…³äº Python çš„è¯´æ³•é”™è¯¯çš„æ˜¯?

a. Python æ˜¯å¼ºç±»å‹è¯­è¨€
b. Python ä¸­æ‰€æœ‰å˜é‡æœ¬è´¨ä¸Šéƒ½æ˜¯æŒ‡é’ˆ
c. Python è¿è¡Œæ—¶ä¼šæ ¹æ®ç±»å‹æç¤º(type hints)æ£€æŸ¥å˜é‡ç±»å‹
d. CPython ä¸æ”¯æŒå°¾é€’å½’ä¼˜åŒ–

#### è§£æ

 **Aï¼šæ­£ç¡®** Python å¦‚ä½•ä¸å…¶å®ƒç¼–ç¨‹è¯­è¨€çš„æ¯”è¾ƒçš„è§£é‡Šï¼š

- é™æ€ç±»å‹è¯­è¨€

  ä¸€ç§åœ¨ç¼–è¯‘æœŸé—´å°±ç¡®å®šæ•°æ®ç±»å‹çš„è¯­è¨€ã€‚å¤§å¤šæ•°é™æ€ç±»å‹è¯­è¨€æ˜¯é€šè¿‡è¦æ±‚åœ¨ä½¿ç”¨ä»»ä¸€å˜é‡ä¹‹å‰å£°æ˜å…¶æ•°æ®ç±»å‹æ¥ä¿è¯è¿™ä¸€ç‚¹çš„ã€‚Java å’Œ C æ˜¯é™æ€ç±»å‹è¯­è¨€ã€‚

- åŠ¨æ€ç±»å‹è¯­è¨€

  ä¸€ç§åœ¨è¿è¡ŒæœŸé—´æ‰å»ç¡®å®šæ•°æ®ç±»å‹çš„è¯­è¨€ï¼Œä¸é™æ€ç±»å‹ç›¸åã€‚VBScript å’Œ Python æ˜¯åŠ¨æ€ç±»å‹çš„ï¼Œå› ä¸ºå®ƒä»¬ç¡®å®šä¸€ä¸ªå˜é‡çš„ç±»å‹æ˜¯åœ¨æ‚¨ç¬¬ä¸€æ¬¡ç»™å®ƒèµ‹å€¼çš„æ—¶å€™ã€‚

- å¼ºç±»å‹è¯­è¨€

  ä¸€ç§æ€»æ˜¯å¼ºåˆ¶ç±»å‹å®šä¹‰çš„è¯­è¨€ã€‚Java å’Œ Python æ˜¯å¼ºåˆ¶ç±»å‹å®šä¹‰çš„ã€‚æ‚¨æœ‰ä¸€ä¸ªæ•´æ•°ï¼Œå¦‚æœä¸æ˜ç¡®åœ°è¿›è¡Œè½¬æ¢ ï¼Œä¸èƒ½å°†æŠŠå®ƒå½“æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

- å¼±ç±»å‹è¯­è¨€

  ä¸€ç§ç±»å‹å¯ä»¥è¢«å¿½ç•¥çš„è¯­è¨€ï¼Œä¸å¼ºç±»å‹ç›¸åã€‚VBScript æ˜¯å¼±ç±»å‹çš„ã€‚åœ¨ VBScript ä¸­ï¼Œæ‚¨å¯ä»¥å°†å­—ç¬¦ä¸² `'12'` å’Œæ•´æ•° `3` è¿›è¡Œè¿æ¥å¾—åˆ°å­—ç¬¦ä¸²`'123'`ï¼Œç„¶åå¯ä»¥æŠŠå®ƒçœ‹æˆæ•´æ•° `123` ï¼Œæ‰€æœ‰è¿™äº›éƒ½ä¸éœ€è¦ä»»ä½•çš„æ˜¾ç¤ºè½¬æ¢ã€‚

æ‰€ä»¥è¯´ Python æ—¢æ˜¯*åŠ¨æ€ç±»å‹è¯­è¨€* (å› ä¸ºå®ƒä¸ä½¿ç”¨æ˜¾ç¤ºæ•°æ®ç±»å‹å£°æ˜)ï¼Œåˆæ˜¯*å¼ºç±»å‹è¯­è¨€* (å› ä¸ºåªè¦ä¸€ä¸ªå˜é‡è·å¾—äº†ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œå®ƒå®é™…ä¸Šå°±ä¸€ç›´æ˜¯è¿™ä¸ªç±»å‹äº†)ã€‚

**Bï¼šæ­£ç¡®**

```powershell
>>> a = 5
>>> id(5)
1844502817200
>>> id(a)
1844502817200
>>> a = '444'
>>> id(a)
1844504907376
>>> id('444')
1844504907376
```

å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå‘ç°`a`å’Œ`5`çš„åœ°å€ç«Ÿç„¶ä¸€æ ·ï¼Œå¦‚æœç»™aèµ‹å€¼ä¸º`444`å‘ç°ï¼Œaçš„åœ°å€åˆå˜äº†ï¼Œè¿™è¯´æ˜åœ¨a = `444`çš„æ—¶å€™åŸæ¥çš„açš„åœ°å€è¢«å›æ”¶ï¼Œè¿™é‡Œçš„aæœ‰é‡æ–°æŒ‡å‘æ–°çš„å­—ç¬¦ä¸²çš„åœ°å€äº†ã€‚pythonæŠŠä¸€åˆ‡æ•°æ®ï¼Œä¸€åˆ‡çš„ä¸€åˆ‡éƒ½çœ‹ä½œå¯¹è±¡ï¼Œåœ¨pythonä¸­ï¼Œæ²¡æœ‰å˜é‡ï¼Œåªæœ‰æŒ‡é’ˆï¼Œè¦è¯´å˜é‡ï¼Œä¹Ÿæ˜¯æŒ‡é’ˆå˜é‡ã€‚

**C: é”™è¯¯**ï¼Œpythonæ˜¯ä¸€ä¸ªåŠ¨æ€ç±»å‹è¯­è¨€ï¼Œåœ¨è¿è¡ŒæœŸé—´æ‰ä¼šç¡®å®šæ•°æ®ç±»å‹ã€‚è¿è¡Œæ—¶è§£é‡Šå™¨ï¼ˆCPythonï¼‰ä¸ä¼šå°è¯•åœ¨è¿è¡Œæ—¶æ¨æ–­ç±»å‹ä¿¡æ¯ï¼Œæˆ–è€…éªŒè¯åŸºäºæ­¤ä¼ é€’çš„å‚æ•°ã€‚

**D: æ­£ç¡®**

æœ‰å¾ˆå¤šæ—¶å€™ï¼Œä½¿ç”¨é€’å½’çš„æ–¹å¼å†™ä»£ç è¦æ¯”è¿­ä»£æ›´ç›´è§‚ä¸€äº›ï¼Œä»¥ä¸‹é¢çš„é˜¶ä¹˜ä¸ºä¾‹ï¼š

```python
def factorial(n):
    if n == 0:
        return 1
    return factorial(n - 1) * n 
```

ä½†æ˜¯è¿™ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå¦‚æœå±•å¼€ï¼Œä¼šå˜æˆå¦‚ä¸‹çš„å½¢å¼ï¼š

```python
factorial(4)
factorial(3) * 4
factorial(2) * 3 * 4
factorial(1) * 2 * 3 * 4
factorial(0) * 1 * 2 * 3 * 4
1 * 1 * 2 * 3 * 4
1 * 2 * 3 * 4
2 * 3 * 4
6 * 4
24
```

å¯ä»¥çœ‹å‡ºï¼Œåœ¨æ¯æ¬¡é€’å½’è°ƒç”¨çš„æ—¶å€™ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œå¯¼è‡´è¿›ç¨‹å†…å­˜å ç”¨é‡å¢å¤§ä¸€äº›ã€‚è¿™æ ·æ‰§è¡Œä¸€äº›é€’å½’å±‚æ•°æ¯”è¾ƒæ·±çš„ä»£ç æ—¶ï¼Œé™¤äº†æ— è°“çš„å†…å­˜æµªè´¹ï¼Œè¿˜æœ‰å¯èƒ½å¯¼è‡´è‘—åçš„*å †æ ˆæº¢å‡º*é”™è¯¯ã€‚

ä½†æ˜¯å¦‚æœæŠŠä¸Šé¢çš„å‡½æ•°å†™æˆå¦‚ä¸‹å½¢å¼ï¼š

```python
def factorial(n, acc=1):
    if n == 0:
        return acc
    return factorial(n - 1, n * acc)
```

æˆ‘ä»¬å†è„‘å†…å±•å¼€ä¸€ä¸‹ï¼š

```python
factorial(4, 1)
factorial(3, 4)
factorial(2, 12)
factorial(1, 24)
factorial(0, 24)
24
```

å¾ˆç›´è§‚çš„å°±å¯ä»¥çœ‹å‡ºï¼Œè¿™æ¬¡çš„ `factorial` å‡½æ•°åœ¨é€’å½’è°ƒç”¨çš„æ—¶å€™ä¸ä¼šäº§ç”Ÿä¸€ç³»åˆ—é€æ¸å¢å¤šçš„ä¸­é—´å˜é‡äº†ï¼Œè€Œæ˜¯å°†çŠ¶æ€ä¿å­˜åœ¨ `acc` è¿™ä¸ªå˜é‡ä¸­ã€‚

è€Œè¿™ç§å½¢å¼çš„é€’å½’ï¼Œå°±å«åš**å°¾é€’å½’**ã€‚

å°¾é€’å½’çš„å®šä¹‰é¡¾åæ€ä¹‰ï¼Œ**å‡½æ•°è°ƒç”¨ä¸­æœ€åè¿”å›çš„ç»“æœæ˜¯å•çº¯çš„é€’å½’å‡½æ•°è°ƒç”¨ï¼ˆæˆ–è¿”å›ç»“æœï¼‰å°±æ˜¯å°¾é€’å½’**ã€‚

æ¯”å¦‚ä»£ç ï¼š

```python
def foo():
    return foo()
```

å°±æ˜¯å°¾é€’å½’ã€‚ä½†æ˜¯ return çš„ç»“æœé™¤äº†é€’å½’çš„å‡½æ•°è°ƒç”¨ï¼Œè¿˜åŒ…å«å¦å¤–çš„è®¡ç®—ï¼Œå°±ä¸èƒ½ç®—ä½œå°¾é€’å½’äº†ï¼Œæ¯”å¦‚ï¼š

```python
def foo():
    return foo() + 1  # return 1 + foo() ä¹Ÿä¸€æ ·
```

[Python ä¸å°¾é€’å½’ä¼˜åŒ– (aisk.me)](https://aisk.me/python-and-tail-call-optimization/)

### ç»™å®šåŒ…å« N ä¸ªä»»åŠ¡ task çš„æ•°ç»„ tasks å’Œæ•´æ•° Kï¼Œå’Œä¸€ä¸ªå¯å¹¶å‘è°ƒç”¨çš„æ‰§è¡Œå‡½æ•° executeï¼Œè¦æ±‚å®ç°ä»¥ä¸‹é€»è¾‘ï¼š

1. executeå¹¶å‘è°ƒç”¨æ¬¡æ•°ä¸è¶…è¿‡10
2. ä»¥æœ€å¿«é€Ÿåº¦æ‰§è¡Œå®Œæ‰€æœ‰task
3. ä½¿ç”¨golang

```go
package main

import "sync"

//äºŒã€ç»™å®šåŒ…å« N ä¸ªä»»åŠ¡ task çš„æ•°ç»„ tasks å’Œæ•´æ•° Kï¼Œå’Œä¸€ä¸ªå¯å¹¶å‘è°ƒç”¨çš„æ‰§è¡Œå‡½æ•° executeï¼Œè¦æ±‚å®ç°ä»¥ä¸‹é€»è¾‘ï¼š
//executeå¹¶å‘è°ƒç”¨æ¬¡æ•°ä¸è¶…è¿‡10
//ä»¥æœ€å¿«é€Ÿåº¦æ‰§è¡Œå®Œæ‰€æœ‰task
//ä½¿ç”¨golangçš„channelå®ç°

func foo(tasks []int, execute func(task int)) {
   wg := &sync.WaitGroup{}
   ch := make(chan struct{}, 10)
   for _, task := range tasks {
      ch <- struct{}{}
      wg.Add(1)
      task := task
      go func() {
         execute(task)
         wg.Done()
         <-ch
      }()

   }
   wg.Wait()
}

func execute(task int) {
   println(task)
}
func main() {
   foo([]int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}, execute)
}
```

ç©ºç»“æ„ä½“çš„å®½åº¦æ˜¯0ï¼Œå ç”¨äº†0å­—èŠ‚çš„å†…å­˜ç©ºé—´ã€‚

```go
var s struct{}
fmt.Println(unsafe.Sizeof(s)) // prints 0
```

ç”±äºç©ºç»“æ„ä½“å ç”¨0å­—èŠ‚ï¼Œé‚£ä¹ˆç©ºç»“æ„ä½“ä¹Ÿä¸éœ€è¦å¡«å……å­—èŠ‚ã€‚æ‰€ä»¥ç©ºç»“æ„ä½“ç»„æˆçš„ç»„åˆæ•°æ®ç±»å‹ä¹Ÿä¸ä¼šå ç”¨å†…å­˜ç©ºé—´ã€‚

```go
type S struct {   
    A struct{}
    B struct{}
}
var s S
fmt.Println(unsafe.Sizeof(s)) // prints 0
```


chan struct{}é€šè¿‡æ¶ˆæ¯æ¥å…±äº«æ•°æ®æ˜¯golçš„ä¸€ç§è®¾è®¡å“²å­¦ï¼Œchannelåˆ™æ˜¯è¿™ç§å“²ç†çš„ä½“ç°ã€‚

golangä¸­çš„ç©ºç»“æ„ä½“ **channel := make(chan struct{},10)**

ç‰¹ç‚¹

1. çœå†…å­˜ï¼Œå°¤å…¶åœ¨äº‹ä»¶é€šä¿¡çš„æ—¶å€™ã€‚
2. structé›¶å€¼å°±æ˜¯æœ¬èº«ï¼Œè¯»å–closeçš„channelè¿”å›é›¶å€¼

é€šå¸¸struct{}ç±»å‹channelçš„ç”¨æ³•æ˜¯ä½¿ç”¨åŒæ­¥ï¼Œä¸€èˆ¬ä¸éœ€è¦å¾€channelé‡Œé¢å†™æ•°æ®ï¼Œåªæœ‰è¯»ç­‰å¾…ï¼Œè€Œè¯»ç­‰å¾…ä¼šåœ¨channelè¢«å…³é—­çš„æ—¶å€™è¿”å›ã€‚

## day-seven



## day-eight

### ä¸€ã€ã€å•é€‰ã€‘ä»¥ä¸‹æè¿°æ­£ç¡®çš„æ˜¯ï¼š

a. è¡¨è¾¾å¼å’Œè¿ç®—ç¬¦éƒ½æ˜¯æ‰§è¡Œè®¡åˆ’çš„ç»„æˆéƒ¨åˆ†ã€‚
 b. åœ¨ç«å±±æ¨¡å‹ä¸­ï¼Œæ‰§è¡Œè®¡åˆ’å­èŠ‚ç‚¹å¯¹åº”çš„è¿ç®—ç¬¦æ‰§è¡Œå®Œæˆåï¼Œçˆ¶èŠ‚ç‚¹å¯¹åº”çš„è¿ç®—ç¬¦æ‰èƒ½å¼€å§‹æ‰§è¡Œã€‚
 c. æ’åºç®—æ³•ä»…ä»…åœ¨ Sort è¿ç®—ç¬¦ä¸­ä½¿ç”¨ã€‚
 d. å½“ä½¿ç”¨ Index Scan çš„æ—¶å€™ï¼Œä»»ä½•æƒ…å†µä¸‹éƒ½éœ€è¦å†å›è¡¨è¯»å–æ•°æ®ã€‚



### äºŒã€æŸåº”ç”¨éœ€è¦ä¸€ä¸ªå¯é çš„å®¡æ ¸ç®¡é“ï¼Œä¸ºå¤§é‡ç”¨æˆ·æä¾›æ–‡ç« çš„å®¡æ ¸å…¥å£ï¼Œå¹¶å¯¹æ¥äº†ä¸“ä¸šçš„æ–‡ç« å®¡æ ¸å›¢é˜Ÿï¼Œè¯·ä¸ºè¯¥ç®¡é“è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚ã€å®ç°ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„ç¯å½¢é˜Ÿåˆ—ã€‘

**è¦æ±‚ï¼š**

- å› ä¸ºå®¡æ ¸å›¢é˜Ÿçš„äººåŠ›æœ‰é™ï¼Œç®¡é“è¦èµ·åˆ°æµé‡æ§åˆ¶ä½œç”¨ï¼Œæ»¡äº†ä¹‹åæ–‡ç« æ— æ³•æäº¤å®¡æ ¸
- é«˜å³°æœŸæ—¶ï¼Œå¤šç¯‡æ–‡ç« åŒæ—¶é€å®¡çš„äº‹æƒ…å¸¸æœ‰å‘ç”Ÿï¼Œå®¡æ ¸å›¢é˜Ÿçš„å¤šä½åŒå­¦ä¹Ÿå¯èƒ½åŒæ—¶å®¡æ ¸æ–‡ç« 
- å…ˆæäº¤é€å®¡çš„æ–‡ç« åº”å…ˆè¢«å®¡æ ¸
- è¿›å…¥å®¡æ ¸ç®¡é“çš„æ–‡ç« ä¸èƒ½é—å¤±ã€é‡å¤
- æ¯å¤©æœ‰å¤§é‡çš„æ–‡ç« é€å®¡ï¼Œè¦å°½å¯èƒ½èŠ‚çœå®¡æ ¸ç®¡é“çš„å¼€é”€

ç®€å•ä½¿ç”¨chanå°±å¯ä»¥å®Œæˆï¼Œchanæœ¬æ¥å°±æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œä½†æ˜¯å¯èƒ½æ€§èƒ½ä¸æ˜¯å¾ˆå¥½ã€‚
åŒæ—¶é€å®¡å°±åƒåŒæ—¶å¾€é‡Œé¢pushï¼Œ
åŒæ—¶å®¡æ ¸å°±æ˜¯åŒæ—¶pop
chanå°±æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œå¦‚æœé€šé“ä¸­çš„ç¼“å­˜å·²æ»¡ï¼Œä¹‹åé€æ¥çš„éƒ½ä¼šè¢«é˜»å¡ã€‚

ä½†æ˜¯ç›®å‰çš„è¿›å…¥å®¡æ ¸ç®¡é“çš„å†…å®¹ä¸èƒ½é‡å¤ï¼Œè¿™ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ã€‚

```go
type Content struct {
	foo string
}

type Queue struct {
	ch chan Content
}

func NewQueue(bufSize int) *Queue {
	return &Queue{
		ch: make(chan Content, bufSize),
	}
}

func (q *Queue) Push(c Content) {
	q.ch <- c
}

func (q *Queue) Pop() Content {
	return <-q.ch
}
```

```go
import (
	"strconv"
	"testing"
)

func BenchmarkNewQueue(b *testing.B) {
	bufSize := 10
	q := NewQueue(bufSize)
	for i := 0; i < b.N; i++ {
		i := i
		go func() {
			q.Push(Content{foo: strconv.Itoa(i)})
		}()
	}
	for i := 0; i < b.N; i++ {
		go func() {
			q.Pop()
		}()
	}
}

```

æ‰‹å†™å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—

```go
package exp8

import (
	"fmt"
	"log"
	"sync"
)

type Content struct {
	foo string
}

type Queue struct {
	ch       []Content           // å¤„ç†çš„å†…å®¹
	index    int                 // ä¸‹ä¸€ä¸ªè¦æ”¾çš„çš„ä½ç½®
	tail     int                 // å½“å‰é˜Ÿåˆ—çš„å°¾éƒ¨
	mutex    sync.Mutex          // äº’æ–¥é”
	auditing map[string]struct{} // å·²ç»å¤„ç†è¿‡çš„å†…å®¹
	size     int                 // é˜Ÿåˆ—çš„å¤§å°
}

func NewQueue(bufSize int) *Queue {
	return &Queue{
		ch:       make([]Content, bufSize),
		auditing: make(map[string]struct{}, bufSize),
		size:     bufSize,
		index:    0,
		tail:     0,
	}
}

func (q *Queue) Push(c Content) error {
	q.mutex.Lock()
	defer q.mutex.Unlock()
	// å¦‚æœå·²ç»åœ¨é˜Ÿåˆ—ä¸­äº†ï¼Œå¿½ç•¥
	if _, ok := q.auditing[c.foo]; ok {
		return fmt.Errorf("error: %s already in queue", c.foo)
	}
	// å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œå¿½ç•¥
	if (q.index+1)%q.size == q.tail {
		return fmt.Errorf("error: queue is full")
	}
	q.ch[q.index] = c
	q.auditing[c.foo] = struct{}{}
	q.index = (q.index + 1) % q.size
	log.Print("push: ", c.foo, " index:", q.index, " tail:", q.tail, " content:", q.ch)
	return nil
}

func (q *Queue) Pop() (Content, error) {
	q.mutex.Lock()
	defer q.mutex.Unlock()
	// å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œå¿½ç•¥
	if q.tail == q.index {
		return Content{}, fmt.Errorf("error: queue is empty")
	}
	c := q.ch[q.tail]
	q.ch[q.tail] = Content{}
	delete(q.auditing, c.foo)

	q.tail = (q.tail + 1) % q.size
	log.Print("pop: ", c.foo, " index:", q.index, " tail:", q.tail)
	return c, nil
}

```

æµ‹è¯•

```go
package exp8

import (
	"strconv"
	"sync"
	"testing"
)

func BenchmarkNewQueue(b *testing.B) {
	bufSize := 10
	q := NewQueue(bufSize)
	b.Log(b.N)
	for i := 0; i < b.N; i++ {
		i := i
		go func() {
			q.Push(Content{foo: strconv.Itoa(i)})
		}()
	}
	for i := 0; i < b.N; i++ {
		go func() {
			b.Log(q.Pop())
		}()
	}
}

func TestNewQueue(t *testing.T) {
	q := NewQueue(10)
	n := 100
	wg := &sync.WaitGroup{}
	for i := 0; i < n; i++ {
		i := i
		wg.Add(1)
		go func() {
			c, err := q.Pop()
			if err != nil {
				t.Log(err)
			} else {
				t.Logf("get %v", c)
			}
			wg.Done()
		}()
		// æ¶ˆè´¹è€…å¤šäºç”Ÿäº§è€…ï¼Œé˜Ÿåˆ—ä¼šä¸ºç©ºç­‰å¾…
		if i%2 == 0 {
			wg.Add(1)
			go func() {
				err := q.Push(Content{foo: strconv.Itoa(i % 10)})
				if err != nil {
					t.Log(err)
				} else {
					t.Logf("push %d", i%10)
				}
				wg.Done()
			}()
		}

	}
	wg.Wait()
}

```

æµ‹è¯•ç»“æœ

```powershell
=== RUN   TestNewQueue
    chan_test.go:36: error: queue is empty
    chan_test.go:36: error: queue is empty
    chan_test.go:36: error: queue is empty
    chan_test.go:36: error: queue is empty
2022/04/21 14:19:51 push: 0 index:1 tail:0 content:[{0} {} {} {} {} {} {} {} {} {}]
    chan_test.go:49: push 0
2022/04/21 14:19:51 pop: 0 index:1 tail:1
    chan_test.go:38: get {0}
    chan_test.go:36: error: queue is empty
2022/04/21 14:19:51 push: 4 index:2 tail:1 content:[{} {4} {} {} {} {} {} {} {} {}]
    chan_test.go:49: push 4
2022/04/21 14:19:51 pop: 4 index:2 tail:2
    chan_test.go:38: get {4}
    chan_test.go:36: error: queue is empty
...
```



## å‚è€ƒ

[(21æ¡æ¶ˆæ¯) go test åŸºæœ¬çŸ¥è¯†ç†è§£_çº¢é²¤é±¼ä¸ç»¿é²¤é±¼ä¸é©´__çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/zy13270867781/article/details/90770856)

[2.2. å‡½æ•°å£°æ˜ (woodpecker.org.cn)](https://www.woodpecker.org.cn/diveintopython/getting_to_know_python/declaring_functions.html)

[å…¨é¢ç†è§£Pythonä¸­çš„ç±»å‹æç¤ºï¼ˆType Hintsï¼‰ - äº¤æµ_QQ_2240410488 - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/jfdwd/p/11208998.html)