---
title: "ã€ç¬¬ä¸‰å±Šå­—èŠ‚è·³åŠ¨é’è®­è¥ï½œåˆ·é¢˜æ‰“å¡ã€‘DAY1"
date: 2022-04-19T19:00:39+08:00
draft: false
slug: 7983d51f
tags: ["é¢è¯•","Go"]
categories: ["é¢è¯•"]
featured: false 
comment: false 
toc: true 
diagram: true 
series: [ "ç¬¬ä¸‰å±Šå­—èŠ‚è·³åŠ¨é’è®­è¥" ] 
pinned: false
weight: 100
---

ã€ç¬¬ä¸‰å±Šå­—èŠ‚è·³åŠ¨é’è®­è¥ï½œåˆ·é¢˜æ‰“å¡ã€‘DAY1

<!--more-->

### ã€å¤šé€‰ã€‘Golang é€šè¿‡`plugin.(*Plugin).Lookup`å‡½æ•°å¯ä»¥æŸ¥æ‰¾åˆ°æ’ä»¶é‡Œé¢å®šä¹‰çš„å“ªäº›ä¸œè¥¿ï¼Ÿ

A. å˜é‡				B. å‡½æ•°
C. ç±»å‹				D. åŒ…

#### è‡ªå·±ç­”æ¡ˆ

ç­”æ¡ˆ: ab æ¥æº`src/plugin/plugin.go:35`

```go
 // A symbol is any exported variable or function.
 func (p *Plugin) Lookup(symName string) (Symbol, error) {
    return lookup(p, symName)
 }
```

#### å®˜æ–¹è§£æ

`a`å’Œ`b`éƒ½æ˜¯èƒ½è¢«èµ‹å€¼ç»™`interface{}`ç±»å‹çš„å˜é‡ï¼Œä½†æ˜¯`c`å’Œ`d`ä¸èƒ½ã€‚å› æ­¤`Lookup`æ–¹æ³•è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª`interface{}`ç±»å‹ï¼ˆ`Symbol`ç±»å‹ï¼‰çš„å˜é‡ï¼Œå› æ­¤`c`å’Œ`d`ä¸èƒ½é€šè¿‡`Lookup`è¿”å›ã€‚

[Goè¿›é˜¶25:Goæ’ä»¶pluginæ•™ç¨‹ | ğŸ¶â¤ï¸ğŸ¦€ (mojotv.cn)](https://link.juejin.cn/?target=https%3A%2F%2Fmojotv.cn%2Fgo%2Fgolang-plugin-tutorial)è¿™ç¯‡æ–‡ç« ä»‹ç»äº†pluginã€‚

### å‡å¦‚åœ¨æŠ–éŸ³ä¸­å‘å¸ƒè§†é¢‘æ—¶ï¼Œå¯ä»¥é€‰æ‹©å¸¦ä¸Šä½ç½®ä¿¡æ¯ï¼Œè¯·è®¾è®¡ä¸€ç§æ•°æ®ç»“æ„æˆ–æ–¹æ¡ˆï¼Œç”¨äºå­˜å‚¨æ£€ç´¢ä½ç½®ä¿¡æ¯ï¼ˆç®€åŒ–ä¸ºå¹³é¢åæ ‡ x, yï¼‰ï¼Œä»¥å®ç°æœç´¢é™„è¿‘è§†é¢‘çš„åŠŸèƒ½ï¼ˆå¦‚é™„è¿‘ 3kmï¼‰

#### è‡ªå·±ç­”æ¡ˆ

ä½¿ç”¨äº†GeohashåŸç†ã€‚é¡ºä¾¿äº†è§£ä¸€ä¸‹Geohashçš„åŸç†ã€‚

å¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹åé¢çš„å‚è€ƒæ–‡ç« ï¼Œä»¥ä¸‹å†…å®¹éƒ½æ˜¯ä»å‚è€ƒæ–‡ç« ä¸­æ‘˜å½•å‡ºæ¥ï¼Œæ–¹ä¾¿ç†è§£ç”¨çš„ã€‚

#### ä»‹ç»

é¦–å…ˆï¼ŒGeoHashç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºXå’ŒYä¸¤ä¸ªåæ ‡ã€‚æŸäº›æƒ…å†µä¸‹æ— æ³•åœ¨ä¸¤åˆ—ä¸ŠåŒæ—¶åº”ç”¨ç´¢å¼•ï¼Œåˆ©ç”¨GeoHashã€‚åªéœ€è¦åœ¨ä¸€åˆ—ä¸Šåº”ç”¨ç´¢å¼•å³å¯ã€‚

GeoHashæœ¬è´¨ä¸Šæ˜¯ç©ºé—´ç´¢å¼•çš„ä¸€ç§æ–¹å¼ï¼Œå…¶åŸºæœ¬åŸç†æ˜¯å°†åœ°çƒç†è§£ä¸ºä¸€ä¸ªäºŒç»´å¹³é¢ï¼Œå°†å¹³é¢é€’å½’åˆ†è§£æˆæ›´å°çš„å­å—ï¼Œæ¯ä¸ªå­å—åœ¨ä¸€å®šç»çº¬åº¦èŒƒå›´å†…æ‹¥æœ‰ç›¸åŒçš„ç¼–ç ã€‚ä»¥GeoHashæ–¹å¼å»ºç«‹ç©ºé—´ç´¢å¼•ï¼Œå¯ä»¥æé«˜å¯¹ç©ºé—´poi([POIæ•°æ®ä»‹ç» - çŸ¥ä¹ (zhihu.com)](https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F364102315))æ•°æ®è¿›è¡Œç»çº¬åº¦æ£€ç´¢çš„æ•ˆç‡ã€‚

ç»åº¦èŒƒå›´æ˜¯ä¸œç»180åˆ°è¥¿ç»180ï¼Œçº¬åº¦èŒƒå›´æ˜¯å—çº¬90åˆ°åŒ—çº¬90ï¼Œæˆ‘ä»¬è®¾å®šè¥¿ç»ä¸ºè´Ÿï¼Œå—çº¬ä¸ºè´Ÿï¼Œæ‰€ä»¥åœ°çƒä¸Šçš„ç»åº¦èŒƒå›´å°±æ˜¯[-180ï¼Œ 180]ï¼Œçº¬åº¦èŒƒå›´å°±æ˜¯[-90ï¼Œ90]ã€‚å¦‚æœä»¥æœ¬åˆå­åˆçº¿ã€èµ¤é“ä¸ºç•Œï¼Œåœ°çƒå¯ä»¥åˆ†æˆ4ä¸ªéƒ¨åˆ†ã€‚

å¦‚æœçº¬åº¦èŒƒå›´[-90Â°, 0Â°)ç”¨äºŒè¿›åˆ¶0ä»£è¡¨ï¼Œï¼ˆ0Â°, 90Â°]ç”¨äºŒè¿›åˆ¶1ä»£è¡¨ï¼Œç»åº¦èŒƒå›´[-180Â°, 0Â°)ç”¨äºŒè¿›åˆ¶0ä»£è¡¨ï¼Œï¼ˆ0Â°, 180Â°]ç”¨äºŒè¿›åˆ¶1ä»£è¡¨ï¼Œé‚£ä¹ˆåœ°çƒå¯ä»¥åˆ†æˆå¦‚ä¸‹4ä¸ªéƒ¨åˆ†

![image-20220408145056064.png](index/811302988b9a4ab988e500196922ca08tplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp)

å¦‚æœåœ¨å°å—èŒƒå›´å†…é€’å½’å¯¹åŠåˆ’åˆ†å‘¢ï¼Ÿ

![image-20220408145141283.png](index/ef35f95a37794b78b24c85535260414btplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp)

å¯ä»¥çœ‹åˆ°ï¼Œåˆ’åˆ†çš„åŒºåŸŸæ›´å¤šäº†ï¼Œä¹Ÿæ›´ç²¾ç¡®äº†ã€‚geohashç®—æ³•å°±æ˜¯åŸºäºè¿™ç§æ€æƒ³ï¼Œåˆ’åˆ†çš„æ¬¡æ•°æ›´å¤šï¼ŒåŒºåŸŸæ›´å¤šï¼ŒåŒºåŸŸé¢ç§¯æ›´å°äº†ã€‚é€šè¿‡å°†ç»çº¬åº¦ç¼–ç ï¼Œç»™åœ°ç†ä½ç½®åˆ†åŒºã€‚

#### å®ç°

Geohashç®—æ³•ä¸€å…±æœ‰ä¸‰æ­¥ã€‚

##### é¦–å…ˆå°†åæ ‡å˜æˆäºŒè¿›åˆ¶

è¿™é‡Œä¸ºäº†ç®€åŒ–æ–‡ç« ä¸­çš„ç»çº¬åº¦çš„æè¿°ï¼Œæ”¹ä¸ºå¹³é¢ç›´è§’åæ ‡ç³»çš„åæ ‡ä¸ºæè¿°ã€‚æ­¤æ—¶xçš„èŒƒå›´æ˜¯ï¼ˆ-90ï¼Œ90ï¼‰ï¼Œyçš„èŒƒå›´æ˜¯ï¼ˆ-180ï¼Œ180ï¼‰

æ¯”å¦‚è¿™æ ·ä¸€ä¸ªç‚¹ **ï¼ˆ39.923201, 116.390705**ï¼‰ã€‚xçš„èŒƒå›´ï¼ˆ-90ï¼Œ90ï¼‰ï¼Œå…¶ä¸­é—´å€¼ä¸º0ã€‚å¯¹äºçº¬åº¦39.923201ï¼Œåœ¨åŒºé—´ï¼ˆ0ï¼Œ90ï¼‰ä¸­ï¼Œå› æ­¤å¾—åˆ°ä¸€ä¸ª1ï¼›ï¼ˆ0ï¼Œ90ï¼‰åŒºé—´çš„ä¸­é—´å€¼ä¸º45åº¦ï¼Œçº¬åº¦39.923201å°äº45ï¼Œå› æ­¤å¾—åˆ°ä¸€ä¸ª0ï¼Œä¾æ¬¡è®¡ç®—ä¸‹å»ï¼Œå³å¯å¾—åˆ°åæ ‡xçš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå¦‚ä¸‹è¡¨ï¼š

| x         | 0åŒºé—´         | 1åŒºé—´      | 39.923201 |
| --------- | ------------- | ---------- | --------- |
| -90ï¼Œ90   | -90ï¼Œ0        | 0ï¼Œ90      | 1         |
| 0ï¼Œ90     | 0ï¼Œ45         | 45ï¼Œ90     | 0         |
| 0ï¼Œ45     | 0ï¼Œ22.5       | 22.5ï¼Œ45   | 1         |
| 22.5ï¼Œ45  | 22.5ï¼Œ33.75   | 33.75ï¼Œ45  | 1         |
| 33.75ï¼Œ45 | 33.75ï¼Œ39.375 | 39.375ï¼Œ45 | 1         |
| ...       | ...           | ...        | ...       |

å¦‚æœæˆ‘ä»¬æƒ³è¦æ›´ç²¾ç¡®çš„åæ ‡å¯ä»¥ä¸€ç›´åˆ†ä¸‹å»ï¼Œç›´åˆ°æ»¡è¶³è‡ªå·±çš„è¦æ±‚ä¸ºæ­¢ã€‚`10111000110001111001`

åŒç†æˆ‘ä»¬å¯ä»¥å¯¹yåæ ‡ä¹Ÿè¿›è¡Œå¤„ç†ã€‚

| y          | 0åŒºé—´         | 1åŒºé—´       | 116.390705 |
| ---------- | ------------- | ----------- | ---------- |
| -180ï¼Œ180  | 180ï¼Œ0        | 0ï¼Œ180      | 1          |
| 0ï¼Œ180     | 0ï¼Œ90         | 90ï¼Œ180     | 1          |
| 90ï¼Œ180    | 90ï¼Œ135       | 135ï¼Œ180    | 0          |
| 90ï¼Œ135    | 90ï¼Œ112.5     | 112.5ï¼Œ135  | 1          |
| 112.5ï¼Œ135 | 112.5ï¼Œ123.75 | 123.75ï¼Œ135 | 0          |
| ...        | ...           | ...         | ...        |

å¾—åˆ°`11010010110001000100`

##### å°†äºŒè¿›åˆ¶åˆå¹¶

Xåæ ‡å å¶æ•°ä½ï¼ŒYå å¥‡æ•°ä½ï¼Œæ³¨æ„ï¼Œ0ä¹Ÿæ˜¯å¶æ•°ä½ã€‚

```
 11100 11101 00100 01111 00000 01101 01011 00001
å¤åˆ¶ä»£ç 
```

##### æŒ‰ç…§Base32è¿›è¡Œç¼–ç 

Base32ç¼–ç è¡¨çš„å…¶ä¸­ä¸€ç§å¦‚ä¸‹ï¼Œæ˜¯ç”¨0-9ã€b-zï¼ˆå»æ‰a, i, l, oï¼‰è¿™32ä¸ªå­—æ¯è¿›è¡Œç¼–ç ã€‚å…·ä½“æ“ä½œæ˜¯å…ˆå°†ä¸Šä¸€æ­¥å¾—åˆ°çš„åˆå¹¶åäºŒè¿›åˆ¶è½¬æ¢ä¸º10è¿›åˆ¶æ•°æ®ï¼Œç„¶åå¯¹åº”ç”ŸæˆBase32ç ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°†5ä¸ªäºŒè¿›åˆ¶ä½è½¬æ¢æˆä¸€ä¸ªbase32ç ã€‚ä¸Šä¾‹æœ€ç»ˆå¾—åˆ°çš„å€¼ä¸ºï¼š`wx4g0ec1`

| åè¿›åˆ¶ | 0    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   | 11   | 12   | 13   | 14   | 15   |
| ------ | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| base32 | 0    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | b    | c    | d    | e    | f    | g    |
| åè¿›åˆ¶ | 16   | 17   | 18   | 19   | 20   | 21   | 22   | 23   | 24   | 25   | 26   | 27   | 28   | 29   | 30   | 31   |
| base32 | h    | j    | k    | m    | n    | p    | q    | r    | s    | t    | u    | v    | w    | x    | y    | z    |

- Geohashæ¯”ç›´æ¥ç”¨ç»çº¬åº¦çš„é«˜æ•ˆå¾ˆå¤šï¼Œè€Œä¸”ä½¿ç”¨è€…å¯ä»¥å‘å¸ƒåœ°å€ç¼–ç ï¼Œæ—¢èƒ½è¡¨æ˜è‡ªå·±ä½äºåŒ—æµ·å…¬å›­é™„è¿‘ï¼Œåˆä¸è‡³äºæš´éœ²è‡ªå·±çš„ç²¾ç¡®åæ ‡ï¼Œæœ‰åŠ©äºéšç§ä¿æŠ¤ã€‚
- GeoHashç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºç»åº¦å’Œçº¬åº¦ä¸¤ä¸ªåæ ‡ã€‚åœ¨æ•°æ®åº“ä¸­å¯ä»¥å®ç°åœ¨ä¸€åˆ—ä¸Šåº”ç”¨ç´¢å¼•ï¼ˆæŸäº›æƒ…å†µä¸‹æ— æ³•åœ¨ä¸¤åˆ—ä¸ŠåŒæ—¶åº”ç”¨ç´¢å¼•ï¼‰
- GeoHashè¡¨ç¤ºçš„å¹¶ä¸æ˜¯ä¸€ä¸ªç‚¹ï¼Œè€Œæ˜¯ä¸€ä¸ªçŸ©å½¢åŒºåŸŸ
- GeoHashç¼–ç çš„å‰ç¼€å¯ä»¥è¡¨ç¤ºæ›´å¤§çš„åŒºåŸŸã€‚ä¾‹å¦‚wx4g0ec1ï¼Œå®ƒçš„å‰ç¼€wx4g0eè¡¨ç¤ºåŒ…å«ç¼–ç wx4g0ec1åœ¨å†…çš„æ›´å¤§èŒƒå›´ã€‚ è¿™ä¸ªç‰¹æ€§å¯ä»¥ç”¨äºé™„è¿‘åœ°ç‚¹æœç´¢

ç¼–ç è¶Šé•¿ï¼Œè¡¨ç¤ºçš„èŒƒå›´è¶Šå°ï¼Œä½ç½®ä¹Ÿè¶Šç²¾ç¡®ã€‚å› æ­¤æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ¯”è¾ƒGeoHashåŒ¹é…çš„ä½æ•°æ¥åˆ¤æ–­ä¸¤ä¸ªç‚¹ä¹‹é—´çš„å¤§æ¦‚è·ç¦»ã€‚

![image-20220408155639181.png](index/77f084a17c2441b491d639b40421c1d8tplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp)

#### é—®é¢˜

geohashç®—æ³•æœ‰ä¸¤ä¸ªé—®é¢˜ã€‚

##### è¾¹ç¼˜é—®é¢˜

![image-20220408160032211.png](index/6ee68c6950bc47f381ca4c13015218f6tplv-k3u1fbpfcp-zoom-in-crop-mark1304000.awebp) å¦‚å›¾ï¼Œå¦‚æœè½¦åœ¨çº¢ç‚¹ä½ç½®ï¼ŒåŒºåŸŸå†…è¿˜æœ‰ä¸€ä¸ªé»„ç‚¹ã€‚ç›¸é‚»åŒºåŸŸå†…çš„ç»¿ç‚¹æ˜æ˜¾ç¦»çº¢ç‚¹æ›´è¿‘ã€‚ä½†å› ä¸ºé»„ç‚¹çš„ç¼–ç å’Œçº¢ç‚¹ä¸€æ ·ï¼Œæœ€ç»ˆæ‰¾åˆ°çš„å°†æ˜¯é»„ç‚¹ã€‚è¿™å°±æœ‰é—®é¢˜äº†ã€‚

è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¾ˆç®€å•ï¼Œåªè¦å†æŸ¥æ‰¾å‘¨è¾¹8ä¸ªåŒºåŸŸå†…çš„ç‚¹ï¼Œçœ‹å“ªä¸ªç¦»è‡ªå·±æ›´è¿‘å³å¯ã€‚

###### æ›²çº¿çªå˜

æœ¬æ–‡ç¬¬2å¼ å›¾ç‰‡æ¯”è¾ƒå¥½åœ°è§£é‡Šäº†è¿™ä¸ªé—®é¢˜ã€‚å…¶ä¸­0111å’Œ1000ä¸¤ä¸ªç¼–ç éå¸¸ç›¸è¿‘ï¼Œä½†å®ƒä»¬çš„å®é™…è·ç¦»ç¡®å¾ˆè¿œã€‚æ‰€ä»¥ç¼–ç ç›¸è¿‘çš„ä¸¤ä¸ªå•ä½ï¼Œå¹¶ä¸ä¸€å®šçœŸå®è·ç¦»å¾ˆè¿‘ï¼Œè¿™éœ€è¦å®é™…è®¡ç®—ä¸¤ä¸ªç‚¹çš„è·ç¦»æ‰è¡Œã€‚

#### å®˜æ–¹è§£æ

åæ ‡èŒƒå›´æ£€ç´¢ï¼Œæœ‰å››å‰æ ‘ã€geohash ç­‰å‡ ç§æ ‡å‡†è§£æ³•ã€‚è¿™é“é¢˜æœ¬è´¨**å¹¶ä¸æ˜¯**è€ƒå¯Ÿå¯¹é«˜é˜¶ç®—æ³•çš„æŒæ¡ï¼Œè€Œæ˜¯æƒ³å‘æ˜åœ¨å­¦ä¹ æ•™æ btree ç­‰åŸºç¡€äºŒåˆ†æ€æƒ³åï¼Œèƒ½å¦è¿›ä¸€æ­¥æ€è€ƒè§£å‡ºæ›´å¤æ‚çš„é—®é¢˜ï¼›
 å¦å¤–è€ƒå¯Ÿæ€ç»´çµæ´»ç¨‹åº¦ï¼Œçœ‹æ˜¯å¦èƒ½å˜é€šçš„è§£å†³é—®é¢˜ï¼Œå¦‚è·ç¦»å¹¶æ²¡æœ‰é™å®šå¿…é¡»æ˜¯**æ¬§å¼è·ç¦»**ï¼›ä½ç½®å¯ä»¥ä¸ç²¾ç¡®ï¼Œå¯ä»¥å®¹å¿æœ‰è¯¯å·®ç­‰ã€‚

- **æ–¹æ³• 1ï¼Œå››å‰æ ‘ï¼ˆQTreeï¼‰**ï¼šåœ¨äºŒå‰æ ‘å·¦ã€å³èŠ‚ç‚¹çš„æ€æƒ³ä¸‹ï¼ŒåŠ å…¥ä¸Šã€ä¸‹ã€å‰ã€åç­‰æ›´å¤šçš„æ–¹å‘ï¼Œæ¼”è¿›ä¸ºå››å‰æ ‘å’Œå…«å‰æ ‘ã€‚é«˜é˜¶æ ‘æ¯”è¾ƒè¶…çº²ï¼Œç›¸å…³å®ç°çœç•¥ã€‚å››å‰æ ‘æ‰¾åˆ°å‘¨å›´çš„ç¯ç»•çš„ç‚¹åº”è¯¥æ˜¯æœ€å¿«çš„ã€‚
- **æ–¹æ³• 2ï¼Œgeohash**ï¼šæŠŠäºŒç»´é—®é¢˜é™ä¸ºä¸€ç»´
   å¦‚åæ ‡ï¼ˆç¤ºä¾‹éæ ‡å‡† geohashï¼Œåªæ˜¯æ¼”ç¤ºäº†æ€æƒ³ï¼‰ï¼š
   (12, 345) -> (**0**12, 345) -> "031425"
   (13, 348) -> (**0**13, 348) -> "031438"
   (2, 789) -> (**00**2, 789) -> "070829"
   æœ€ç»ˆåšå­—ç¬¦ä¸²å‰ç¼€åŒ¹é…ï¼Œå¯å¾— "031425" å’Œ "031438" åŒ¹é…åˆ°çš„ä½æ•°æœ€å¤šï¼ŒäºŒè€…è·ç¦»æœ€è¿‘ã€‚æ±‚ 3km å†…çš„åæ ‡ï¼Œåªéœ€æå‰ç®—å‡ºéœ€åŒ¹é…å‰å‡ ä½å³å¯ï¼Œå¦‚åŒ¹é…å‰ 4 ä½ï¼ŒæŒ‰ sql è¡¨è¾¾æ˜¯ LIKE '0314%'
- **æ–¹æ³• 3ï¼Œå˜é€šè·ç¦»ä¸º æ–¹åœ† 3kmï¼ˆæ›¼å“ˆé¡¿è·ç¦»ï¼‰**ï¼Œå³ deltaX = 1500, deltaY = 1500ï¼Œé€šè¿‡æ•°æ®åº“è§£å†³ Create table tb_name ( x int, y int ) å¹¶æ·»åŠ ç´¢å¼•ã€‚
   å‡å¦‚åŸç‚¹æ˜¯ (x0, y0)ï¼Œsql å¦‚ä¸‹ï¼š
   WHERE (x > x0 - 1500) AND (x < x0 + 1500) AND (y > y0 - 1500) AND (y < y0 + 1500)

### å‚è€ƒ

[ã€ç¬¬ä¸‰å±Šå­—èŠ‚è·³åŠ¨é’è®­è¥ï½œåˆ·é¢˜æ‰“å¡ã€‘DAY1 - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7083792721265033229)
