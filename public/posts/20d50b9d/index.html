<!doctype html><html class="position-relative" itemscope itemtype="http://schema.org/WebPage" lang="zh-cn"
  
   data-palette="blue"
  >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>从Goland转到Neovim - 步履不停</title><link rel="apple-touch-icon" href="/images/icons/icon-180x180.png" sizes="180x180">
<link rel="icon" href="/images/icons/icon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/images/icons/icon-16x16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/images/icons/favicon.ico">
<link rel="manifest" href="/manifest.json">
<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>

<meta name="keywords" content="" />
<meta name="description" content="介绍我从 Goland 转到 Neovim的原因以及相关的配置过程。" /><meta name="robots" content="index, follow" /><meta itemprop="name" content="从Goland转到Neovim">
<meta itemprop="description" content="介绍我从 Goland 转到 Neovim的原因以及相关的配置过程。"><meta itemprop="datePublished" content="2022-07-18T23:50:49+08:00" />
<meta itemprop="dateModified" content="2022-07-18T23:50:49+08:00" />
<meta itemprop="wordCount" content="21126">
<meta itemprop="keywords" content="教程," /><meta property="og:title" content="从Goland转到Neovim" />
<meta property="og:description" content="介绍我从 Goland 转到 Neovim的原因以及相关的配置过程。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/20d50b9d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-18T23:50:49+08:00" />
<meta property="article:modified_time" content="2022-07-18T23:50:49+08:00" /><meta property="og:site_name" content="步履不停" />
<meta property="og:see_also" content="/posts/e84c3531/" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="从Goland转到Neovim"/>
<meta name="twitter:description" content="介绍我从 Goland 转到 Neovim的原因以及相关的配置过程。"/>
<meta property="og:image" content="/images/spider-man.jpg"/>
  <meta name="twitter:image" content="/images/spider-man.jpg"/><link rel="stylesheet" href="/assets/main/bundle.min.d09b7f7f687cbba5a0470808fba7973668726b909146fb392a44aa897b257a10.css" integrity="sha256-0Jt/f2h8u6WgRwgI+6eXNmhya5CRRvs5KkSqiXslehA=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/viewer/bundle.min.f05183267bb952fbc8c63a7178364de2951614ab71d544ec1068ad36c7447ccc.css" integrity="sha256-8FGDJnu5UvvIxjpxeDZN4pUWFKtx1UTsEGitNsdEfMw=" crossorigin="anonymous"></head>
  <body><script>const items=['mode','palette'];items.forEach(function(e){const t=localStorage.getItem('hbs-'+e);t&&document.body.parentElement.setAttribute('data-'+e,t)})</script><header><nav class="navbar top-app-bar top-app-bar-expand-lg fixed-top">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button><a class="navbar-brand flex-grow-1 flex-lg-grow-0 text-center text-lg-start mx-auto me-lg-3" href="/"><picture><img class="logo" alt="Logo" src="/images/spider-man.jpg" loading="lazy"
     width="556" height="559"
     />
</picture>
步履不停
    </a>
    <div class="offcanvas offcanvas-bottom surface" tabindex="-1" id="offcanvasSocialShare" aria-labelledby="offcanvasSocialShare">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Share</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body">
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Twitter Share Button"
      target="_blank" href="https://twitter.com/intent/tweet?title=%e4%bb%8eGoland%e8%bd%ac%e5%88%b0Neovim&url=%2fposts%2f20d50b9d%2f">
      <i class="fab fa-fw fa-twitter"></i> Twitter
    </a>
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Facebook Share Button"
      target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=%2fposts%2f20d50b9d%2f">
      <i class="fab fa-fw fa-facebook-f"></i> Facebook
    </a>
  </div>
</div>
    <button class="navbar-settings" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSettings"
  aria-controls="offcanvasSettings" aria-label="Toggle settings">
  <i class="fas fa-ellipsis-v"></i>
</button>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings" aria-labelledby="offcanvasSettings">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">设置</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body d-flex flex-column">

<div class="setting">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-adjust"></i> 模式</label>
    </div>
    <div class="col-auto ms-auto">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="modeSwitcher">
      </div>
    </div>
  </form>
</div>

<div class="setting">
  <form class="font-size-switcher-form row">
    <div class="col-auto">
      <label for="fontSize" class="form-label"><i class="fas fa-fw fa-font"></i> 字体大小</label>
    </div>
    <div class="col-auto ms-auto">
      <input type="range" class="form-range" min="-2" max="2" id="fontSize">
    </div>
  </form>
</div>


<div class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> 配色</label>
    </div>
    <div class="col-auto ms-auto">
      <a id="btnPalette" class="btn btn-sm btn-outline-primary" role="button" aria-label="palettePicker">
        <i class="fas fa-eye-dropper"></i>
      </a>
    </div>
  </form>
  <div class="mt-2 d-flex justify-content-between visually-hidden" id="palettePicker"><button type="button" id="palette-blue" aria-label="蓝色"
        class="btn btn-sm w-100 palette" data-palette="blue">
      </button><button type="button" id="palette-blue-gray" aria-label="蓝灰色"
        class="btn btn-sm w-100 palette" data-palette="blue-gray">
      </button><button type="button" id="palette-brown" aria-label="棕色"
        class="btn btn-sm w-100 palette" data-palette="brown">
      </button><button type="button" id="palette-cyan" aria-label="青色"
        class="btn btn-sm w-100 palette" data-palette="cyan">
      </button><button type="button" id="palette-green" aria-label="绿色"
        class="btn btn-sm w-100 palette" data-palette="green">
      </button><button type="button" id="palette-indigo" aria-label="靛青色"
        class="btn btn-sm w-100 palette" data-palette="indigo">
      </button><button type="button" id="palette-orange" aria-label="橙色"
        class="btn btn-sm w-100 palette" data-palette="orange">
      </button><button type="button" id="palette-pink" aria-label="粉色"
        class="btn btn-sm w-100 palette" data-palette="pink">
      </button><button type="button" id="palette-purple" aria-label="紫色"
        class="btn btn-sm w-100 palette" data-palette="purple">
      </button><button type="button" id="palette-red" aria-label="红色"
        class="btn btn-sm w-100 palette" data-palette="red">
      </button><button type="button" id="palette-teal" aria-label="蓝绿色"
        class="btn btn-sm w-100 palette" data-palette="teal">
      </button><button type="button" id="palette-yellow" aria-label="黄色"
        class="btn btn-sm w-100 palette" data-palette="yellow">
      </button></div>
</div>
<div class="setting actions d-flex justify-content-around mt-auto overflow-auto">
  <a role="button" class="action action-go-back" href="javascript: window.history.back();">
    <span class="action-icon"><i class="fas fa-2x fa-chevron-circle-down" data-fa-transform="rotate-90"></i></span> 返回
  </a>
  <a role="button" class="action action-reload-page">
    <span class="action-icon"><i class="fas fa-2x fa-redo-alt"></i></span> 刷新
  </a>
  <a role="button" class="action action-copy-url">
    <span class="action-icon"><i class="fas fa-2x fa-link"></i></span> 复制链接
  </a><a class="action action-social-share" role="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSocialShare"
    aria-controls="offcanvasSocialShare" aria-label="Toggle social share">
    <span class="action-icon"><i class="fas fa-2x fa-share-alt"></i></span> 分享
  </a></div>

</div>
</div>

    <div class="collapse navbar-collapse" tabindex="-1" id="navbarSupportedContent" aria-labelledby="navbarSupportedContent">
      <form class="search-bar my-1" action="/search">
  <div class="input-group input-group-sm">
    <span class="btn btn-search disabled position-absolute left-0"><i class="fas fa-fw fa-search"></i></span>
    <input class="form-control rounded-pill" name="q" type="search" aria-label="Search">
  </div>
</form>
      <ul class="navbar-nav ms-auto"><li class="nav-item">
          <a class="nav-link" href="/series/">
            <i class="fas fa-fw fa-columns"></i>专栏
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/archives/">
            <i class="fas fa-fw fa-file-archive"></i>归档
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/categories/">
            <i class="fas fa-fw fa-folder"></i>分类
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/tags/">
            <i class="fas fa-fw fa-tags"></i>标签
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdownFriends" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-fw fa-chevron-circle-down"></i>友情链接
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownFriends"><li>
              <a class="dropdown-item"
                href="https://xieash.work/" target="_blank" rel="noopener noreferrer">
                xieash
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://sunnysab.cn/" target="_blank" rel="noopener noreferrer">
                sunnysab
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://wanfengcxz.cn/" target="_blank" rel="noopener noreferrer">
                wanfengcxz
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://zhangzqs.cn/" target="_blank" rel="noopener noreferrer">
                zhangzqs
              </a>
            </li></ul>
        </li><li class="nav-item">
          <a class="nav-link" href="/data">
            资料
          </a>
        </li></ul>
    </div>
  </div>
</nav>
</header>
<main class="container">
      <div class="row content">
<div class="col-lg-8">
  <div class="container"><nav class="row card component" aria-label="breadcrumb">
  <div class="card-body">
    <ol class="breadcrumb "><li class="breadcrumb-item"><a href="/">主页</a></li><li class="breadcrumb-item"><a href="/posts/">Posts</a></li><li class="breadcrumb-item active">从Goland转到Neovim</li></ol>
  </div>
</nav><div class="post-panel-wrapper position-sticky">
  <div class="d-flex flex-column component rounded post-panel position-absolute">
    
    <a class="action action-panel-toggler" role="button" title="Panel toggler">
      <i class="fas fa-fw fa-chevron-circle-down"></i>
    </a>
    <a id="sidebarToggler" class="action d-none d-lg-block" role="button" title="Sidebar toggler">
  <i class="fas fa-fw fa-expand-alt" data-fa-transform="rotate-45"></i>
</a>

    

    
    <a class="action" href="#post-copyright" role="button" aria-label="Copyright" title="Copyright">
  <i class="fas fa-fw fa-copyright"></i>
</a>
    
    <a class="action" href="#postTOC" aria-controls="Table of contents" role="button" title="Table of contents">
  <i class="fas fa-fw fa-list-alt"></i>
</a>
    
  </div>
</div>
<article class="row card component mb-4 post">
  <div class="card-header ">
    <h1 class="card-title post-title">从Goland转到Neovim
</h1>
  </div>
  <div class="card-body"><div class="post-meta">
  <span class="post-date" title="创建于 2022-07-18 23:50:49 &#43;0800 CST。">
    2022-07-18
  </span><span class="post-reading-time">
    43 分钟阅读
  </span><span class="post-taxonomies"><a href="/categories/vim/" class="badge post-taxonomy">vim</a><a href="/categories/nvim/" class="badge post-taxonomy">nvim</a><a href="/series/vim/" class="badge post-taxonomy">vim</a><a href="/tags/%E6%95%99%E7%A8%8B/" class="badge post-taxonomy">教程</a></span>
</div>
<div class="post-content mb-3"><p>介绍我从 Goland 转到 Neovim的原因以及相关的配置过程。</p>
<h1 id="为什么要转到-neovim">为什么要转到 Neovim<a class="anchor ms-1" href="#为什么要转到-neovim"><i class="fas fa-link"></i></a></h1>
<p>我目前实习的公司是没有统一购买 Goland 的 license，如果想要使用 Goland 就要自购买或者破解。公司的同学给了我两个选择</p>
<ul>
<li>自己购买 Goland</li>
<li>使用 VS code</li>
</ul>
<p>对于目前的我来说，购买 Goland 是不太可能的。使用了一段时间的 VS code ，用起来也不错，但还是差点。在 VScode 中装了许多插件，可以与 Goland 使用体验基本一致了。但是，既然都是装插件，为啥不再试试其他的编辑器呢？人生苦短，我选 vim [doge].</p>
<h1 id="在-goland-的中用到的功能">在 Goland 的中用到的功能<a class="anchor ms-1" href="#在-goland-的中用到的功能"><i class="fas fa-link"></i></a></h1>
<ol>
<li>代码高亮、补全、错误检查、格式化</li>
<li>跳转到定义</li>
<li>查找引用</li>
<li>全局查找某些内容</li>
<li>项目查找文件</li>
<li>批量重命名</li>
<li>块选取</li>
<li>显示 当前行时被谁更改的</li>
<li>复制当前行的信息 类似 project/xxx/xx/xxx.go:143</li>
<li>括号补全</li>
<li>同一个文件左右分屏</li>
<li>打开的文件是新的窗口</li>
</ol>
<h1 id="我的配置过程">我的配置过程<a class="anchor ms-1" href="#我的配置过程"><i class="fas fa-link"></i></a></h1>
<h2 id="安装-neovim">安装 Neovim<a class="anchor ms-1" href="#安装-neovim"><i class="fas fa-link"></i></a></h2>
<h3 id="mac">Mac<a class="anchor ms-1" href="#mac"><i class="fas fa-link"></i></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">brew install neovim
</span></span></code></pre></div><h2 id="安装依赖的字体">安装依赖的字体<a class="anchor ms-1" href="#安装依赖的字体"><i class="fas fa-link"></i></a></h2>
<p>在终端中，默认的字体是不支持显示图标的，</p>
<h3 id="mac-1">Mac<a class="anchor ms-1" href="#mac-1"><i class="fas fa-link"></i></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">brew tap homebrew/cask-fonts <span class="o">&amp;&amp;</span> brew install --cask font-fira-code-nerd-font
</span></span></code></pre></div><p><strong>Iterm2 里配置非 acsii 字体</strong> Preferences -&gt; Profiles -&gt; Text -&gt; Non-Ascii-Font 选择 fira-code-nerd-font ，之后重启 Iterm2 生效</p>
<h2 id="配置目录">配置目录<a class="anchor ms-1" href="#配置目录"><i class="fas fa-link"></i></a></h2>
<p>由于会安装很多插件、配置快捷键、UI、高亮等。会涉及到很多内容，如果把所有配置文件写一个文件中， 很乱，不方便管理。我的配置目录如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">├── init.lua
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">├── lua
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">│   ├── basic.lua
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">│   ├── colorscheme.lua
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">│   ├── keybindings.lua
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">│   ├── localconf.lua
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">│   ├── lsp
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">│   │   ├── cmp.lua
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">│   │   ├── config
</span></span><span class="line"><span class="ln">10</span><span class="cl">│   │   │   └── lua.lua
</span></span><span class="line"><span class="ln">11</span><span class="cl">│   │   ├── setup.lua
</span></span><span class="line"><span class="ln">12</span><span class="cl">│   │   └── ui.lua
</span></span><span class="line"><span class="ln">13</span><span class="cl">│   ├── plugin-config
</span></span><span class="line"><span class="ln">14</span><span class="cl">│   │   ...
</span></span><span class="line"><span class="ln">15</span><span class="cl">│   ├── plugins.lua
</span></span><span class="line"><span class="ln">16</span><span class="cl">│   └── utils
</span></span><span class="line"><span class="ln">17</span><span class="cl">└── plugin
</span></span><span class="line"><span class="ln">18</span><span class="cl">    └── packer_compiled.lua
</span></span></code></pre></div><p><strong>init.lua</strong> 是整个配置的入口文件，负责引用所有其他的模块，基本上想要打开或关闭某个插件只要在这里修改一行代码即可。</p>
<ul>
<li>
<p><strong>basic.lua：</strong> 基础配置，是对默认配置的一个重置。例如显示行号，Tab 的长度等</p>
</li>
<li>
<p><strong>colorscheme.lua：</strong> 我们安装的主题皮肤配置，在这里切换主题。</p>
</li>
<li>
<p><strong>keybindings.lua：</strong> 快捷键的设置，所有插件的快捷键也都会放在这里。</p>
</li>
<li>
<p><strong>plugins.lua：</strong> 插件安装管理，插件安装或卸载全在这里设置。</p>
</li>
<li>
<p><strong>lsp 文件夹：</strong> 是对 Neovim 内置 LSP 功能的配置，包括常见编程语言与语法提示等。</p>
<ul>
<li><strong>config</strong> <strong>：</strong> 文件夹包含各种语言服务器单独的配置文件。上面就有一个 <strong>lua.lua</strong> 的文件，就是 <strong>lua</strong> 的 lsp 配置</li>
<li><strong>setup.lua</strong> <strong>：</strong> 内置 LSP 的配置。</li>
<li><strong>cmp.lua</strong> <strong>：</strong> 语法自动补全补全的配置，包括各种补全源，与自定义代码段。</li>
<li><strong>ui.lua：</strong> 对内置 LSP 功能增强和 UI 美化。</li>
<li><strong>formatter.lua：</strong> 独立代码格式化功能（TODO）。</li>
</ul>
</li>
<li>
<p><strong>plugin-config 文件夹：</strong> 是对第三方插件的配置，未来每添加一个插件，这里就多一个配置文件。</p>
</li>
<li>
<p><strong>utils 文件夹：</strong> 是对常见问题的修改，包括输入法切换，针对 windows 的特殊配置等。</p>
</li>
</ul>
<h2 id="配置入口文件">配置入口文件<a class="anchor ms-1" href="#配置入口文件"><i class="fas fa-link"></i></a></h2>
<p><code>Neovim</code>的配置入口文件并不是像<code>vim</code>一样放在用户目录的<code>.vimrc</code>中的，而是在<code>~/.config/nvim/init.lua</code>或<code>init.vim</code>，不过现在推荐使用<code>lua</code>进行编写 这个配置文件的说明在<a href="https://neovim.io/doc/user/starting.html#config" target="_blank" rel="noopener noreferrer">neovim.io</a>中可以看到。</p>
<h2 id="基础配置文件">基础配置文件<a class="anchor ms-1" href="#基础配置文件"><i class="fas fa-link"></i></a></h2>
<p>在 <code>~/.config/nvim/lua/basic.lua</code>  中配置一些基本的配置，会对 <code>Neovim</code> 的默认行为做一些重置。</p>
<h3 id="作用域">作用域<a class="anchor ms-1" href="#作用域"><i class="fas fa-link"></i></a></h3>
<p>首先对配置的作用域做一下声明，可以对多个作用域进行单独的配置，比如希望一个配置在全局生效，还是说只在窗口中生效等等</p>
<ul>
<li>
<p><code>vim.o</code>：普通作用域（common）</p>
</li>
<li>
<p><code>vim.g</code>:  全局作用域</p>
</li>
<li>
<p><code>vim.b</code>：缓冲区作用域（buffer）</p>
</li>
<li>
<p><code>vim.w</code>：窗口作用域（window）</p>
</li>
<li>
<p><code>vim.bo</code>：<code>buffer-local</code>配置项</p>
</li>
<li>
<p><code>vim.wo</code>：<code>window-local</code>配置项</p>
</li>
</ul>
<p>只需要在vim.x. 后面跟上要修改的配置名并赋值即可。（x是作用域）</p>
<p>例如 <code>vim.g.encoding = &quot;UTF-8&quot;</code>  表示：全局的编码方式为<code>UTF-8</code></p>
<h3 id="配置如下">配置如下<a class="anchor ms-1" href="#配置如下"><i class="fas fa-link"></i></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- utf8</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">vim.g</span><span class="p">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s2">&#34;UTF-8&#34;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">fileencoding</span> <span class="o">=</span> <span class="s2">&#34;utf-8&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">-- jkhl 移动时光标周围保留8行</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">scrolloff</span> <span class="o">=</span> <span class="mi">8</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">sidescrolloff</span> <span class="o">=</span> <span class="mi">8</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">-- 使用相对行号</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">vim.wo</span><span class="p">.</span><span class="n">number</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">vim.wo</span><span class="p">.</span><span class="n">relativenumber</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">-- 高亮所在行</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">vim.wo</span><span class="p">.</span><span class="n">cursorline</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1">-- 显示左侧图标指示列</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">vim.wo</span><span class="p">.</span><span class="n">signcolumn</span> <span class="o">=</span> <span class="s2">&#34;yes&#34;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">-- 右侧参考线，超过表示代码太长了，考虑换行</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">vim.wo</span><span class="p">.</span><span class="n">colorcolumn</span> <span class="o">=</span> <span class="s2">&#34;80&#34;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1">-- 缩进4个空格等于一个Tab</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">tabstop</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">shiftwidth</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1">-- &gt;&gt; &lt;&lt; 时移动长度</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">shiftwidth</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="n">vim.bo</span><span class="p">.</span><span class="n">shiftwidth</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="c1">-- 新行对齐当前行</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">autoindent</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="n">vim.bo</span><span class="p">.</span><span class="n">autoindent</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">smartindent</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="c1">-- 搜索大小写不敏感，除非包含大写</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">ignorecase</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">smartcase</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="c1">-- 搜索不要高亮</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">hlsearch</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="c1">-- 边输入边搜索</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">incsearch</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="c1">-- 命令行高为2，提供足够的显示空间</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">cmdheight</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="c1">-- 当文件被外部程序修改时，自动加载</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">autoread</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="n">vim.bo</span><span class="p">.</span><span class="n">autoread</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="c1">-- 禁止折行</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="n">vim.wo</span><span class="p">.</span><span class="n">wrap</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="c1">-- 光标在行首尾时&lt;Left&gt;&lt;Right&gt;可以跳到下一行</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">whichwrap</span> <span class="o">=</span> <span class="s2">&#34;&lt;,&gt;,[,]&#34;</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="c1">-- 允许隐藏被修改过的buffer</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="c1">-- 鼠标支持</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">mouse</span> <span class="o">=</span> <span class="s2">&#34;a&#34;</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="c1">-- 禁止创建备份文件</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">backup</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">writebackup</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">swapfile</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="c1">-- smaller updatetime</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">updatetime</span> <span class="o">=</span> <span class="mi">300</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="c1">-- 设置 timeoutlen 为等待键盘快捷键连击时间500毫秒，可根据需要设置</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="c1">-- 遇到问题详见：https://github.com/nshen/learn-neovim-lua/issues/1</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">timeoutlen</span> <span class="o">=</span> <span class="mi">500</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="c1">-- split window 从下边和右边出现</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">splitbelow</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">splitright</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="c1">-- 自动补全不自动选中</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl"><span class="n">vim.g</span><span class="p">.</span><span class="n">completeopt</span> <span class="o">=</span> <span class="s2">&#34;menu,menuone,noselect,noinsert&#34;</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl"><span class="c1">-- 样式</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">termguicolors</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl"><span class="n">vim.opt</span><span class="p">.</span><span class="n">termguicolors</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl"><span class="c1">-- 补全增强</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">wildmenu</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl"><span class="c1">-- Dont&#39; pass messages to |ins-completin menu|</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">shortmess</span> <span class="o">=</span> <span class="n">vim.o</span><span class="p">.</span><span class="n">shortmess</span> <span class="o">..</span> <span class="s2">&#34;c&#34;</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl"><span class="c1">-- 补全最多显示10行</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">pumheight</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl"><span class="c1">-- 永远显示 tabline</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">showtabline</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="ln">71</span><span class="cl"><span class="c1">-- 使用增强状态栏插件后不再需要 vim 的模式提示</span>
</span></span><span class="line"><span class="ln">72</span><span class="cl"><span class="n">vim.o</span><span class="p">.</span><span class="n">showmode</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln">73</span><span class="cl"><span class="c1">-- 配置剪切板</span>
</span></span><span class="line"><span class="ln">74</span><span class="cl"><span class="n">vim.opt</span><span class="p">.</span><span class="n">clipboard</span> <span class="o">=</span> <span class="s2">&#34;unnamedplus&#34;</span>
</span></span></code></pre></div><p>怎么知道每个配置项应该放在哪个作用域呢？比如<code>cursorline</code>这个配置项为啥是放在<code>wo</code>中呢？ 可以在命令模式下输入<code>:help cursorline</code>查看相关文档。</p>
<p><code>显示相对行号</code>这个配置我觉得很有必要，比如我希望删除上方的这个<code>PlaneOptions interface</code>，那么在开启了相对行号的前提下，我可以很方便的直接输入<code>d6k</code>，而不需要思考应该删除几行，花时间去数它。</p>
<p>最后一定要在 <code>init.lua</code>  中写入</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;basic&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="快捷键配置">快捷键配置<a class="anchor ms-1" href="#快捷键配置"><i class="fas fa-link"></i></a></h2>
<p>在 Neovim 中配置快捷键其实是<code>快捷键的快捷键</code> ，我们配置快捷键只是嫌默认的快捷键不太方便而已。我们要用自己的方式让 Neovim 适应我们，而不是我们去适应 Neovim。</p>
<h3 id="分屏操作">分屏操作<a class="anchor ms-1" href="#分屏操作"><i class="fas fa-link"></i></a></h3>
<p>如果不设置快捷键，那么在 vim 中要进行上下分屏需要在 normal 模式中输入<code>:split</code> ,进行左右<code>:vsplit</code> 。 我把分屏的操作都设置为以<code>s</code> 开头，那么</p>
<ul>
<li>
<p>上下分屏<code>sh</code></p>
</li>
<li>
<p>左右分屏<code>sv</code></p>
</li>
<li>
<p>关闭当前窗口<code>sc</code></p>
</li>
<li>
<p>关闭其他窗口<code>so</code></p>
</li>
</ul>
<p>切换窗口</p>
<ul>
<li>Alt + h/j/k/l</li>
</ul>
<h3 id="快捷键设置方法">快捷键设置方法<a class="anchor ms-1" href="#快捷键设置方法"><i class="fas fa-link"></i></a></h3>
<p>在 Neovim 中使用以下方法设置快捷键：</p>
<ul>
<li>
<p><code>vim.api.nvim_set_keymap()</code> 全局快捷键</p>
</li>
<li>
<p><code>vim.api.nvim_buf_set_keymap()</code> Buffer 快捷键</p>
</li>
</ul>
<p>一般情况下，都是定义使用全局快捷键， Buffer 快捷键一般是在某些异步回调函数里指定，例如某插件初始化结束后，会有回调函数提供 Buffer，这个时候我们可以只针对这一个 Buffer 设置快捷键。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">vim.api</span><span class="p">.</span><span class="n">nvim_set_keymap</span><span class="p">(</span><span class="s1">&#39;模式&#39;</span><span class="p">,</span> <span class="s1">&#39;按键&#39;</span><span class="p">,</span> <span class="s1">&#39;映射为&#39;</span><span class="p">,</span> <span class="s1">&#39;options&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>这里 <strong>模式</strong> 参数用一个字母表示，常见的有：</p>
<ul>
<li>
<p><strong>n</strong> Normal 模式</p>
</li>
<li>
<p><strong>i</strong> Insert 模式</p>
</li>
<li>
<p><strong>v</strong> Visual 模式</p>
</li>
<li>
<p><strong>t</strong> Terminal 模式</p>
</li>
<li>
<p><strong>c</strong> Command 模式</p>
</li>
</ul>
<p>这里的模式，在之后有介绍。</p>
<p><strong>按键</strong> 就是你按下的键。</p>
<p><strong>映射为</strong> 可以是多个按键组合，比如 <code>5j</code> 就是连续点击<code>5</code>和<code>j</code>， 也可以是一条命令比如 <code>:q&lt;CR&gt;</code>，表示退出。<CR> 表示按下回车键</p>
<p><strong>options</strong> 大部分会设置为 <code>{ noremap = true, silent = true }</code>。</p>
<ul>
<li>
<p><code>noremap</code> 表示不会重新映射，比如你有一个映射 <code>A</code> -&gt; <code>B</code> , 还有一个 <code>B</code> -&gt; <code>C</code>，这个时候如果你设置 <code>noremap = false</code> 的话，表示会重新映射，那么 <code>A</code> 就会被映射为 <code>C</code>。</p>
</li>
<li>
<p><code>silent</code> 为 <code>true</code>，表示不会输出多余的信息。</p>
</li>
</ul>
<h4 id="leader-key">Leader key<a class="anchor ms-1" href="#leader-key"><i class="fas fa-link"></i></a></h4>
<p><code>leader key</code> 是你常用的前缀。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">vim.g</span><span class="p">.</span><span class="n">mapleader</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">vim.g</span><span class="p">.</span><span class="n">maplocalleader</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span>
</span></span></code></pre></div><p>后边定义快捷键看到 <code>&lt;leader&gt;</code> 就表示 <code>空格</code> 。</p>
<p>由于要设置很多快捷键，所以先保存本地变量。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">local</span> <span class="n">map</span> <span class="o">=</span> <span class="n">vim.api</span><span class="p">.</span><span class="n">nvim_set_keymap</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1">-- 复用 opt 参数</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="kd">local</span> <span class="n">opt</span> <span class="o">=</span> <span class="p">{</span><span class="n">noremap</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">silent</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">}</span>
</span></span></code></pre></div><p>之后就可以这样映射按键了 <code>map('模式', '按键', '映射为', 'options')</code> 。</p>
<p>原来默认的 s 键是 <code>删除光标所在处的字符然后插入需要录入的文本</code> ，由于我们用分屏占用了，需要把默认的 s 键取消设置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- 取消 s 默认功能</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;s&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1">-- windows 分屏快捷键</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;sv&#34;</span><span class="p">,</span> <span class="s2">&#34;:vsp&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;sh&#34;</span><span class="p">,</span> <span class="s2">&#34;:sp&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1">-- 关闭当前</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;sc&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-w&gt;c&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">-- 关闭其他</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;so&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-w&gt;o&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">-- leader + hjkl  窗口之间跳转</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;h&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-w&gt;h&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;j&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-w&gt;j&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;k&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-w&gt;k&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;l&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-w&gt;l&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span></code></pre></div><p>水平分屏很常用，在开发中会有跳转到定义 <code>gd</code> 快捷键(Go Definition )，这个可以和 <code>sv</code> 组合起来，形成 <code>svgd</code> 命令，相当于打开右侧窗口进入方法的定义。看完可以随手 <code>sc</code> 关闭掉，非常方便。</p>
<p>调整窗口比例快捷键。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- 左右比例控制</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-Left&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;:vertical resize -2&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-Right&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;:vertical resize +2&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;s,&#34;</span><span class="p">,</span> <span class="s2">&#34;:vertical resize -20&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;s.&#34;</span><span class="p">,</span> <span class="s2">&#34;:vertical resize +20&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1">-- 上下比例</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;sj&#34;</span><span class="p">,</span> <span class="s2">&#34;:resize +10&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;sk&#34;</span><span class="p">,</span> <span class="s2">&#34;:resize -10&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-Down&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;:resize +2&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-Up&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;:resize -2&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1">-- 等比例</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;s=&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-w&gt;=&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span></code></pre></div><p><code>Neovim</code> 内置的命令行要用<code>&lt;C-\&gt;&lt;C-N&gt;</code> 退出，我们把它映射为 <code>ESC</code> ，并用 <code>leader + t</code> 在下边窗口打开，或 <code>leader + vt</code> 侧边窗口打开。在里面 i 进入 insert 模式</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- Terminal相关</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;t&#34;</span><span class="p">,</span> <span class="s2">&#34;:sp | terminal&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;vt&#34;</span><span class="p">,</span> <span class="s2">&#34;:vsp | terminal&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;t&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;Esc&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-</span><span class="se">\\</span><span class="s2">&gt;&lt;C-n&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span></code></pre></div><p>在 visual 模式下可以<code>J</code> <code>K</code> 上下移动代码，又增加了连续 <code>&gt;</code> 或 <code>&lt;</code> 缩进代码。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- visual模式下缩进代码</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;v&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;gv&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;v&#34;</span><span class="p">,</span> <span class="s2">&#34;&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;&gt;gv&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">-- 上下移动选中文本</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;v&#34;</span><span class="p">,</span> <span class="s2">&#34;J&#34;</span><span class="p">,</span> <span class="s2">&#34;:move &#39;&gt;+1&lt;CR&gt;gv-gv&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;v&#34;</span><span class="p">,</span> <span class="s2">&#34;K&#34;</span><span class="p">,</span> <span class="s2">&#34;:move &#39;&lt;-2&lt;CR&gt;gv-gv&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span></code></pre></div><p>在浏览非常长的代码文件时，通常要用 <code>Ctrl+u</code> / <code>Ctrl + d</code> 来滚动代码，<code>u</code> 和 <code>p</code> 表示 <code>up翻页</code> 和 <code>down翻页</code>。</p>
<p>但是<code>ctrl + u</code> / <code>ctrl + d</code> 默认移动半屏，翻太快，一不留神就不知道翻到哪了， <code>j</code> / <code>k</code> 又移动得太慢了。这时我会设置两种不同级别的翻页距离， <code>Ctrl+j</code> / <code>Ctrl+k</code> 移动 4 行，<code>Ctrl+u</code> / <code>Ctrl + d</code> 移动 9 行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- 上下滚动浏览</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-j&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;4j&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-k&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;4k&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">-- ctrl u / ctrl + d  只移动9行，默认移动半屏</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-u&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;9k&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-d&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;9j&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span></code></pre></div><p>最后，在 <code>init.lua</code> 入口文件里引入 <code>lua/keybindings.lua</code>，注意不要写 <code>.lua</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- 快捷键映射</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;keybindings&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="插件管理">插件管理<a class="anchor ms-1" href="#插件管理"><i class="fas fa-link"></i></a></h2>
<p>之前使用的是<a href="https://github.com/junegunn/vim-plug" target="_blank" rel="noopener noreferrer">vim-plug</a>，用 lua 管理之后就转到<a href="https://github.com/wbthomason/packer.nvim" target="_blank" rel="noopener noreferrer">packer</a> 了。</p>
<h3 id="安装">安装<a class="anchor ms-1" href="#安装"><i class="fas fa-link"></i></a></h3>
<p><strong>mac</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">git clone --depth <span class="m">1</span> https://github.com/wbthomason/packer.nvim<span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span> ~/.local/share/nvim/site/pack/packer/start/packer.nvim
</span></span></code></pre></div><p>新建插件的配置文件并初始化。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">local</span> <span class="n">packer</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;packer&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">packer.startup</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="kr">function</span><span class="p">(</span><span class="n">use</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">   <span class="c1">-- Packer 可以管理自己本身</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">   <span class="n">use</span> <span class="p">(</span><span class="s2">&#34;wbthomason/packer.nvim&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">   <span class="c1">-- 你的插件列表...</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="kr">end</span><span class="p">)</span>
</span></span></code></pre></div><p>使用 <code>use (&quot;name/repo&quot;)</code>  来安装插件，<code>name/repo</code> 对应<code>github</code> 的ID 和仓库名。例如上边代码中的 <code>use (&quot;wbthomason/packer.nvim&quot;)</code>，对应的就是 <code>https://github.com/wbthomason/packer.nvim</code> 地址。</p>
<p>在第二个参数中还可设置  config 参数。例如设置最大工作的并发等。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">packer</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;packer&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">packer.startup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="kr">function</span><span class="p">(</span><span class="n">use</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="c1">-- Packer 可以管理自己本身</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">use</span> <span class="s1">&#39;wbthomason/packer.nvim&#39;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="c1">-- 你的插件列表...</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="kr">end</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1">-- 并发数限制</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">max_jobs</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="c1">-- 浮动窗口打开安装列表</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">display</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="n">open_fn</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="kr">return</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;packer.util&#34;</span><span class="p">).</span><span class="n">float</span><span class="p">({</span> <span class="n">border</span> <span class="o">=</span> <span class="s2">&#34;single&#34;</span> <span class="p">})</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="kr">end</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>必须在 <strong>入口文件</strong> 中引入才可以， 打开 <code>init.lua</code> 增加如下代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- Packer 插件管理</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;plugins&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>再次 <code>:wq</code> 后，配置生效。</p>
<p>配置生效后，运行 <code>:PackerSync</code>, 重新生成编译的加载文件。每次修改完 <code>lua/plugins.lua</code> 这个文件后，保存退出，重新打开并调用 <code>:PackerSync</code> 就可以了，只要你的网络可以连接到 <code>github</code>，插件就会安装成功。</p>
<p>Neovim 推荐将数据存储在 <strong>标准数据目录</strong>下（<code>:h base-directories</code> 查看详细文档），<strong>标准数据目录</strong>默认是 <code>~/.local/share/nvim/</code> ，你可以通过调用 <code>:echo stdpath(&quot;data&quot;)</code> 命令查看你系统下的实际路径。</p>
<p><code>Packer</code> 会将插件默认安装在 <code>标准数据目录/site/pack/packer/start</code> 中，完整目录也就是<code>~/.local/share/nvim/site/pack/packer/start</code> 目录下。</p>
<p>你现在可以进入这个目录，查看一下安装的插件，应该看到只安装了 <code>packer.nvim</code> 一个插件，后续安装的插件也都会出现在这个目录中。</p>
<p>之前我们讲了安装组件的流程为： 修改 <code>lua/plugins.lua</code> 文件，保存退出，重新打开并调用 <code>:PackerSync</code>。</p>
<p>其实如果你愿意的话，我们可以添加一条自动命令让每次保存 <code>lua/plugins.lua</code> 就自动安装组件。</p>
<p>打开 <code>lua/plugins.lua</code> 文件，在最后添加：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- 每次保存 plugins.lua 自动安装插件</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">pcall</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">vim.cmd</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="s">[[
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="s">    augroup packer_user_config
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="s">    autocmd!
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="s">    autocmd BufWritePost plugins.lua source &lt;afile&gt; | PackerSync
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="s">    augroup end
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="s">  ]]</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>这里的 <code>[[ ... ]]</code> 中间的部分是 VIM 脚本，因为 Neovim 还没有实现自动命令的 API，所以我们需要使用 <code>vim.cmd</code> 命令来执行这段脚本。</p>
<p>这段脚本的意思是 <code>BufWritePost</code> 事件时，如果改的是 <code>lua/plugins.lua</code> 文件，就自动重新加载并调用 <code>:PackerSync</code> 命令，这样就不用手动重启，可以自动安装插件了。</p>
<p><code>pcall</code> 命令是一个 Lua 函数，它的作用是检查一个函数是否执行成功，如果执行成功，则返回 <code>true</code>，否则返回 <code>false</code> 。</p>
<p>现在修改 <code>lua/plugins.lua</code> 后输入 <code>:w</code> 就会自动安装和更新插件了。</p>
<h2 id="主题">主题<a class="anchor ms-1" href="#主题"><i class="fas fa-link"></i></a></h2>
<p>Neovim 本身内置了一些主题配色，可以通过 <code>:colorscheme Tab键</code> 命令来查看， 回车确认选中。这里列出的都是内置的 <code>colorscheme</code>，它们都保存在 <code>$VIMRUNTIME/colors/</code> 目录下。可以在 <code>Neovim</code> 中输入命令 <code>:echo $VIMRUNTIME</code> 来查看 <code>$VIMRUNTIME</code> 具体的路径。</p>
<p>但通过这种方式选择的主题，在重启后就失效了。需要写入配置才可以保存，下边看一下如何写入配置。</p>
<p>在<code>init.lua</code> 中添加</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;colorscheme&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>新建被引入的 <code>lua/colorscheme.lua</code> 文件，代码如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">local</span> <span class="n">colorscheme</span> <span class="o">=</span> <span class="s2">&#34;tokyonight&#34;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="kd">local</span> <span class="n">status_ok</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">vim.cmd</span><span class="p">,</span> <span class="s2">&#34;colorscheme &#34;</span> <span class="o">..</span> <span class="n">colorscheme</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status_ok</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;colorscheme &#34;</span> <span class="o">..</span> <span class="n">colorscheme</span> <span class="o">..</span> <span class="s2">&#34; 没有找到！&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="kr">return</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div><p>简单解释一下，上边代码第一行，定义了一个 <code>colorscheme</code> 的变量，表示我们要设置的主题，注意其实这里我们使用的 <code>tokyonight</code> <strong>并不存在</strong>。</p>
<p>接下来的部分代码，我们又见到了 <code>pcall</code>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">local</span> <span class="n">status_ok</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">vim.cmd</span><span class="p">,</span> <span class="s2">&#34;colorscheme &#34;</span> <span class="o">..</span> <span class="n">colorscheme</span><span class="p">)</span>
</span></span></code></pre></div><p><code>pcall</code> 在 Lua 中用于捕获错误，这句话如果不用<code>pcall</code> 的话，相当于：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">vim.cmd</span><span class="p">(</span><span class="s1">&#39;colorscheme &#39;</span><span class="o">..</span> <span class="n">colorscheme</span><span class="p">)</span>
</span></span></code></pre></div><p>Lua 语言中用 <code>..</code> 来连接两个字符串，上边已经声明了 <code>colorscheme</code> 变量也是一个字符串 <code>&quot;tokyonight&quot; </code>所以这里其实就等于调用 <code>:colorscheme tokyonight</code> 命令。 但如果这样直接调用命令，如果主题不存在，Neovim 就会直接崩溃报错找不到该主题，程序中也就没法知道主题是否设置成功了。</p>
<p>使用 <code>pcall</code> 的话就不同了，<code>pcall</code> 函数的返回的第一个参数是 <code>boolean</code> 类型表示状态，这句话的意思是，如果 <code>colorscheme</code> 执行成功，则返回 <code>true</code>，否则返回 <code>false</code>。</p>
<p>如果没有设置成功，我们就让它输出信息：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;colorscheme &#34;</span> <span class="o">..</span> <span class="n">colorscheme</span> <span class="o">..</span> <span class="s2">&#34; 没有找到！&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>至此配置的部分就完成了，提示没有找到是因为 <code>tokyonight</code> 主题并不存在，如果把该值修改成已经存在的主题，比如 <code>ron</code> 就会设置成功了。</p>
<p>下边我们看看如何安装第三方主题。</p>
<h3 id="安装第三方插件">安装第三方插件<a class="anchor ms-1" href="#安装第三方插件"><i class="fas fa-link"></i></a></h3>
<p>打开 <code>lua/plugins.lua</code> 文件，增加 colorschemes 部分：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">packer.startup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="kr">function</span><span class="p">(</span><span class="n">use</span><span class="p">)</span><span class="c1">-- Packer 可以升级自己</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">use</span><span class="p">(</span><span class="s2">&#34;wbthomason/packer.nvim&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="c1">--------------------- colorschemes ---------------------- tokyonight</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="n">use</span><span class="p">(</span><span class="s2">&#34;folke/tokyonight.nvim&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><code>:w</code> 保存，如果顺利的话，会自动安装，完成后按 <code>q</code> 退出，重启后就可以看到 <code>tokyonight</code> 主题的样子了。</p>
<p>通常我们都会选择专门为 Neovim 制作的第三方主题，因为它们大多都会支持基于 <code>TreeSitter</code> 的语法高亮（后续代码高亮章节会详细说明），我认为这是考量是否应该选择一个主题最基础也是重要的事。</p>
<p>也就是说，一个现代化的主题，必须支持 <a href="https://github.com/nvim-treesitter/nvim-treesitter" target="_blank" rel="noopener noreferrer">nvim-treesitter</a> 语法高亮。</p>
<p>nvim-treesitter 的官方 wiki 上列出了许多支持 Treesitter 的主题，如果你想寻找更多的主题配色，可以到 <a href="https://github.com/nvim-treesitter/nvim-treesitter/wiki/Colorschemes" target="_blank" rel="noopener noreferrer">nvim-treesitter wiki</a> 页里查看。</p>
<p>选择喜欢的样式后修改 <code>lua/colorscheme.lua</code> 内 <code>colorscheme</code> 变量的名字保存，重启后即可生效。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">local</span> <span class="n">colorscheme</span> <span class="o">=</span> <span class="s2">&#34;tokyonight&#34;</span>
</span></span></code></pre></div><h2 id="侧边栏管理">侧边栏管理<a class="anchor ms-1" href="#侧边栏管理"><i class="fas fa-link"></i></a></h2>
<p>一般 IDE 都有一个文件浏览器，可以方便地浏览目录结构，添加、删除、移动或者重命名文件，更快地打开文件。</p>
<p>安装插件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">use</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="s1">&#39;kyazdani42/nvim-tree.lua&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="s1">&#39;kyazdani42/nvim-web-devicons&#39;</span><span class="p">,</span> <span class="c1">-- optional, for file icons</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;nightly&#39;</span> <span class="c1">-- optional, updated every week. (see issue #1193)</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="配置">配置<a class="anchor ms-1" href="#配置"><i class="fas fa-link"></i></a></h3>
<p>创建 <code>lua/plugin-config/nvim-tree.lua</code> 文件，添加如下内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">nvim_tree</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;nvim-tree&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 nvim-tree&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="kr">return</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div><p>上边的代码相当于：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">local</span> <span class="n">nvim_tree</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;nvim-tree&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>但是如果我们直接 <code>require</code> 一个插件，当这个插件不存在的时候，<code>Neovim</code> 就会崩溃，所以我这里使用 <code>pcall</code> 来捕获了错误，如果 <code>nvim-tree</code> 没有安装，我们就会直接 <code>return</code>，<strong>不</strong>再继续执行下边的配置。</p>
<p>由于我们经常会调整插件，所以应该尽量避免报错，后续的所有插件配置文件都会这么做。</p>
<p>继续增加代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">  1</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">nvim_tree</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;nvim-tree&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl">        <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 nvim-tree&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl">        <span class="kr">return</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="ln">  6</span><span class="cl">
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="c1">-- 列表操作快捷键</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="kd">local</span> <span class="n">list_keys</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;keybindings&#39;</span><span class="p">).</span><span class="n">nvimTreeList</span>
</span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="n">nvim_tree.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">
</span></span><span class="line"><span class="ln"> 11</span><span class="cl">        <span class="n">auto_reload_on_write</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">        <span class="n">create_in_closed_folder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">        <span class="n">disable_netrw</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">        <span class="n">hijack_cursor</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 15</span><span class="cl">        <span class="n">hijack_netrw</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">        <span class="n">hijack_unnamed_buffer_when_opening</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">        <span class="n">ignore_buffer_on_setup</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">        <span class="n">open_on_setup</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">        <span class="n">open_on_setup_file</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">        <span class="n">open_on_tab</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">        <span class="n">sort_by</span> <span class="o">=</span> <span class="s2">&#34;name&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">        <span class="n">root_dirs</span> <span class="o">=</span> <span class="p">{},</span>
</span></span><span class="line"><span class="ln"> 23</span><span class="cl">        <span class="n">prefer_startup_root</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">        <span class="n">sync_root_with_cwd</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">        <span class="n">reload_on_bufenter</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">        <span class="n">respect_buf_cwd</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">        <span class="n">view</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">                <span class="n">adaptive_size</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">                <span class="n">centralize_selection</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">                <span class="n">width</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">                <span class="n">height</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">                <span class="n">hide_root_folder</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">                <span class="n">side</span> <span class="o">=</span> <span class="s2">&#34;left&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">                <span class="n">preserve_window_proportions</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">                <span class="n">number</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">                <span class="n">relativenumber</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">                <span class="n">signcolumn</span> <span class="o">=</span> <span class="s2">&#34;yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">                <span class="n">mappings</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">                        <span class="n">custom_only</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">                        <span class="n">list</span> <span class="o">=</span> <span class="n">list_keys</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">        <span class="n">renderer</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">                <span class="n">add_trailing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">                <span class="n">group_empty</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">                <span class="n">highlight_git</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">                <span class="n">full_name</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">                <span class="n">highlight_opened_files</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">                <span class="n">root_folder_modifier</span> <span class="o">=</span> <span class="s2">&#34;:~&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">                <span class="n">indent_markers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">                        <span class="n">enable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">                        <span class="n">icons</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">                                <span class="n">corner</span> <span class="o">=</span> <span class="s2">&#34;└&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">                                <span class="n">edge</span> <span class="o">=</span> <span class="s2">&#34;│&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">                                <span class="n">item</span> <span class="o">=</span> <span class="s2">&#34;│&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">                                <span class="n">none</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">                <span class="n">icons</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">                        <span class="n">webdev_colors</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">                        <span class="n">git_placement</span> <span class="o">=</span> <span class="s2">&#34;before&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">                        <span class="n">padding</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">                        <span class="n">symlink_arrow</span> <span class="o">=</span> <span class="s2">&#34; ➛ &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">                        <span class="n">show</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">                                <span class="n">file</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">                                <span class="n">folder</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">                                <span class="n">folder_arrow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">                                <span class="n">git</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">                        <span class="n">glyphs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">                                <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">                                <span class="n">symlink</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">                                <span class="n">bookmark</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">                                <span class="n">folder</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">                                        <span class="n">arrow_closed</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">                                        <span class="n">arrow_open</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">                                        <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">                                        <span class="n">open</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">                                        <span class="n">empty</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">                                        <span class="n">empty_open</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">                                        <span class="n">symlink</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">                                        <span class="n">symlink_open</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">                                <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">                                <span class="n">git</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">                                        <span class="n">unstaged</span> <span class="o">=</span> <span class="s2">&#34;✗&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">                                        <span class="n">staged</span> <span class="o">=</span> <span class="s2">&#34;✓&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">                                        <span class="n">unmerged</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">                                        <span class="n">renamed</span> <span class="o">=</span> <span class="s2">&#34;➜&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">                                        <span class="n">untracked</span> <span class="o">=</span> <span class="s2">&#34;★&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">                                        <span class="n">deleted</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">                                        <span class="n">ignored</span> <span class="o">=</span> <span class="s2">&#34;◌&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">                                <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">                <span class="n">special_files</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;Cargo.toml&#34;</span><span class="p">,</span> <span class="s2">&#34;Makefile&#34;</span><span class="p">,</span> <span class="s2">&#34;README.md&#34;</span><span class="p">,</span> <span class="s2">&#34;readme.md&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">                <span class="n">symlink_destination</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">        <span class="n">hijack_directories</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">                <span class="n">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">                <span class="n">auto_open</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl"><span class="p">},</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">        <span class="n">update_focused_file</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">                <span class="n">enable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">                <span class="n">update_root</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">                <span class="n">ignore_list</span> <span class="o">=</span> <span class="p">{},</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">        <span class="n">ignore_ft_on_setup</span> <span class="o">=</span> <span class="p">{},</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl"><span class="n">system_open</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&#34;open&#34;</span><span class="p">,</span> <span class="c1">-- mac</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">                <span class="c1">-- cmd  = &#34;wsl-open&#34; --win</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">                <span class="n">args</span> <span class="o">=</span> <span class="p">{},</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">        <span class="n">diagnostics</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">                <span class="n">enable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">                <span class="n">show_on_dirs</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">                <span class="n">debounce_delay</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">                <span class="n">icons</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">                        <span class="n">hint</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">                        <span class="n">info</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">                        <span class="n">warning</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">121</span><span class="cl">                        <span class="n">error</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">                <span class="c1">-- 隐藏 node_modules </span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">                <span class="n">dotfiles</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">                <span class="n">custom</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;node_modules&#34;</span><span class="p">,</span><span class="s2">&#34;.idea&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">                <span class="n">exclude</span> <span class="o">=</span> <span class="p">{},</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">        <span class="n">filesystem_watchers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">                <span class="n">enable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">                <span class="n">interval</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">                <span class="n">debounce_delay</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">        <span class="n">git</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">                <span class="n">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">                <span class="n">ignore</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">                <span class="n">show_on_dirs</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">                <span class="n">timeout</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">        <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">                <span class="n">use_system_clipboard</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">                <span class="n">change_dir</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">                        <span class="n">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">                        <span class="n">global</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">                        <span class="n">restrict_above_cwd</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl">                <span class="n">expand_all</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">                        <span class="n">max_folder_discovery</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">150</span><span class="cl">                        <span class="n">exclude</span> <span class="o">=</span> <span class="p">{},</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">                <span class="n">open_file</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">                        <span class="n">quit_on_open</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">                        <span class="n">resize_window</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">                        <span class="n">window_picker</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">                                <span class="n">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">157</span><span class="cl">                                <span class="n">chars</span> <span class="o">=</span> <span class="s2">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">158</span><span class="cl">                                <span class="n">exclude</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">                                        <span class="n">filetype</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;notify&#34;</span><span class="p">,</span> <span class="s2">&#34;packer&#34;</span><span class="p">,</span> <span class="s2">&#34;qf&#34;</span><span class="p">,</span> <span class="s2">&#34;diff&#34;</span><span class="p">,</span> <span class="s2">&#34;fugitive&#34;</span><span class="p">,</span> <span class="s2">&#34;fugitiveblame&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl">                                        <span class="n">buftype</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;nofile&#34;</span><span class="p">,</span> <span class="s2">&#34;terminal&#34;</span><span class="p">,</span> <span class="s2">&#34;help&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">                                <span class="p">},</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl">                <span class="n">remove_file</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">165</span><span class="cl">                        <span class="n">close_window</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="ln">167</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl">        <span class="n">trash</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&#34;gio trash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">170</span><span class="cl">                <span class="n">require_confirm</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">171</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">172</span><span class="cl">        <span class="n">live_filter</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">173</span><span class="cl">                <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&#34;[FILTER]: &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">174</span><span class="cl">                <span class="n">always_show_folders</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">175</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">176</span><span class="cl">        <span class="n">log</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">177</span><span class="cl">                <span class="n">enable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">178</span><span class="cl">                <span class="n">truncate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">179</span><span class="cl">                <span class="n">types</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">180</span><span class="cl">                        <span class="n">all</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">181</span><span class="cl">                        <span class="n">config</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">182</span><span class="cl">                        <span class="n">copy_paste</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">183</span><span class="cl">                        <span class="n">dev</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">184</span><span class="cl">                        <span class="n">diagnostics</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">185</span><span class="cl">                        <span class="n">git</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">186</span><span class="cl">                        <span class="n">profile</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">187</span><span class="cl">                        <span class="n">watcher</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">188</span><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="ln">189</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">190</span><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="ln">191</span><span class="cl"><span class="c1">-- 自动关闭</span>
</span></span><span class="line"><span class="ln">192</span><span class="cl"><span class="n">vim.cmd</span><span class="p">(</span><span class="s">[[
</span></span></span><span class="line"><span class="ln">193</span><span class="cl"><span class="s">  autocmd BufEnter * ++nested if winnr(&#39;$&#39;) == 1 &amp;&amp; bufname() == &#39;NvimTree_&#39; . tabpagenr() | quit | endif
</span></span></span><span class="line"><span class="ln">194</span><span class="cl"><span class="s">]]</span><span class="p">)</span>
</span></span></code></pre></div><p>上边代码就是 nvim-tree 的配置，可以根据注释进行修改。这里简单解释一下，值得注意的是 <code>system_open</code> 项，如果想要在 <code>WSL</code> 中用 Windows 系统默认设置打开文件，需要使用 <code>Node.js</code> 全局安装一个 <code>wsl-open</code> 包，使用命令 <code>npm install -g wsl-open</code>，如果不需要这个功能，也可以不用安装。 如果不是 Windows 系统也就不需要安装。</p>
<p>nvim-tree 初始化支持很多参数，如果想知道还有哪些其他的参数，可以运行 <code>:h nvim-tree.setup</code> 调出帮助文档查看。</p>
<p>注意到上述代码第一行，引入了我们之前创建的 <code>lua/keybindings.lua</code>，并取出 <code>nvimTreeList</code> 变量作为快捷键设置， 那我们就看看 <code>keybinding</code> 中是如何导出这个变量的。</p>
<p>打开 <code>lua/keybindings.lua</code> 文件，增加如下代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- 插件快捷键</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">local</span> <span class="n">pluginKeys</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">-- nvim-tree begin --</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1">-- alt + m 键打开关闭tree</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;A-m&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;:NvimTreeToggle&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">-- 列表快捷键</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">pluginKeys.nvimTreeList</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="c1">-- 打开文件或文件夹</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;o&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;2-LeftMouse&gt;&#34;</span><span class="p">},</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;edit&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1">-- 分屏打开文件</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;v&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;vsplit&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;h&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;split&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1">-- 显示隐藏文件</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;i&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;toggle_custom&#34;</span> <span class="p">},</span> <span class="c1">-- 对应 filters 中的 custom (node_modules)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;.&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;toggle_dotfiles&#34;</span> <span class="p">},</span> <span class="c1">-- Hide (dotfiles)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1">-- 文件操作</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;&lt;F5&gt;&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;refresh&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;a&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;create&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;d&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;remove&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;D&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;trash&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;r&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;rename&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;x&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;cut&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;c&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;copy&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;p&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;paste&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="p">{</span> <span class="n">key</span> <span class="o">=</span> <span class="s2">&#34;s&#34;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;system_open&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="c1">-- nvim-tree end --</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="kr">return</span> <span class="n">pluginKeys</span>
</span></span></code></pre></div><p>在上边代码中，我们首先在 Normal 模式下定义了一个<code>Alt + m</code> 的快捷键，调用 <code>:NvimTreeToggle&lt;CR&gt;</code> 命令，这个快捷键用来打开和关闭侧边栏。</p>
<p><code>pluginKeys.nvimTreeList</code> 下则是在光标在列表中时的快捷键设置，比如用 <code>o</code> 来打开关闭文件夹，<code>a</code> 添加一个文件，<code>d</code> 删除文件等等。</p>
<p><a href="https://github.com/kyazdani42/nvim-tree.lua/blob/ba5c18dc2b43599067d999933469098073e1941c/doc/nvim-tree-lua.txt#L1030" target="_blank" rel="noopener noreferrer">详见更多快捷键配置</a></p>
<p>代码的最后一行，我们 <code>return</code> 了一个 <code>lua table</code>， 也叫关联数组。 当我们从其他文件 <code>require</code> 这个文件的时候，就会得到这个对象。</p>
<p>最后不要忘记在入口文件 <code>init.lua</code> 中引入配置：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- 插件配置</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;plugin-config.nvim-tree&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>重启 nvim 后，侧边栏就会生效了，使用 <code>Alt + m</code> 打开/关闭， <code>j/k</code> 上下移动， <code> &lt;leader&gt; + h</code> / <code>&lt;leader&gt; + l</code> 可以左右窗口跳转。</p>
<h2 id="标签页和底部信息栏">标签页和底部信息栏<a class="anchor ms-1" href="#标签页和底部信息栏"><i class="fas fa-link"></i></a></h2>
<h3 id="标签页">标签页<a class="anchor ms-1" href="#标签页"><i class="fas fa-link"></i></a></h3>
<p><a href="https://github.com/akinsho/bufferline.nvim" target="_blank" rel="noopener noreferrer">bufferline</a> 顾名思义是把 Neovim 的 <code>buffer</code> 图形化显示成标签页的形式。</p>
<p><strong>安装</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl">    <span class="n">use</span><span class="p">({</span> <span class="s2">&#34;akinsho/bufferline.nvim&#34;</span><span class="p">,</span> <span class="n">tag</span> <span class="o">=</span> <span class="s2">&#34;v2.*&#34;</span><span class="p">,</span><span class="n">requires</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;kyazdani42/nvim-web-devicons&#34;</span><span class="p">,</span> <span class="s2">&#34;moll/vim-bbye&#34;</span> <span class="p">}})</span>
</span></span></code></pre></div><p>这里我增加了一个 <a href="https://github.com/moll/vim-bbye" target="_blank" rel="noopener noreferrer">vim-bbye</a> 依赖，因为这个插件安装后会增加一个 <code>:Bdelete</code> 命令，相比内置的 <code>:bdelete</code>, 它删除 buffer 的同时，并不会搞乱布局 。 待会儿我们会配置 <code>Bdelete</code> 为关闭 Tab 的命令。</p>
<p>新建配置文件 <code>lua/plugin-config/bufferline.lua</code>，代码如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Lua" data-lang="Lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">bufferline</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;bufferline&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 bufferline&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="kr">return</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kr">end</span><span class="c1">-- bufferline 配置</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1">-- https://github.com/akinsho/bufferline.nvim#configuration</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">bufferline.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1">-- 关闭 Tab 的命令，这里使用 moll/vim-bbye 的 :Bdelete 命令</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">close_command</span> <span class="o">=</span> <span class="s2">&#34;Bdelete! %d&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">right_mouse_command</span> <span class="o">=</span> <span class="s2">&#34;Bdelete! %d&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="c1">-- 侧边栏配置</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="c1">-- 左侧让出 nvim-tree 的位置，显示文字 File Explorer</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">offsets</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">filetype</span> <span class="o">=</span> <span class="s2">&#34;NvimTree&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="n">text</span> <span class="o">=</span> <span class="s2">&#34;File Explorer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="n">highlight</span> <span class="o">=</span> <span class="s2">&#34;Directory&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="n">text_align</span> <span class="o">=</span> <span class="s2">&#34;left&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="c1">-- 使用 nvim 内置 LSP  后续课程会配置</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="n">diagnostics</span> <span class="o">=</span> <span class="s2">&#34;nvim_lsp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="c1">-- 可选，显示 LSP 报错图标</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="c1">---@diagnostic disable-next-line: unused-local</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="n">diagnostics_indicator</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">diagnostics_dict</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">      <span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">      <span class="kr">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">diagnostics_dict</span><span class="p">)</span> <span class="kr">do</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="kd">local</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">e</span> <span class="o">==</span> <span class="s2">&#34;error&#34;</span> <span class="ow">and</span> <span class="s2">&#34; &#34;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">e</span> <span class="o">==</span> <span class="s2">&#34;warning&#34;</span> <span class="ow">and</span> <span class="s2">&#34; &#34;</span> <span class="ow">or</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">..</span> <span class="n">n</span> <span class="o">..</span> <span class="n">sym</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">      <span class="kr">end</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">      <span class="kr">return</span> <span class="n">s</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="kr">end</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>增加快捷键。 打开 <code>lua/keybindings.lua</code>，根据你的使用习惯增加键盘映射：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- bufferline</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">-- 左右Tab切换</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-h&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;:BufferLineCyclePrev&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-l&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;:BufferLineCycleNext&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1">-- 关闭</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1">--&#34;moll/vim-bbye&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;C-w&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;:Bdelete!&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;bl&#34;</span><span class="p">,</span> <span class="s2">&#34;:BufferLineCloseRight&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;bh&#34;</span><span class="p">,</span> <span class="s2">&#34;:BufferLineCloseLeft&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;bc&#34;</span><span class="p">,</span> <span class="s2">&#34;:BufferLinePickClose&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span></code></pre></div><p>上述代码延续了我在 <code>VSCode</code> 中的使用习惯，使用 <code>Ctrl + h</code> 和 <code>Ctrl + l</code> 左右切换标签页， <code>Ctrl + w</code> 关闭当前标签页。</p>
<p>我又将 <code>bufferline</code> 提供的我不太常用到的命令，映射为由空格键开头， <code>&lt;leader&gt;bl</code> 关闭左侧标签页， <code>&lt;leader&gt;bh</code> 关闭右侧标签页， <code>&lt;leader&gt;bc</code> 选择要关闭的标签页。</p>
<p>最后一步，在入口文件中引入配置文件。 打开 <code>init.lua</code>，增加代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;plugin-config.bufferline&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>保存退出，重启后安装生效。</p>
<h3 id="底部信息栏">底部信息栏<a class="anchor ms-1" href="#底部信息栏"><i class="fas fa-link"></i></a></h3>
<p>底部状态栏用于显示一些额外信息，比如当前的编辑模式，光标所在的行号，列号。当前文件大小，编码格式，当前 <code>git</code> 分支等状态。</p>
<p>打开 <code>lua/plugins.lua</code>， 增加 <code>lualine</code> 相关代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"> <span class="n">use</span><span class="p">({</span> <span class="s2">&#34;nvim-lualine/lualine.nvim&#34;</span><span class="p">,</span> <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;kyazdani42/nvim-web-devicons&#34;</span> <span class="p">}</span> <span class="p">})</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"> <span class="n">use</span><span class="p">(</span><span class="s2">&#34;arkav/lualine-lsp-progress&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>注意这里新增了两行，第二行是 <code>lualine</code> 的一个扩展。</p>
<p>新建配置文件 <code>lua/plugin-config/lualine.lua</code>，代码如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- 如果找不到lualine 组件，就不继续执行</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">lualine</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;lualine&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 lualine&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="kr">return</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">lualine.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">theme</span> <span class="o">=</span> <span class="s2">&#34;tokyonight&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">component_separators</span> <span class="o">=</span> <span class="p">{</span> <span class="n">left</span> <span class="o">=</span> <span class="s2">&#34;|&#34;</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="s2">&#34;|&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="c1">-- https://github.com/ryanoasis/powerline-extra-symbols</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">section_separators</span> <span class="o">=</span> <span class="p">{</span> <span class="n">left</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">extensions</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;nvim-tree&#34;</span><span class="p">,</span> <span class="s2">&#34;toggleterm&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">sections</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">lualine_c</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">      <span class="s2">&#34;filename&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="s2">&#34;lsp_progress&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">spinner_symbols</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="n">lualine_x</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">      <span class="s2">&#34;filesize&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="s2">&#34;fileformat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="c1">-- symbols = {</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="c1">--   unix = &#39;&#39;, -- e712</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="c1">--   dos = &#39;&#39;, -- e70f</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="c1">--   mac = &#39;&#39;, -- e711</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="c1">-- },</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="n">symbols</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">          <span class="n">unix</span> <span class="o">=</span> <span class="s2">&#34;LF&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">          <span class="n">dos</span> <span class="o">=</span> <span class="s2">&#34;CRLF&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">          <span class="n">mac</span> <span class="o">=</span> <span class="s2">&#34;CR&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">      <span class="s2">&#34;encoding&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">      <span class="s2">&#34;filetype&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>lualine 的配置参数主要有 <code>options</code>，<code>extensions</code> 和 <code>sections</code> 三块。</p>
<p><code>options</code> 用于设置样式， 其中 <code>theme</code> 设置主题配色，可以设置为 <code>auto</code>， 也可以设置为<a href="https://github.com/nvim-lualine/lualine.nvim/blob/master/THEMES.md" target="_blank" rel="noopener noreferrer">主题列表</a>中的一个， 我这里设置的是 <code>tokyonight</code>，是由 tokyonight 主题配色额外提供的支持。<code>section_separators</code> 设置分段分隔符<code>， component_separators</code> 设置分段中的组件分隔符。</p>
<p><code>extensions</code> 用于设置 <code>lualine</code> 支持的扩展，详见<a href="https://github.com/nvim-lualine/lualine.nvim#extensions" target="_blank" rel="noopener noreferrer">扩展列表</a> 这里我们只会用到 <code>nvim-tree</code> 和 <code>toggleterm</code> 。</p>
<p><code>sections</code> 用于设置不同分段，所需显示的功能模块， 分段有 6 个，分别为： <code>A B C X Y Z</code> 。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-PowerShell" data-lang="PowerShell"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">+-------------------------------------------------+</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="p">|</span> <span class="n">A</span> <span class="p">|</span> <span class="n">B</span> <span class="p">|</span> <span class="n">C</span>                             <span class="n">X</span> <span class="p">|</span> <span class="n">Y</span> <span class="p">|</span> <span class="n">Z</span> <span class="p">|</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">+-------------------------------------------------+</span>
</span></span></code></pre></div><p>对应默认配置项为：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"> <span class="n">sections</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="n">lualine_a</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mode&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">lualine_b</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;branch&#39;</span><span class="p">,</span> <span class="s1">&#39;diff&#39;</span><span class="p">,</span> <span class="s1">&#39;diagnostics&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="n">lualine_c</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;filename&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="n">lualine_x</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;fileformat&#39;</span><span class="p">,</span> <span class="s1">&#39;filetype&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="n">lualine_y</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;progress&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="n">lualine_z</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="p">},</span>
</span></span></code></pre></div><p>我的配置中，修改了 <code>C</code> 的部分：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl">    <span class="n">lualine_c</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">      <span class="s2">&#34;filename&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="s2">&#34;lsp_progress&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="n">spinner_symbols</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34; &#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="p">},</span>
</span></span></code></pre></div><p>在文件名后边增加了 <code>lsp_progress</code> 进度显示，该信息是由我们之前安装的 <a href="https://github.com/arkav/lualine-lsp-progress" target="_blank" rel="noopener noreferrer">arkav/lualine-lsp-progress</a> 提供的。</p>
<p>可以修改了 <code>X</code> 的部分， 因为 <code>lualine</code> 默认的 <code>fileformat</code> 是用图标表示的，不是很直观，可以换成了和 <code>VSCode</code> 一致的 <code>LF/CRLF/CR</code> 格式。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl">    <span class="n">lualine_x</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">      <span class="s2">&#34;filesize&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">        <span class="s2">&#34;fileformat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="c1">-- symbols = {--   unix = &#39;&#39;, -- e712--   dos = &#39;&#39;, -- e70f--   mac = &#39;&#39;, -- e711-- },</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">         <span class="c1">-- symbols = {unix = &#34;LF&#34;,dos = &#34;CRLF&#34;,mac = &#34;CR&#34;,},</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      <span class="s2">&#34;encoding&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">      <span class="s2">&#34;filetype&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">},</span>
</span></span></code></pre></div><p>由于该插件并不需要定义快捷键，所以我们执行最后一步，在<strong>入口文件</strong>中引入配置文件。 打开 <code>init.lua</code>，增加代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;plugin-config.lualine&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><code>:wq</code> 保存退出，重启后安装生效。</p>
<h2 id="搜索插件">搜索插件<a class="anchor ms-1" href="#搜索插件"><i class="fas fa-link"></i></a></h2>
<p>使用 VSCode 的时候经常使用中内置的模糊查找 <code>Ctrl + p</code> 来查找文件，使用 <code>Ctrl + shift + f</code> 来全局查找，非常方便。</p>
<h3 id="安装-1">安装<a class="anchor ms-1" href="#安装-1"><i class="fas fa-link"></i></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">use</span> <span class="p">{</span> <span class="s1">&#39;nvim-telescope/telescope.nvim&#39;</span><span class="p">,</span> <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;nvim-lua/plenary.nvim&#34;</span> <span class="p">}</span> <span class="p">}</span>
</span></span></code></pre></div><p>安装完成后，需要调用 <code>:checkhealth telescope</code> 检查依赖情况，这里通常会提示 <code>ripgrep</code> 不存在，因为 <code>telescope</code> 依赖以下项目。</p>
<p><strong>mac</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">brew</span> <span class="n">install</span> <span class="n">ripgrep</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">brew</span> <span class="n">install</span> <span class="n">fd</span>
</span></span></code></pre></div><h3 id="快捷键配置-1">快捷键配置<a class="anchor ms-1" href="#快捷键配置-1"><i class="fas fa-link"></i></a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- Telescope begin --</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1">-- 查找文件</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;ff&#34;</span><span class="p">,</span> <span class="s2">&#34;:Telescope find_files&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">-- 全局搜索</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">map</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;fg&#34;</span><span class="p">,</span> <span class="s2">&#34;:Telescope live_grep&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span></code></pre></div><p>这里我定义了 <code>&lt;leader&gt;ff</code> 为 <code>:Telescope find_files</code>命令。  <code>&lt;leader&gt;fg</code> 为 <code>:Telescope live_grep</code> 全局查找。</p>
<p>默认情况下打开窗口就会进入输入模式，这个时候和在普通编辑器一样，可以按 <code>ESC</code> 键进入 <code>Normal</code> 模式，然后 <code>j/k</code> 在文件列表里上下浏览， 按 <code>i</code> 或 <code>a</code> 回到 <code>Insert</code> 模式，按 <code>ESC</code> 退出。</p>
<p>除了默认的快捷键以外，<code>Telescope</code> 还支持在打开的窗口中自定义快捷键，打开 <code>lua/keybindings.lua</code> 继续添加：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- Telescope 列表中 插入模式快捷键</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">pluginKeys.telescopeList</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">i</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="c1">-- 上下移动</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;C-j&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;move_selection_next&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;C-k&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;move_selection_previous&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;Down&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;move_selection_next&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;Up&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;move_selection_previous&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1">-- 历史记录</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;C-n&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;cycle_history_next&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;C-p&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;cycle_history_prev&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="c1">-- 关闭窗口</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;C-c&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;close&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="c1">-- 预览窗口上下滚动</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;C-u&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;preview_scrolling_up&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;C-d&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;preview_scrolling_down&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1">-- Telescope end --</span>
</span></span></code></pre></div><p>这样在插入模式下按 <code>Ctrl + j</code> / <code>Ctrl +k</code> 就可以在文件列表中上下切换了，不再需要切回 <code>Normal</code> 模式了。</p>
<h3 id="配置-telescope-插件">配置 telescope 插件<a class="anchor ms-1" href="#配置-telescope-插件"><i class="fas fa-link"></i></a></h3>
<p>新建配置文件 <code>lua/plugin-config/telescope.lua</code>，代码如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">telescope</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;telescope&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 telescope&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="kr">return</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">telescope.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1">-- 打开弹窗后进入的初始模式，默认为 insert，也可以是 normal</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">initial_mode</span> <span class="o">=</span> <span class="s2">&#34;insert&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="c1">-- 窗口内快捷键</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">mappings</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;keybindings&#34;</span><span class="p">).</span><span class="n">telescopeList</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">pickers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="c1">-- 内置 pickers 配置</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">find_files</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">      <span class="c1">-- 查找文件换皮肤，支持的参数有： dropdown, cursor, ivy</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">      <span class="c1">-- theme = &#34;dropdown&#34;, </span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">extensions</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">     <span class="c1">-- 扩展插件配置</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>Telescope 非常强大，内置了很多的 pickers，比如 <code>:Telescope buffers</code> 命令可以列出打开的 buffers， <code>:Telescope git_files</code> 列出 git 文件，<code>:Telescope man_pages</code> 列出帮助等等。</p>
<p>打开 <code>init.lua</code>，增加代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;plugin-config.telescope&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><code>:wq</code> 保存退出，重启后安装生效。</p>
<p>除了内置的还可以安装<a href="https://github.com/nvim-telescope/telescope.nvim/wiki/Extensions" target="_blank" rel="noopener noreferrer">第三方扩展</a></p>
<p>下边通过一个简单的扩展，演示如何安装扩展。</p>
<p>要安装的扩展叫做 <a href="https://github.com/LinArcX/telescope-env.nvim" target="_blank" rel="noopener noreferrer">telescope-env.nvim</a> 用于列出系统环境变量.</p>
<p>打开 <code>lua/plugins.lua</code> 文件，新增 <code>telescope-env.nvim</code> 相关的内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- telescope extensions</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">use</span> <span class="s2">&#34;LinArcX/telescope-env.nvim&#34;</span>
</span></span></code></pre></div><p><code>:w</code> 保存，自动安装，安装完成后，打开 <code>lua/plugin-config/telescope.lua</code> 文件，在文件最后新增：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- telescope extensions</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">pcall</span><span class="p">(</span><span class="n">telescope.load_extension</span><span class="p">,</span> <span class="s2">&#34;env&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>重启后，就可以调用 <code>:Telescope env</code> 命令，打开环境变量列表了。</p>
<h2 id="启动页面">启动页面<a class="anchor ms-1" href="#启动页面"><i class="fas fa-link"></i></a></h2>
<p>当我们在命令行中输入 <code>nvim</code> 不带任何路径并敲击回车的时候，就会打开这个界面，通常我们会在这个界面中配置最常用功能，比如打开最近编辑过的文件，快速打开项目文件夹，快速修改快捷键等。</p>
<p>最重要的是，我们要自定一个酷酷的 Banner ，表示这是我们独一无二的版本， 首先需要安装 <a href="https://github.com/glepnir/dashboard-nvim" target="_blank" rel="noopener noreferrer">dashboard-nvim</a> 插件。</p>
<h3 id="安装-2">安装<a class="anchor ms-1" href="#安装-2"><i class="fas fa-link"></i></a></h3>
<p>修改 <code>lua/plugins.lua</code> 文件中添加 <code>glepnir/dashboard-nvim</code> 插件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">use</span><span class="p">(</span><span class="s2">&#34;glepnir/dashboard-nvim&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>创建配置文件 <code>lua/plugin-config/dashboard.lua</code>，添加如下内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;dashboard&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 dashboard&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="kr">return</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">db.custom_footer</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="s2">&#34;jimyag&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">db.custom_center</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">desc</span> <span class="o">=</span> <span class="s2">&#34;Projects                            &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;Telescope projects&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="n">desc</span> <span class="o">=</span> <span class="s2">&#34;Recently files                      &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;Telescope oldfiles&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="n">desc</span> <span class="o">=</span> <span class="s2">&#34;Edit keybindings                    &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;edit ~/.config/nvim/lua/keybindings.lua&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="n">desc</span> <span class="o">=</span> <span class="s2">&#34;Edit Projects                       &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;edit ~/.local/share/nvim/project_nvim/project_history&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="c1">-- {</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="c1">--   icon = &#34;  &#34;,</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="c1">--   desc = &#34;Edit .bashrc                        &#34;,</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="c1">--   action = &#34;edit ~/.bashrc&#34;,</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="c1">-- },</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="c1">-- {</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="c1">--   icon = &#34;  &#34;,</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="c1">--   desc = &#34;Change colorscheme                  &#34;,</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="c1">--   action = &#34;ChangeColorScheme&#34;,</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="c1">-- },</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="c1">-- {</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="c1">--   icon = &#34;  &#34;,</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="c1">--   desc = &#34;Edit init.lua                       &#34;,</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="c1">--   action = &#34;edit ~/.config/nvim/init.lua&#34;,</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="c1">-- },</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="c1">-- {</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="c1">--   icon = &#34;  &#34;,</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="c1">--   desc = &#34;Find file                           &#34;,</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">  <span class="c1">--   action = &#34;Telescope find_files&#34;,</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="c1">-- },</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">  <span class="c1">-- {</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">  <span class="c1">--   icon = &#34;  &#34;,</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">  <span class="c1">--   desc = &#34;Find text                           &#34;,</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">  <span class="c1">--   action = &#34;Telescopecope live_grep&#34;,</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">  <span class="c1">-- },</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl"><span class="n">db.custom_header</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">  <span class="s">[[]]</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">  <span class="s">[[          ▀████▀▄▄              ▄█ ]]</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">  <span class="s">[[            █▀    ▀▀▄▄▄▄▄    ▄▄▀▀█ ]]</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">  <span class="s">[[    ▄        █          ▀▀▀▀▄  ▄▀  ]]</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">  <span class="s">[[   ▄▀ ▀▄      ▀▄              ▀▄▀  ]]</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">  <span class="s">[[  ▄▀    █     █▀   ▄█▀▄      ▄█    ]]</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">  <span class="s">[[  ▀▄     ▀▄  █     ▀██▀     ██▄█   ]]</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">  <span class="s">[[   ▀▄    ▄▀ █   ▄██▄   ▄  ▄  ▀▀ █  ]]</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl">  <span class="s">[[    █  ▄▀  █    ▀██▀    ▀▀ ▀▀  ▄▀  ]]</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">70</span><span class="cl">  <span class="s">[[   █   █  █      ▄▄           ▄▀   ]]</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">71</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>db.custom_footer</code> 用于自定义底部显示的文字，我这里显示了本小册的完整的代码地址。</p>
<p><code>db.custom_header</code> 是最重要的部分，用于自定义顶部显示的 ascii 图片，<a href="https://github.com/glepnir/dashboard-nvim/wiki/Ascii-Header-Text" target="_blank" rel="noopener noreferrer">官方 wiki</a> 上有很多推荐图片。</p>
<p>可以搜索一下 ascii 图片生成器，生成自己专属图片，我的文字是使用 [patorjk.com](<a href="http://patorjk.com/software/taag/#p=display&amp;f=ANSI" target="_blank" rel="noopener noreferrer">http://patorjk.com/software/taag/#p=display&f=ANSI</a> Shadow&amp;t=neovim) 生成的。进入后输入文字，然后点击左下角的 <code>Select &amp; Copy</code> 即可复制到剪贴板。</p>
<p>接下来<code>db.custom_center</code> 列出常用功能， 它的基本格式为：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">db.custom_center</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="p">{</span> <span class="n">icon</span> <span class="o">=</span> <span class="s1">&#39;图标&#39;</span><span class="p">,</span> <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39;描述文字&#39;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;命令&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>比如想要增加一条查找文件，就可以：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">desc</span> <span class="o">=</span> <span class="s2">&#34;Find file                           &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;Telescope find_files&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">},</span>
</span></span></code></pre></div><p>这里的图标需要 Nerdfont 字体支持，所以会显示成问号，复制到 Neovim 中就可以正常显示了，你可以到这个网站 <a href="https://www.nerdfonts.com/cheat-sheet" target="_blank" rel="noopener noreferrer">nerdfonts.com/cheat-sheet</a> 搜索想要的图标，并复制过来。</p>
<p>你可以调用任何你想要的命令，比如增加一个换肤功能，调用 <code>Telescope colorscheme</code>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="n">icon</span><span class="o">=</span><span class="s2">&#34;  &#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">desc</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;Change Theme                           &#34;</span><span class="p">},</span> 
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s1">&#39;Telescope colorscheme&#39;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">},</span>
</span></span></code></pre></div><p>我只列举了 4 个，其中 <code>Telescope oldfiles</code> 用于打开最近编辑的文件。 <code>edit ~/.config/nvim/lua/keybindings.lua</code> 用于编辑快捷键， 因为你一定会经常调整快捷键。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="n">desc</span> <span class="o">=</span> <span class="s2">&#34;Projects                            &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;Telescope projects&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">desc</span> <span class="o">=</span> <span class="s2">&#34;Recently files                      &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;Telescope oldfiles&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">desc</span> <span class="o">=</span> <span class="s2">&#34;Edit keybindings                    &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;edit ~/.config/nvim/lua/keybindings.lua&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">desc</span> <span class="o">=</span> <span class="s2">&#34;Edit Projects                       &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="n">action</span> <span class="o">=</span> <span class="s2">&#34;edit ~/.local/share/nvim/project_nvim/project_history&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="p">},</span>
</span></span></code></pre></div><p>剩下的 <code>Telescope projects</code> 并不是 telescope 内置的命令。 而是 telescope 的一个插件，需要安装 <a href="https://github.com/ahmedkhalf/project.nvim" target="_blank" rel="noopener noreferrer">ahmedkhalf/project.nvim</a> 后才能使用。</p>
<p>打开 <code>lua/plugins.lua</code>，别忘了你现在已经可以用 <code> &lt;leader&gt;ff</code> 模糊搜索找到它了， 在文件中添加 <code>ahmedkhalf/project.nvim</code> 插件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- project</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">use</span><span class="p">(</span><span class="s2">&#34;ahmedkhalf/project.nvim&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><code>:w</code> 保存，自动安装，安装完整按 <code>q</code> 退出。</p>
<p>根据 <code>project.nvim</code> 的文档，首先要确保我们之前设置的 <code>lua/plugin-config/nvim-tree.lua</code> 配置文件中有下边这一段代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">nvim_tree.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="c1">--- 上略</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="c1">-- project plugin 需要这样设置</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">update_cwd</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="n">update_focused_file</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">update_cwd</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="c1">-- 下略</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这段代码让 <code>nvim-tree</code> 支持切换目录。 之后可以创建 <code>lua/plugin-config/project.lua</code> 配置文件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">project</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;project_nvim&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 project_nvim&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="kr">return</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kr">end</span><span class="c1">-- nvim-tree 支持</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">vim.g</span><span class="p">.</span><span class="n">nvim_tree_respect_buf_cwd</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">project.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">detection_methods</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;pattern&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">patterns</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&#34;.git&#34;</span><span class="p">,</span> <span class="s2">&#34;_darcs&#34;</span><span class="p">,</span> <span class="s2">&#34;.hg&#34;</span><span class="p">,</span> <span class="s2">&#34;.bzr&#34;</span><span class="p">,</span> <span class="s2">&#34;.svn&#34;</span><span class="p">,</span> <span class="s2">&#34;Makefile&#34;</span><span class="p">,</span> <span class="s2">&#34;package.json&#34;</span><span class="p">,</span> <span class="s2">&#34;.sln&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">telescope</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;telescope&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 telescope&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="kr">return</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">pcall</span><span class="p">(</span><span class="n">telescope.load_extension</span><span class="p">,</span> <span class="s2">&#34;projects&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><code>pcall</code> 的部分应该非常熟悉了，如果没有找到 <code>project_nvim</code>， 那么就不继续执行。</p>
<p><code>detection_methods</code> 设置检测方式，这里设置为 <code>pattern</code>，也就是按照下边的 patterns 参数来检测，当文件夹里有这些文件时，就会被当作一个 project 文件夹，自动保存在配置文件中。</p>
<p>保存后，最后一步别忘了在 <strong>入口文件</strong> 中引入这两个配置文件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;plugin-config.dashboard&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;plugin-config.project&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>重启后 <code>Telescope projects</code> 即可生效，当我们命令行中输入 <code>nvim</code> 回车后进入启动画面，j、k 切换选项，再次回车即可执行对应命令。</p>
<p>但有时候会发现 project 列表并不是我常用的项目列表，列出了很多没用的项目，这时候就需要手动编辑 <code>project_history</code> 列表了，但这个列表保存在哪里呢？</p>
<p>运行命令 <code>:lua print(require(&quot;project_nvim.utils.path&quot;).historyfile)</code> 就可以看到 <code>project_history</code> 文件的路径了。</p>
<p>我这里显示的是 <code>~/.local/share/nvim/project_nvim/project_history</code> 这个文件，我们可以直接手动修改这个文件，仅保存常用的项目。</p>
<h2 id="语法高亮">语法高亮<a class="anchor ms-1" href="#语法高亮"><i class="fas fa-link"></i></a></h2>
<p>提到代码高亮，首先要提到的是 <a href="https://tree-sitter.github.io/tree-sitter/" target="_blank" rel="noopener noreferrer">Tree-sitter</a> 项目， Tree-sitter 是一个解析器生成器工具和增量解析库，它可以在源文件编辑的同时高效的实时生成语法树.</p>
<p>接着出现的是 <a href="https://github.com/nvim-treesitter/nvim-treesitter" target="_blank" rel="noopener noreferrer">nvim-treesitter</a> 项目，<code>nvim-treesitter</code> 是 <code>Neovim</code> 下的 <code>Tree-sitter</code> 配置和抽象层，它的目标是给 <code>Neovim</code> 提供一个简单的 <code>Tree-sitter</code> 接口，并且提供多个基于 <code>Tree-sitter</code> 的基础功能模块，它可以让你在 nvim 中高效的实现 <strong>代码高亮</strong>，<strong>增量选择</strong> 等基础功能。</p>
<h3 id="安装-3">安装<a class="anchor ms-1" href="#安装-3"><i class="fas fa-link"></i></a></h3>
<p>修改 <code>lua/plugins.lua</code> 文件中添加 <code>nvim-treesitter/nvim-treesitter</code> 插件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"> <span class="n">use</span><span class="p">({</span> <span class="s2">&#34;nvim-treesitter/nvim-treesitter&#34;</span> <span class="p">})</span>
</span></span></code></pre></div><h3 id="安装language-parser">安装Language parser<a class="anchor ms-1" href="#安装language-parser"><i class="fas fa-link"></i></a></h3>
<p>你可以运行 <code>:TSInstallInfo</code> 命令查看 language parsers 列表与安装状态。</p>
<p>如果我们要安装指定的 <code>Language parser</code>，则我们需要调用命令：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vim" data-lang="vim"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">:</span><span class="nx">TSInstall</span> <span class="p">&lt;</span><span class="nx">language_to_install</span><span class="p">&gt;</span><span class="err">
</span></span></span></code></pre></div><p>比如我们要安装 <code>Golang</code> ，则应该调 <code>:TSInstall go</code></p>
<p>当我们调用 <code>TSInstall</code> 命令的时候，插件会我们生成一个 <code>&lt;language&gt;.so</code> 语法文件，放在插件的 <code>parser</code> 文件夹内，比如我的系统中完整目录在：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">➜  parser git:<span class="o">(</span>master<span class="o">)</span> <span class="nb">pwd</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">/Users/jimyag/.local/share/nvim/site/pack/packer/start/nvim-treesitter/parser
</span></span><span class="line"><span class="ln">3</span><span class="cl">➜  parser git:<span class="o">(</span>master<span class="o">)</span> ls
</span></span><span class="line"><span class="ln">4</span><span class="cl">cpp.so    go.so     gomod.so  gowork.so java.so   lua.so    python.so vim.so
</span></span></code></pre></div><p>进入目录会发现我安装的 <code>go.so</code> ，每个文件只有几百 KB 大小。</p>
<p>如果这个时候运行 <code>:TSInstallInfo</code> 则 <code>go</code> 也会对应打上勾勾。</p>
<p>对应的 <code>:TSUninstall &lt;language_to_uninstall&gt;</code> 命令用于卸载 language parser 。</p>
<p>其实我们可以不必手动安装 <code>language parsers</code> ，可以在 <code>nvim-treesitter</code> 的配置文件中指定自动安装，下边开始配置 <code>nvim-treesitter</code>。</p>
<h3 id="配置-nvim-treesitter">配置 nvim-treesitter<a class="anchor ms-1" href="#配置-nvim-treesitter"><i class="fas fa-link"></i></a></h3>
<p>创建 <code>lua/plugin-config/nvim-treesitter.lua</code> 文件。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">treesitter</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;nvim-treesitter.configs&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 nvim-treesitter&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="kr">return</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">treesitter.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">-- 安装 language parser</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">-- :TSInstallInfo 命令查看支持的语言</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">ensure_installed</span> <span class="o">=</span>  <span class="p">{</span> <span class="s2">&#34;go&#34;</span><span class="p">,</span> <span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="s2">&#34;cpp&#34;</span><span class="p">,</span> <span class="s2">&#34;vim&#34;</span><span class="p">,</span> <span class="s2">&#34;lua&#34;</span><span class="p">,</span> <span class="s2">&#34;java&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="c1">-- 启用代码高亮模块</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">highlight</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">additional_vim_regex_highlighting</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p><code>ensure_installed</code> 就是自动安装 parsers，不必提前手动安装，只要这里列出，下次重启后就会自动安装，当然如果设置过多那么首次重启会卡一下，而且网络不好的话每个下载失败都会报错。</p>
<p>你可以和上述代码一样为<code>ensure_installed</code> 制定一个列表，也可以是直接设置为 <code>&quot;all&quot;</code> 或 <code>&quot;maintained&quot;</code> ，表示一次下载所有的 parsers。下次重启后就会下载对应的语法文件了。 这里建议你还是自定义用到的语言列表，其次是设置成 <code>maintained</code> 如果设置成 <code>maintained</code> ，那么我这里的下载量大概在 45MB 左右，给你作为参考。</p>
<p><code>highlight</code> 是 <code>nvim-treesitter</code> 的语法高亮模块，设置 <code>enable</code> 为 <code>true</code> 则开启语法高亮功能，由于使用基于 <code>treesitter</code> 的语法高亮，所以将<code>additional_vim_regex_highlighting</code> 设置为 <code>false</code> 关闭 vim 的正则语法高亮。</p>
<p>保存后别忘了在 <strong>入口文件</strong> 中引入该配置文件。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;plugin-config.nvim-treesitter&#34;</span><span class="p">)</span> <span class="c1">-- （新增）</span>
</span></span></code></pre></div><p>重启后，如果一切正常即可看到代码高亮效果，调用 <code>:TSBufToggle highlight</code> 命令可以切换打开关闭代码高亮功能.</p>
<p>然而这个代码高亮颜色，和我们之前安装的 <code>colorscheme</code> 支持程度有关，不同的主题配色显示会不一样，你可以在 <code>nvim-treesitter</code> 的 <a href="https://github.com/nvim-treesitter/nvim-treesitter/wiki/Colorschemes" target="_blank" rel="noopener noreferrer">wiki</a>里查看不同到皮肤的显示效果。</p>
<p>除了代码高亮功能外，<code>nvim-treesitter</code> 还提供其他 3 个内置模块功能，可以根据你的需要添加，下边介绍增量选择模块。</p>
<h4 id="增量选择模块">增量选择模块<a class="anchor ms-1" href="#增量选择模块"><i class="fas fa-link"></i></a></h4>
<p>什么是增量选择 (incremental selection) ？ 当你的光标在一个语法结点上时，可以设置一个增加键和一个减少键，敲击这两个，在表现上为不断外扩和收缩选中代码。</p>
<p>如果你需要这个功能，需要打开 <code>lua/plugin-config/nvim-treesitter.lua</code> 文件，在 <code>highlight</code> 模块下方，增加如下代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- 启用增量选择模块</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">incremental_selection</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">keymaps</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">init_selection</span> <span class="o">=</span> <span class="s2">&#34;&lt;CR&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">node_incremental</span> <span class="o">=</span> <span class="s2">&#34;&lt;CR&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">node_decremental</span> <span class="o">=</span> <span class="s2">&#34;&lt;BS&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">scope_incremental</span> <span class="o">=</span> <span class="s2">&#34;&lt;TAB&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">},</span>
</span></span></code></pre></div><p>注意到上边代码，为了减少记忆额外快捷键的负担，我将增加和减少结点的快捷键设置成了 <strong>回车</strong> 和 <strong>退格</strong> 。通过不断的按 Enter 选择区域会从里层不断外扩， Backspace 则相反不断内收。</p>
<p>除了增量选择模块，<code>nvim-treesitter</code> 还内置了一个比较实用的代码缩进模块，用于简单的代码缩进调整，下边介绍一下。</p>
<h4 id="代码缩进模块">代码缩进模块<a class="anchor ms-1" href="#代码缩进模块"><i class="fas fa-link"></i></a></h4>
<p>启用该模块后，可以使用 <code>=</code> 操作符对代码缩进</p>
<p>先选中要缩进的代码，然后按 <code>=</code> 键，即可对选中代码缩进。</p>
<p>如果要对整个文件进行缩进，可以使用 <code>gg=G</code> 组合键，因为 <code>gg</code> 是跳到首行，<code>G</code> 是跳到尾行，<code>gg=G</code> 就是从首行一直缩进到尾行，相当于 <code>ggvG</code> 选中整个文件然后用 <code>=</code> 格式化。</p>
<p>如果你经常使用这个组合键，那么你可以考虑像我们之前一样，添加一个快捷键到 <code>lua/keybindings.lua</code>，这里不再详述。</p>
<p>想要启用代码缩进功能模块，需要打开 <code>lua/plugin-config/nvim-treesitter.lua</code> 文件，在 <code>incremental_selection</code> 模块下方，增加如下代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl">  <span class="c1">-- 启用代码缩进模块 (=)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">indent</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="p">},</span>
</span></span></code></pre></div><p><code>nvim-treesitter</code> 还内置了一个基于 <code>Tree-sitter</code> 的代码折叠功能模块，下边介绍一下。</p>
<h4 id="代码折叠模块">代码折叠模块<a class="anchor ms-1" href="#代码折叠模块"><i class="fas fa-link"></i></a></h4>
<p>代码折叠可以使代码更清晰，更易于阅读，基于 <code>Tree-sitter</code> 的代码折叠可以精确的折叠 <code>{}</code> 中的内容。</p>
<p>使用了 <code>zc</code> 组合键来折叠 <code>{}</code> 中的内容，还可以使用 <code>zo</code> 组合键来打开对应的折叠。</p>
<p>如果你需要这个功能，那么打开 <code>lua/plugin-config/nvim-treesitter.lua</code>，在文件的最下方插入代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- 开启 Folding 模块</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">vim.opt</span><span class="p">.</span><span class="n">foldmethod</span> <span class="o">=</span> <span class="s2">&#34;expr&#34;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">vim.opt</span><span class="p">.</span><span class="n">foldexpr</span> <span class="o">=</span> <span class="s2">&#34;nvim_treesitter#foldexpr()&#34;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">-- 默认不要折叠</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1">-- https://stackoverflow.com/questions/8316139/how-to-set-the-default-to-unfolded-when-you-open-a-file</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">vim.opt</span><span class="p">.</span><span class="n">foldlevel</span> <span class="o">=</span> <span class="mi">99</span>
</span></span></code></pre></div><p>注意这次是插入在文件的最下方，因为这个功能严格意义上不是一个模块，因为它对应的是 windows 而不是一个 buffer。</p>
<p>最后，你可以运行 <code>:TSModuleInfo</code> 命令来查看你的模块是否开启成功</p>
<h3 id="lsp-配置">LSP 配置<a class="anchor ms-1" href="#lsp-配置"><i class="fas fa-link"></i></a></h3>
<p>想要在 <code>Neovim</code> 中配置代码补全、代码悬停、代码提示等等功能，首先要了解什么是 LSP (Language Server Protocol) 语言服务协议?</p>
<p>在 LSP 出现之前，传统的 IDE 都要为其支持的每个语言实现类似的代码补全、文档提示、跳转到定义等功能，不同的 IDE 做了很多重复的工作，并且兼容性也不是很好。 LSP 的出现将编程工具解耦成了 <strong>Language Server</strong> 与 <strong>Language Client</strong> 两部分。定义了编辑器与语言服务器之间交互协议。</p>
<p><picture><img class="img-fluid" alt="12-1.png" src="/posts/20d50b9d/index/11556d465ae2488a81ced76c51a36bd0~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" loading="lazy"
    
     />
</picture>

</p>
<p>Client 专注于显示样式实现， Server 负责提供语言支持，包括常见的自动补全、跳转到定义、查找引用、悬停文档提示等功能。</p>
<p>而我们所说的 Neovim 内置 LSP 就是说 Neovim 内置了一套 Language Client 端的实现，这样我们就可以连接到和 VSCode 相同的第三方 language servers ，实现高质量的语法补全等功能。</p>
<h4 id="开启-neovim-内置-lsp">开启 Neovim 内置 LSP<a class="anchor ms-1" href="#开启-neovim-内置-lsp"><i class="fas fa-link"></i></a></h4>
<p>通过命令 <code>:h lsp</code> 查看 LSP 文档的 QUICKSTART 部分写了 4 步：</p>
<ol>
<li>安装 nvim-lspconfig</li>
<li>安装对应 language server</li>
<li>配置对应语言 require(&rsquo;lspconfig&rsquo;).xx.setup{…}</li>
<li>:lua print(vim.inspect(vim.lsp.buf_get_clients())) 查看 LSP 连接状态</li>
</ol>
<p>首先第一步就是要配置客户端，之所以要安装 <a href="https://github.com/neovim/nvim-lspconfig" target="_blank" rel="noopener noreferrer">nvim-lspconfig</a> ，是因为 <code>nvim-lspconfig</code> 提供了一堆常见服务的配置方式。</p>
<p>第二步就是安装语言服务器,现在有了 <a href="https://github.com/williamboman/nvim-lsp-installer" target="_blank" rel="noopener noreferrer">nvim-lsp-installer</a> 项目，可以帮助我们管理，并自动安装 Language Server。</p>
<p>所以我们把这两个插件一并安装起来，打开 <code>lua/plugins.lua</code> 添加 <code>nvim-lspconfig</code> 和 <code>nvim-lsp-installer</code> 组件。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl">    <span class="c1">--------------------- LSP --------------------</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="n">use</span><span class="p">({</span> <span class="s2">&#34;williamboman/nvim-lsp-installer&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="c1">-- Lspconfig</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="n">use</span><span class="p">({</span> <span class="s2">&#34;neovim/nvim-lspconfig&#34;</span> <span class="p">})</span>
</span></span></code></pre></div><h4 id="安装-lsp-servers">安装 LSP Servers<a class="anchor ms-1" href="#安装-lsp-servers"><i class="fas fa-link"></i></a></h4>
<p>我们先来看一下最简单的方式，运行 <code>:LspInstallInfo</code> 命令，会打开一个图形化界面</p>
<p><code>Available servers</code> 中列出了可以安装的 servers，这时你可以使用 <code>j / k</code> 移动光标到你要安装的 server，点击键盘 <code>i</code> 安装，i 表示 install。</p>
<p>在该界面还有一些其他的快捷键，比如：</p>
<ul>
<li>大写的 <code>X</code> 是卸载该 server</li>
<li><code>u</code> 是更新 server</li>
<li>大写 <code>U</code> 更新所有 servers</li>
<li><code>c</code> 检查 server 新版本</li>
<li>大写 <code>C</code> 检查所有 servers 的新版本</li>
<li><code>ESC</code> 关闭窗口</li>
<li><code>?</code> 显示其他帮助信息</li>
</ul>
<p>几乎所有 Language Server 的管理都可以在这个界面搞定。下边 LSP 的配置部分。</p>
<h4 id="配置-lsp-server">配置 LSP Server<a class="anchor ms-1" href="#配置-lsp-server"><i class="fas fa-link"></i></a></h4>
<p>因为会创建很多文件，所以我们首先创建一个新的目录 <code>lua/lsp/</code> 专门存放 lsp 相关的配置，这样可以使配置文件组织更加清晰。</p>
<p>然后创建第一个文件 <code>lua/lsp/setup.lua</code>，内容如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">lsp_installer</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;nvim-lsp-installer&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1">-- 安装列表</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">-- { key: 语言 value: 配置文件 }</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1">-- key 必须为下列网址列出的名称</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1">-- https://github.com/williamboman/nvim-lsp-installer#available-lsps</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kd">local</span> <span class="n">servers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">sumneko_lua</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;lsp.config.lua&#34;</span><span class="p">),</span> <span class="c1">-- lua/lsp/config/lua.lua</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">-- 自动安装 Language Servers</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="kr">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">servers</span><span class="p">)</span> <span class="kr">do</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="kd">local</span> <span class="n">server_is_found</span><span class="p">,</span> <span class="n">server</span> <span class="o">=</span> <span class="n">lsp_installer.get_server</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="kr">if</span> <span class="n">server_is_found</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="kr">if</span> <span class="ow">not</span> <span class="n">server</span><span class="p">:</span><span class="n">is_installed</span><span class="p">()</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">      <span class="n">print</span><span class="p">(</span><span class="s2">&#34;Installing &#34;</span> <span class="o">..</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="n">server</span><span class="p">:</span><span class="n">install</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="kr">end</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="n">lsp_installer.on_server_ready</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">servers</span><span class="p">[</span><span class="n">server.name</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="kr">if</span> <span class="n">config</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="kr">return</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="kr">if</span> <span class="n">config.on_setup</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="n">config.on_setup</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="kr">else</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="n">server</span><span class="p">:</span><span class="n">setup</span><span class="p">({})</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="kr">end</span><span class="p">)</span>
</span></span></code></pre></div><p>简单解释一下上述代码和配置文件的目录结构。首先我们创建了一个 <code>servers</code> 字典变量，用来存放所有的 LSP Server 的配置。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">local</span> <span class="n">servers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">sumneko_lua</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;lsp.config.lua&#34;</span><span class="p">),</span> <span class="c1">-- lua/lsp/config/lua.lua</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>这里的 key <code>sumneko_lua</code> 不是随意设置的，而是 <code>nvim-lsp-installer</code> 中 lua 语言的 server name，你可以在 <a href="https://github.com/williamboman/nvim-lsp-installer#available-lsps" target="_blank" rel="noopener noreferrer">这个网址</a> 中查到合法的值。</li>
<li>这里的 value <code>require(&quot;lsp.config.lua&quot;)</code> 表示该 Server 对应的配置文件 <code>lua/lsp/config/lua.lua</code> 内容，这个文件需要我们自己创建，这个我们稍后创建。</li>
</ul>
<p>接下来的这段代码，是遍历 <code>servers</code> 字典，检查每个 server 是否已经安装，如果没有安装，就调用 <code>install()</code> 方法来安装。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="kr">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">servers</span><span class="p">)</span> <span class="kr">do</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="kd">local</span> <span class="n">server_is_found</span><span class="p">,</span> <span class="n">server</span> <span class="o">=</span> <span class="n">lsp_installer.get_server</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="kr">if</span> <span class="n">server_is_found</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">    <span class="kr">if</span> <span class="ow">not</span> <span class="n">server</span><span class="p">:</span><span class="n">is_installed</span><span class="p">()</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      <span class="n">print</span><span class="p">(</span><span class="s2">&#34;Installing &#34;</span> <span class="o">..</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">      <span class="n">server</span><span class="p">:</span><span class="n">install</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="kr">end</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div><p>也就是说，如果你还没有按照之前的方法手动安装过 lua server ，那么这里会自动帮你安装上。</p>
<p>下边这段代码，是 <code>lsp_installer</code> 的回调函数，这个函数会在每个 LSP Server 准备好时调用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">lsp_installer.on_server_ready</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="kd">local</span> <span class="n">config</span> <span class="o">=</span> <span class="n">servers</span><span class="p">[</span><span class="n">server.name</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="kr">if</span> <span class="n">config</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">        <span class="kr">return</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="kr">if</span> <span class="n">config.on_setup</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">config.on_setup</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="kr">else</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">server</span><span class="p">:</span><span class="n">setup</span><span class="p">({})</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="kr">end</span><span class="p">)</span>
</span></span></code></pre></div><p>在回调函数中，我会先查看我们的 <code>servers</code> 字典中有没有这个 server 的配置文件，如果没有，就什么都不执行。 然后我会查看配置文件中，是否有 <code>on_setup</code> 函数，如果有，就执行这个函数，否则就用默认无配置参数。</p>
<p>之后我会在每个 Language Server 配置文件中导出一个 <code>on_setup</code> 函数，用于初始化该 Server，这样做是因为我发现每个 Server 初始化方法并不完全相同， 用同一套初始化流程并不能满足不同语言定制的需要，所以我将初始化方法抽离出来，让每个 Server 的配置文件来负责初始化。</p>
<p>我们第一个要创建的 Language Server 配置文件就是之前 require 的 lua 文件。</p>
<h4 id="配置-lua-server">配置 Lua Server<a class="anchor ms-1" href="#配置-lua-server"><i class="fas fa-link"></i></a></h4>
<p>创建文件 <code>lua/lsp/config/lua.lua</code>，内容如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#sumneko_lua</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">local</span> <span class="n">runtime_path</span> <span class="o">=</span> <span class="n">vim.split</span><span class="p">(</span><span class="n">package.path</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">table.insert</span><span class="p">(</span><span class="n">runtime_path</span><span class="p">,</span> <span class="s1">&#39;lua/?.lua&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">table.insert</span><span class="p">(</span><span class="n">runtime_path</span><span class="p">,</span> <span class="s1">&#39;lua/?/init.lua&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kd">local</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">Lua</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="n">runtime</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">                <span class="c1">-- Tell the language server which version of Lua you&#39;re using (most likely LuaJIT in the case of Neovim)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">                <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;LuaJIT&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">                <span class="c1">-- Setup your lua path</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">                <span class="n">path</span> <span class="o">=</span> <span class="n">runtime_path</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="n">diagnostics</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">                <span class="c1">-- Get the language server to recognize the `vim` global</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">                <span class="n">globals</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;vim&#39;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">workspace</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">                <span class="c1">-- Make the server aware of Neovim runtime files</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">                <span class="n">library</span> <span class="o">=</span> <span class="n">vim.api</span><span class="p">.</span><span class="n">nvim_get_runtime_file</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">                <span class="n">checkThirdParty</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="c1">-- Do not send telemetry data containing a randomized but unique identifier</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="n">telemetry</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                <span class="n">enable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="n">flags</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="n">debounce_text_changes</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="n">on_attach</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">bufnr</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="c1">-- 禁用格式化功能，交给专门插件插件处理</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="n">client.resolved_capabilities</span><span class="p">.</span><span class="n">document_formatting</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="n">client.resolved_capabilities</span><span class="p">.</span><span class="n">document_range_formatting</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">        <span class="kd">local</span> <span class="kr">function</span> <span class="nf">buf_set_keymap</span><span class="p">(...)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">            <span class="n">vim.api</span><span class="p">.</span><span class="n">nvim_buf_set_keymap</span><span class="p">(</span><span class="n">bufnr</span><span class="p">,</span> <span class="p">...)</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="kr">end</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">        <span class="c1">-- 绑定快捷键</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="n">require</span><span class="p">(</span><span class="s1">&#39;keybindings&#39;</span><span class="p">).</span><span class="n">mapLSP</span><span class="p">(</span><span class="n">buf_set_keymap</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="c1">-- 保存时自动格式化</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="n">vim.cmd</span><span class="p">(</span><span class="s1">&#39;autocmd BufWritePre &lt;buffer&gt; lua vim.lsp.buf.formatting_sync()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="kr">end</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="c1">-- 查看目录等信息</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="kr">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="n">on_setup</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">        <span class="n">server</span><span class="p">:</span><span class="n">setup</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="kr">end</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>简单解释一下上述代码。先看最后 5 行代码，之前说过我们会让每个 Language Server 配置文件都导出一个 <code>on_setup</code> 函数，用于初始化该 Language Server。 这个函数会接收一个 <code>server</code> 参数， 我们通常会在这个函数中调用 <code>server:setup</code> 方法，并传入我们定制的 <code>opts</code> 参数来初始化语言服务。</p>
<p>在这个 <code>opts</code> 参数里通常会有两个关键项需要你来定制： <code>settings</code> 和 <code>on_attach</code>。</p>
<ul>
<li><code>settings</code> 主要用来配置语言服务，我们一般会在 <code>nvim-lspconfig</code> 项目的 <a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md" target="_blank" rel="noopener noreferrer">服务器配置项页面</a> 找到对应语言的示例配置。</li>
<li><code>on_attach</code> 是一个回调函数，当语言服务成功绑定到一个 buffer 上时会调用这个函数，所以通常我们会在这个函数里做一些比如快捷键绑定，自动命令，或者设置 buffer 的某些特性等操作。</li>
</ul>
<p>上边代码 <code>on_attach</code> 中调用了 <code>keybindings</code> 文件的 <code>mapLSP</code> 方法。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="err">`</span><span class="n">require</span><span class="p">(</span><span class="s2">&#34;keybindings&#34;</span><span class="p">).</span><span class="n">mapLSP</span><span class="p">(</span><span class="n">buf_set_keymap</span><span class="p">)</span><span class="err">`</span>
</span></span></code></pre></div><p>这样做的目的是为了把定义快捷键的代码抽离出来，都放在<code>lua/keybindings.lua</code> 这一个位置来统一管理，那么看一下都定义了哪些快捷键。</p>
<h4 id="配置-go-server">配置 Go Server<a class="anchor ms-1" href="#配置-go-server"><i class="fas fa-link"></i></a></h4>
<p>创建文件 <code>lua/lsp/config/go.lua</code>，内容如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">nvim_lsp</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;lspconfig&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kd">local</span> <span class="n">opts</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">	<span class="n">on_attach</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="n">bufnr</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">		<span class="kd">local</span> <span class="kr">function</span> <span class="nf">buf_set_keymap</span><span class="p">(...)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">			<span class="n">vim.api</span><span class="p">.</span><span class="n">nvim_buf_set_keymap</span><span class="p">(</span><span class="n">bufnr</span><span class="p">,...)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">		<span class="kr">end</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">		<span class="n">require</span><span class="p">(</span><span class="s2">&#34;keybindings&#34;</span><span class="p">).</span><span class="n">mapLSP</span><span class="p">(</span><span class="n">buf_set_keymap</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">		<span class="n">vim.cmd</span><span class="p">(</span><span class="s1">&#39;autocmd BufWritePre &lt;buffer&gt; lua vim.lsp.buf.formatting_sync()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">	<span class="kr">end</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="c1">-- capabilities = capabilities,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">root_dir</span> <span class="o">=</span> <span class="n">nvim_lsp.util</span><span class="p">.</span><span class="n">root_pattern</span><span class="p">(</span><span class="s1">&#39;.git&#39;</span><span class="p">,</span> <span class="s1">&#39;go.mod&#39;</span><span class="p">,</span><span class="s1">&#39;go.work&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">init_options</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">usePlaceholders</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">	<span class="n">single_file_support</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1">-- 查看目录等信息</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="kr">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">on_setup</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">server</span><span class="p">:</span><span class="n">setup</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="kr">end</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>在<code>lua/lsp/setup.lua</code>中添加</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">local</span> <span class="n">servers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  	<span class="n">sumneko_lua</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;lsp.config.lua&#34;</span><span class="p">),</span> <span class="c1">-- lua/lsp/config/lua.lua</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">		<span class="n">gopls</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;lsp.config.go&#34;</span><span class="p">)</span> <span class="c1">-- lua/lsp/config/go.lua  新增</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="定义-lsp-快捷键">定义 LSP 快捷键<a class="anchor ms-1" href="#定义-lsp-快捷键"><i class="fas fa-link"></i></a></h4>
<p>现在打开 <code>lua/keybindings.lua</code> 文件，在 pluginKeys 变量声明的后边添加 <code>mapLSP</code> 方法:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- lsp 回调函数快捷键设置</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">pluginKeys.mapLSP</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">mapbuf</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">-- rename</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;rn&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.lsp.buf.rename()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="c1">-- code action</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;ca&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.lsp.buf.code_action()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="c1">-- go xx</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gd&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.lsp.buf.definition()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gh&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.lsp.buf.hover()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gD&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.lsp.buf.declaration()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gi&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.lsp.buf.implementation()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gr&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.lsp.buf.references()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="c1">-- diagnostic</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gp&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.diagnostic.open_float()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gk&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.diagnostic.goto_prev()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gj&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.diagnostic.goto_next()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;f&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.lsp.buf.formatting()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="c1">-- 没用到</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">-- mapbuf(&#39;n&#39;, &#39;&lt;leader&gt;q&#39;, &#39;&lt;cmd&gt;lua vim.diagnostic.setloclist()&lt;CR&gt;&#39;, opt)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="c1">-- mapbuf(&#34;n&#34;, &#34;&lt;C-k&gt;&#34;, &#34;&lt;cmd&gt;lua vim.lsp.buf.signature_help()&lt;CR&gt;&#34;, opt)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="c1">-- mapbuf(&#39;n&#39;, &#39;&lt;space&gt;wa&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.add_workspace_folder()&lt;CR&gt;&#39;, opt)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="c1">-- mapbuf(&#39;n&#39;, &#39;&lt;space&gt;wr&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.remove_workspace_folder()&lt;CR&gt;&#39;, opt)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="c1">-- mapbuf(&#39;n&#39;, &#39;&lt;space&gt;wl&#39;, &#39;&lt;cmd&gt;lua print(vim.inspect(vim.lsp.buf.list_workspace_folders()))&lt;CR&gt;&#39;, opt)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="c1">-- mapbuf(&#39;n&#39;, &#39;&lt;space&gt;D&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.type_definition()&lt;CR&gt;&#39;, opt)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div><p>注意这里的快捷键是所有语言服务器通用的，也就是说未来添加任何语言，都会调用到这里的 mapLSP 方法。</p>
<p>大部分都设置为 g 开头，为方便记忆，表示 go XX，比如 <code>gd</code> 跳转到定义， 然后 <code>gh</code> 显示提示等。</p>
<p>建议根据你自己的习惯修改，这是我目前的配置，未来也可能随时会有修改。</p>
<p>最后一步，别忘了在 <strong>入口文件</strong> 中引入 <code>lua/lsp/setup.lua</code> 才能生效。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- 内置LSP (新增)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;lsp.setup&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><code>:wq</code> 保存后重启，如果没有报错的话，就应该生效了。</p>
<h3 id="lsp-补全">LSP 补全<a class="anchor ms-1" href="#lsp-补全"><i class="fas fa-link"></i></a></h3>
<p>Neovim 本身不支持代码补全，需要通过插件实现，我这里使用最流行的 <a href="https://github.com/hrsh7th/nvim-cmp" target="_blank" rel="noopener noreferrer">nvim-cmp</a> 插件。</p>
<p>在安装自动代码补全之前，需要了解几个概念：</p>
<ol>
<li>
<p>补全引擎</p>
<p>补全引擎就是为 Neovim 提供代码补全核心功能的插件，比如 <a href="https://github.com/hrsh7th/nvim-cmp" target="_blank" rel="noopener noreferrer">nvim-cmp</a>。</p>
</li>
<li>
<p>补全源</p>
<p>补全源就是补全引擎需要的数据来源，最常见的来源是来自 Language Server 提供的数据，它会知道某个类有哪些属性和方法等。</p>
</li>
<li>
<p>snippet 引擎</p>
<p>snippet 引擎就是自定义代码段的引擎，常见的有 <code>vsnip</code>、<code>luasnip</code> 等</p>
</li>
</ol>
<p>三个词组一个句子，可以说：</p>
<p>nvim-cmp 是使用 Lua 编写的 <strong>补全引擎</strong> 插件。可以配置多种外部的<strong>补全源</strong>，支持 <code>vsnip</code>、<code>luasnip</code>、<code>snippy</code>、 <code>ultisnips</code> 4 种 <strong>snippet 引擎</strong> 。</p>
<h4 id="安装补全相关插件">安装补全相关插件<a class="anchor ms-1" href="#安装补全相关插件"><i class="fas fa-link"></i></a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">packer.startup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="kr">function</span><span class="p">(</span><span class="n">use</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">        <span class="c1">-- 补全引擎</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="n">use</span><span class="p">(</span><span class="s2">&#34;hrsh7th/nvim-cmp&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="c1">-- snippet 引擎</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">use</span><span class="p">(</span><span class="s2">&#34;hrsh7th/vim-vsnip&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="c1">-- 补全源</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">use</span><span class="p">(</span><span class="s2">&#34;hrsh7th/cmp-vsnip&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="n">use</span><span class="p">(</span><span class="s2">&#34;hrsh7th/cmp-nvim-lsp&#34;</span><span class="p">)</span> <span class="c1">-- { name = nvim_lsp }</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="n">use</span><span class="p">(</span><span class="s2">&#34;hrsh7th/cmp-buffer&#34;</span><span class="p">)</span> <span class="c1">-- { name = &#39;buffer&#39; },</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="n">use</span><span class="p">(</span><span class="s2">&#34;hrsh7th/cmp-path&#34;</span><span class="p">)</span> <span class="c1">-- { name = &#39;path&#39; }</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="n">use</span><span class="p">(</span><span class="s2">&#34;hrsh7th/cmp-cmdline&#34;</span><span class="p">)</span> <span class="c1">-- { name = &#39;cmdline&#39; }</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1">-- 常见编程语言代码段</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">use</span><span class="p">(</span><span class="s2">&#34;rafamadriz/friendly-snippets&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="kr">end</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>简单解释一下上述代码，我们好像这一次装了好多插件，其实只有 <code>hrsh7th/nvim-cmp</code> 是补全引擎插件本身，其他 <code>cmp-xxx</code> 基本都是插件补全来源，也就是说当你输入一个变量的时候，可以从多个来源显示补全的内容。</p>
<p>像 <code>hrsh7th/cmp-nvim-lsp</code> 就是 Neovim 内置 LSP 提供的补全内容，<code>hrsh7th/cmp-buffer</code> 补全当前 buffer 的内容， <code>hrsh7th/cmp-cmdline</code> 是命令行的补全，<code>hrsh7th/cmp-path</code> 则是用来补全路径，如果配置了这个，当输入一个路径的时候会补全路径。</p>
<p><code>hrsh7th/vim-vsnip</code> 就是一个 snippet 引擎，也就是自定义代码段，文档中提到了 4 种，都是支持的</p>
<p>snippet engine</p>
<ul>
<li>vsnip</li>
<li>luasnip</li>
<li>ultisnips</li>
<li>snippy</li>
</ul>
<p><code>rafamadriz/friendly-snippets</code> 包含了大部分常用语言的代码段，非常强大，可以到他的 github 主页查看详细内容。</p>
<p>不多说 <code>:wq</code> 保存后重启，如遇问题可 <code>:PackerSync</code> 再次安装。</p>
<h4 id="配置自动补全">配置自动补全<a class="anchor ms-1" href="#配置自动补全"><i class="fas fa-link"></i></a></h4>
<p>新建文件 <code>lua/lsp/cmp.lua</code> ，内容如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">cmp</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;cmp&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">cmp.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="c1">-- 指定 snippet 引擎</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">snippet</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">expand</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">      <span class="c1">-- For `vsnip` users.</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      <span class="n">vim.fn</span><span class="p">[</span><span class="s2">&#34;vsnip#anonymous&#34;</span><span class="p">](</span><span class="n">args.body</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">      <span class="c1">-- For `luasnip` users.</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">      <span class="c1">-- require(&#39;luasnip&#39;).lsp_expand(args.body)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">      <span class="c1">-- For `ultisnips` users.</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">      <span class="c1">-- vim.fn[&#34;UltiSnips#Anon&#34;](args.body)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="c1">-- For `snippy` users.</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">      <span class="c1">-- require&#39;snippy&#39;.expand_snippet(args.body)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="kr">end</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="c1">-- 补全源</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">sources</span> <span class="o">=</span> <span class="n">cmp.config</span><span class="p">.</span><span class="n">sources</span><span class="p">({</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">{</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;nvim_lsp&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="c1">-- For vsnip users.</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">{</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;vsnip&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="c1">-- For luasnip users.</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="c1">-- { name = &#39;luasnip&#39; },</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="c1">--For ultisnips users.</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="c1">-- { name = &#39;ultisnips&#39; },</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="c1">-- -- For snippy users.</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="c1">-- { name = &#39;snippy&#39; },</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="p">},</span> <span class="p">{</span> <span class="p">{</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;buffer&#34;</span> <span class="p">},</span> <span class="p">{</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;path&#34;</span> <span class="p">}</span> <span class="p">}),</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="c1">-- 快捷键设置</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="n">mapping</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;keybindings&#34;</span><span class="p">).</span><span class="n">cmp</span><span class="p">(</span><span class="n">cmp</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="c1">-- / 查找模式使用 buffer 源</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="n">cmp.setup</span><span class="p">.</span><span class="n">cmdline</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="n">mapping</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">.</span><span class="n">preset.cmdline</span><span class="p">(),</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="n">sources</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="p">{</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;buffer&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="c1">-- : 命令行模式中使用 path 和 cmdline 源.</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="n">cmp.setup</span><span class="p">.</span><span class="n">cmdline</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">  <span class="n">mapping</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">.</span><span class="n">preset.cmdline</span><span class="p">(),</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="n">sources</span> <span class="o">=</span> <span class="n">cmp.config</span><span class="p">.</span><span class="n">sources</span><span class="p">({</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="p">{</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;path&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">  <span class="p">},</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="p">{</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;cmdline&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>上述代码中，设置了 3 件事，指定了 snippet 引擎，补全来源，和设置了快捷键。</p>
<p>我这里选择了 <code>vsnip</code> 作为 snippet 引擎，是因为它是 <code>nvim-cmp</code> 同一个作者开发的，应该稳定性会好些，而且貌似很强大可支持 VSCode 相同代码格式。</p>
<p>补全来源最重要的是 <code>nvim_lsp</code>，这个是 Neovim 内置的 LSP 提供的补全内容，如果你使用了 LSP，那么这个补全源就是必须的，然后 <code>vsnip</code> 也是重要的补全来源之一，buffer 和 path 根据需要放在第二组补全源里。</p>
<p>快捷键的设置跟以前一样, 这里调用了 <code>keybindings</code> 的 <code>cmp</code> 方法。</p>
<p>打开 <code>lua/keybindings.lua</code> 在 pluginKeys 变量下边增加 <code>cmp</code> 方法：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- nvim-cmp 自动补全</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">pluginKeys.cmp</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">cmp</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="kr">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">        <span class="c1">-- 出现补全</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="p">[</span><span class="s2">&#34;&lt;A-.&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">(</span><span class="n">cmp.mapping</span><span class="p">.</span><span class="n">complete</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&#34;i&#34;</span><span class="p">,</span> <span class="s2">&#34;c&#34;</span><span class="p">}),</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="c1">-- 取消</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="p">[</span><span class="s2">&#34;&lt;A-,&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="n">i</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">.</span><span class="n">abort</span><span class="p">(),</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="p">}),</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1">-- 上一个</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="p">[</span><span class="s2">&#34;&lt;C-k&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">.</span><span class="n">select_prev_item</span><span class="p">(),</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="c1">-- 下一个</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="p">[</span><span class="s2">&#34;&lt;C-j&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">.</span><span class="n">select_next_item</span><span class="p">(),</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1">-- 确认</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="p">[</span><span class="s2">&#34;&lt;CR&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">.</span><span class="n">confirm</span><span class="p">({</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="n">select</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="n">behavior</span> <span class="o">=</span> <span class="n">cmp.ConfirmBehavior</span><span class="p">.</span><span class="n">Replace</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="p">}),</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1">-- 如果窗口内容太多，可以滚动</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="p">[</span><span class="s2">&#34;&lt;C-u&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">(</span><span class="n">cmp.mapping</span><span class="p">.</span><span class="n">scroll_docs</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="p">{</span><span class="s2">&#34;i&#34;</span><span class="p">,</span> <span class="s2">&#34;c&#34;</span><span class="p">}),</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="p">[</span><span class="s2">&#34;&lt;C-d&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">(</span><span class="n">cmp.mapping</span><span class="p">.</span><span class="n">scroll_docs</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="p">{</span><span class="s2">&#34;i&#34;</span><span class="p">,</span> <span class="s2">&#34;c&#34;</span><span class="p">}),</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div><p>上边代码主要定义了以下快捷键，你可以根据需要修改：</p>
<ul>
<li><code>&lt;A-.&gt;</code> alt + . 出现补全弹窗</li>
<li><code>&lt;A-,&gt;</code> alt + , 取消补全弹窗</li>
<li><code>&lt;C-k&gt;</code> 上一个</li>
<li><code>&lt;C-j&gt;</code> 下一个</li>
<li><code>&lt;CR&gt;</code> 回车确认</li>
<li><code>&lt;C-u&gt;</code> 滚动上</li>
<li><code>&lt;C-d&gt;</code> 滚动下</li>
</ul>
<p>如果窗口内容太多，可以用 <code>Ctrl + u</code> / <code>Ctrl + d </code>滚动，很少见，就不再演示了。</p>
<p>如果常用自定义代码段的话，就有一个需求是在各个预定义的参数位置快速跳转</p>
<p><code>nvim-cmp</code> 官网的 wiki 中有一个例子，使用 <code>Tab</code> 键和 <code>Shift + Tab</code> 键兼容跳转，叫做 <a href="https://github.com/hrsh7th/nvim-cmp/wiki/Example-mappings#super-tab-like-mapping" target="_blank" rel="noopener noreferrer">Super-Tab like mapping</a></p>
<p>我不太喜欢 Tab 键有多种功能，我参考其代码增加了单独的 <code>&lt;C-l&gt;</code> 和 <code>&lt;C-h&gt;</code> 键做跳转。</p>
<p>你如果也需要这样的功能，可以在 <code>lua/keybindings.lua</code> 修改刚才的 cmp 函数，增加如下代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- nvim-cmp 自动补全</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">pluginKeys.cmp</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">cmp</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="kd">local</span> <span class="n">feedkey</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">vim.api</span><span class="p">.</span><span class="n">nvim_feedkeys</span><span class="p">(</span><span class="n">vim.api</span><span class="p">.</span><span class="n">nvim_replace_termcodes</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span> <span class="n">mode</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="kr">end</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="kd">local</span> <span class="n">has_words_before</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="kd">local</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">vim.api</span><span class="p">.</span><span class="n">nvim_win_get_cursor</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="kr">return</span> <span class="n">col</span> <span class="o">~=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">vim.api</span><span class="p">.</span><span class="n">nvim_buf_get_lines</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="kc">true</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span><span class="n">sub</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span><span class="n">match</span><span class="p">(</span><span class="s2">&#34;%s&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="kr">end</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="kr">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">   <span class="p">...</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="c1">-- 自定义代码段跳转到下一个参数</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;C-l&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">      <span class="kr">if</span> <span class="n">vim.fn</span><span class="p">[</span><span class="s2">&#34;vsnip#available&#34;</span><span class="p">](</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">feedkey</span><span class="p">(</span><span class="s2">&#34;&lt;Plug&gt;(vsnip-expand-or-jump)&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">      <span class="kr">end</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="kr">end</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;i&#34;</span><span class="p">,</span> <span class="s2">&#34;s&#34;</span><span class="p">}),</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="c1">-- 自定义代码段跳转到上一个参数</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;C-h&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">      <span class="kr">if</span> <span class="n">vim.fn</span><span class="p">[</span><span class="s2">&#34;vsnip#jumpable&#34;</span><span class="p">](</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="n">feedkey</span><span class="p">(</span><span class="s2">&#34;&lt;Plug&gt;(vsnip-jump-prev)&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">      <span class="kr">end</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="kr">end</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;i&#34;</span><span class="p">,</span> <span class="s2">&#34;s&#34;</span><span class="p">}),</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="c1">-- Super Tab</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;Tab&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">(</span><span class="kr">function</span><span class="p">(</span><span class="n">fallback</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">      <span class="kr">if</span> <span class="n">cmp.visible</span><span class="p">()</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">cmp.select_next_item</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">      <span class="kr">elseif</span> <span class="n">vim.fn</span><span class="p">[</span><span class="s2">&#34;vsnip#available&#34;</span><span class="p">](</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="n">feedkey</span><span class="p">(</span><span class="s2">&#34;&lt;Plug&gt;(vsnip-expand-or-jump)&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">      <span class="kr">elseif</span> <span class="n">has_words_before</span><span class="p">()</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">        <span class="n">cmp.complete</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">      <span class="kr">else</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">fallback</span><span class="p">()</span> <span class="c1">-- The fallback function sends a already mapped key. In this case, it&#39;s probably `&lt;Tab&gt;`.</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">      <span class="kr">end</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="kr">end</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;i&#34;</span><span class="p">,</span> <span class="s2">&#34;s&#34;</span><span class="p">}),</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="p">[</span><span class="s2">&#34;&lt;S-Tab&gt;&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp.mapping</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">      <span class="kr">if</span> <span class="n">cmp.visible</span><span class="p">()</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="n">cmp.select_prev_item</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">      <span class="kr">elseif</span> <span class="n">vim.fn</span><span class="p">[</span><span class="s2">&#34;vsnip#jumpable&#34;</span><span class="p">](</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">        <span class="n">feedkey</span><span class="p">(</span><span class="s2">&#34;&lt;Plug&gt;(vsnip-jump-prev)&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">      <span class="kr">end</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="kr">end</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;i&#34;</span><span class="p">,</span> <span class="s2">&#34;s&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">    <span class="c1">-- end of super Tab</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div><p>最后一步，别忘了在 <strong>入口文件</strong> 中引入 <code>lua/lsp/cmp.lua</code> 才能生效。</p>
<h3 id="lsp-功能增强">LSP 功能增强<a class="anchor ms-1" href="#lsp-功能增强"><i class="fas fa-link"></i></a></h3>
<p>当我们敲击错误的代码的时候，会在左侧显示改行的状态</p>
<img src="index/image-20220725000252573.png" alt="image-20220725000252573" style="zoom:50%;" />
<p>红色那行 <code>E</code> 表示错误，很好理解， 那 <code>W</code> 是什么呢？ 其实 <code>W</code> 是 Warn 的缩写，很不直观，我们把它替换成图标。</p>
<h3 id="左列符号图标">左列符号图标<a class="anchor ms-1" href="#左列符号图标"><i class="fas fa-link"></i></a></h3>
<p>新建文件 <code>lua/lsp/ui.lua</code> ，内容如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">vim.diagnostic</span><span class="p">.</span><span class="n">config</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">virtual_text</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">signs</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="c1">-- 在输入模式下也更新提示，设置为 true 也许会影响性能</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">update_in_insert</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kd">local</span> <span class="n">signs</span> <span class="o">=</span> <span class="p">{</span> <span class="n">Error</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="n">Warn</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="n">Hint</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="n">Info</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kr">for</span> <span class="n">type</span><span class="p">,</span> <span class="n">icon</span> <span class="kr">in</span> <span class="n">pairs</span><span class="p">(</span><span class="n">signs</span><span class="p">)</span> <span class="kr">do</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="kd">local</span> <span class="n">hl</span> <span class="o">=</span> <span class="s2">&#34;DiagnosticSign&#34;</span> <span class="o">..</span> <span class="n">type</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">vim.fn</span><span class="p">.</span><span class="n">sign_define</span><span class="p">(</span><span class="n">hl</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="n">icon</span><span class="p">,</span> <span class="n">texthl</span> <span class="o">=</span> <span class="n">hl</span><span class="p">,</span> <span class="n">numhl</span> <span class="o">=</span> <span class="n">hl</span> <span class="p">})</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div><p>简单解释一下，<code>virtual_text</code> 是右侧显示的文字，<code>signs</code> 就是左侧的图标，让它们都显示出来。</p>
<p>默认的情况下，右侧提示文字只在切换回 normal 模式下才会更新，<code>update_in_insert</code> 可以让输入模式下也更新，但注意这里也许会影响性能。</p>
<p>再下边一大段的 for 循环就是定义图标了。</p>
<p>同时别忘了在 <strong>入口文件</strong> 中引入这个文件，打开 <code>init.lua</code>，加入：<code>require(&quot;lsp.ui&quot;)</code></p>
<p>当一行代码很长的时候，右侧的提示文字就会显示不全，看不到提示的是什么，这个时候怎么办？ 我们之前在 <code>keybindings.lua</code> 的 mapLSP 函数定义过这么几个快捷键。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"> <span class="c1">-- diagnostic</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gp&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.diagnostic.open_float()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gk&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.diagnostic.goto_prev()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gj&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.diagnostic.goto_next()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="自动补全样式修改">自动补全样式修改<a class="anchor ms-1" href="#自动补全样式修改"><i class="fas fa-link"></i></a></h3>
<p>默认情况下，当我们敲入字母的时候，会弹出补全弹窗，左侧列出备选内容，右侧列出备选的变量类型.</p>
<p>还可以在补全弹窗里添加更多的内容显示，比如一个比较常见的改进，当我们配置了很多不同补全来源的时候，我们可以右侧增加一列显示补全源来自哪里。</p>
<p>新增一个插件：<a href="https://github.com/onsails/lspkind.nvim" target="_blank" rel="noopener noreferrer">lspkind-nvim</a>,这个插件封装了很多常见的小图标，非常方便，不用我们手动再创建了。</p>
<p><code>lua/lsp/ui.lua</code>，在下边增加代码如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- lspkind</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">local</span> <span class="n">lspkind</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;lspkind&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">lspkind.init</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="c1">-- default: true</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="c1">-- with_text = true,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="c1">-- defines how annotations are shown</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="c1">-- default: symbol</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="c1">-- options: &#39;text&#39;, &#39;text_symbol&#39;, &#39;symbol_text&#39;, &#39;symbol&#39;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;symbol_text&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1">-- default symbol map</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="c1">-- can be either &#39;default&#39; (requires nerd-fonts font) or</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="c1">-- &#39;codicons&#39; for codicon preset (requires vscode-codicons font)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="c1">--</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="c1">-- default: &#39;default&#39;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">preset</span> <span class="o">=</span> <span class="s1">&#39;codicons&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="c1">-- override preset symbols</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="c1">--</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="c1">-- default: {}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="n">symbol_map</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">      <span class="n">Text</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">      <span class="n">Method</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">      <span class="n">Function</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">      <span class="n">Constructor</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">      <span class="n">Field</span> <span class="o">=</span> <span class="s2">&#34;ﰠ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">      <span class="n">Variable</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">      <span class="n">Class</span> <span class="o">=</span> <span class="s2">&#34;ﴯ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">      <span class="n">Interface</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">      <span class="n">Module</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">      <span class="n">Property</span> <span class="o">=</span> <span class="s2">&#34;ﰠ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">      <span class="n">Unit</span> <span class="o">=</span> <span class="s2">&#34;塞&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">      <span class="n">Value</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">      <span class="n">Enum</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">      <span class="n">Keyword</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">      <span class="n">Snippet</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">      <span class="n">Color</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">      <span class="n">File</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">      <span class="n">Reference</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">      <span class="n">Folder</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">      <span class="n">EnumMember</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">      <span class="n">Constant</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">      <span class="n">Struct</span> <span class="o">=</span> <span class="s2">&#34;פּ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">      <span class="n">Event</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">      <span class="n">Operator</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">      <span class="n">TypeParameter</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="kd">local</span> <span class="n">M</span> <span class="o">=</span><span class="p">{}</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="c1">-- 为 cmp.lua 提供参数格式</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="n">M.formatting</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">    <span class="n">format</span> <span class="o">=</span> <span class="n">lspkind.cmp_format</span><span class="p">({</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">      <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;symbol_text&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">      <span class="c1">--mode = &#39;symbol&#39;, -- show only symbol annotations</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">
</span></span><span class="line"><span class="ln">55</span><span class="cl">      <span class="n">maxwidth</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="c1">-- prevent the popup from showing more than provided characters (e.g 50 will not show more than 50 characters)</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">      <span class="c1">-- The function below will be called before any actual modifications from lspkind</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">      <span class="c1">-- so that you can provide more controls on popup customization. (See [#30](https://github.com/onsails/lspkind-nvim/pull/30))</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">      <span class="n">before</span> <span class="o">=</span> <span class="kr">function</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">vim_item</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">        <span class="c1">-- Source 显示提示来源</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">        <span class="n">vim_item.menu</span> <span class="o">=</span> <span class="s2">&#34;[&#34;</span> <span class="o">..</span> <span class="n">string.upper</span><span class="p">(</span><span class="n">entry.source</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&#34;]&#34;</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">        <span class="kr">return</span> <span class="n">vim_item</span>
</span></span><span class="line"><span class="ln">62</span><span class="cl">      <span class="kr">end</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">
</span></span><span class="line"><span class="ln">66</span><span class="cl"><span class="kr">return</span> <span class="n">M</span>
</span></span></code></pre></div><p>简单解释一下上述代码，首先引入刚刚安装的 <code>lspkind</code> 插件，调用 <code>lspkind.init</code> 方法初始化。</p>
<p>初始化参数中的 <code>symbol_map</code> 就是变量类型和其对应的自定义图标，由于图标是 Nerdfont 的，所以只在命令行中可见。</p>
<p>接下来我们导出一个 <code>M</code>，这在 lua 中是很常见的写法。 导出后在其他文件中就可以 <code>require('lsp.ui').formatting</code> 取到该值了。</p>
<p>接着我们回到 <code>lua/lsp/cmp.lua</code> 文件中，在 <code>cmp.setup()</code> 的初始化参数中添加一个 <code>formatting</code> 值，如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">cmp.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">-- 指定 snippet 引擎</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">snippet</span> <span class="o">=</span> <span class="p">{...},</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="c1">-- 来源</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="n">sources</span> <span class="o">=</span> <span class="n">cmp.config</span><span class="p">.</span><span class="n">sources</span><span class="p">({</span> <span class="p">...</span> <span class="p">}),</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="c1">-- 快捷键</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">mapping</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;keybindings&#34;</span><span class="p">).</span><span class="n">cmp</span><span class="p">(</span><span class="n">cmp</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">-- 使用lspkind-nvim显示类型图标 (新增)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">formatting</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;lsp.ui&#39;</span><span class="p">).</span><span class="n">formatting</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">...</span>
</span></span></code></pre></div><h3 id="配置-indent_blanklinenvim-插件">配置 indent_blankline.nvim 插件<a class="anchor ms-1" href="#配置-indent_blanklinenvim-插件"><i class="fas fa-link"></i></a></h3>
<p><a href="https://github.com/lukas-reineke/indent-blankline.nvim" target="_blank" rel="noopener noreferrer">它</a>会随着光标的移动提醒我们在哪个上下文中。如果你需要他的话，打开 <code>plugins.lua</code>，增加插件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">-- indent-blankline</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="n">use</span><span class="p">(</span><span class="s2">&#34;lukas-reineke/indent-blankline.nvim&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>安装后新建配置文件：<code>lua/plugin-config/indent-blankline.lua</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">ident_blankline</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;indent_blankline&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 indent_blankline&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="kr">return</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">ident_blankline.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">-- 空行占位</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">space_char_blankline</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="c1">-- 用 treesitter 判断上下文</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">show_current_context</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">show_current_context_start</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">context_patterns</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="s2">&#34;class&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="s2">&#34;function&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="s2">&#34;method&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="s2">&#34;element&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="s2">&#34;^if&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="s2">&#34;^while&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="s2">&#34;^for&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="s2">&#34;^object&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="s2">&#34;^table&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="s2">&#34;block&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="s2">&#34;arguments&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="c1">-- :echo &amp;filetype</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="n">filetype_exclude</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="s2">&#34;dashboard&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="s2">&#34;packer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="s2">&#34;terminal&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="s2">&#34;help&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="s2">&#34;log&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="s2">&#34;markdown&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="s2">&#34;TelescopePrompt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="s2">&#34;lsp-installer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="s2">&#34;lspinfo&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="s2">&#34;toggleterm&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="c1">-- 竖线样式</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="c1">-- char = &#39;¦&#39;</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="c1">-- char = &#39;┆&#39;</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="c1">-- char = &#39;│&#39;</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="c1">-- char = &#34;⎸&#34;,</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="n">char</span> <span class="o">=</span> <span class="s2">&#34;▏&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>这里需要注意的是该插件会在任何界面都添加这种竖线，但是在我们之前的首页 dashboard 中就不该加入这种竖线。这个时候我们就要在 <code>filetype_exclude</code> 中排除 &ldquo;dashboard&rdquo; 这个界面。上边代码中我已经排除了好多界面，但如果你还在哪个不该出现竖线的窗口中看到了竖线，要怎么办呢？</p>
<p>方法为： 当光标在该界面内时输入 <code>:echo &amp;filetype</code> 回车，这时下边状态栏会输出该文件的类型，把他加入到上边的 <code>filetype_exclude</code> 变量中排除就好了。</p>
<p>对了，要生效可别忘了在 <strong>入口文件</strong> 中引入：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">require</span><span class="p">(</span><span class="s2">&#34;plugin-config.indent-blankline&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>重启后生效。</p>
<h3 id="配置-lspsaganvim">配置 lspsaga.nvim<a class="anchor ms-1" href="#配置-lspsaganvim"><i class="fas fa-link"></i></a></h3>
<p>安装<a href="https://github.com/kkharji/lspsaga.nvim" target="_blank" rel="noopener noreferrer">lspsage</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">use</span><span class="p">(</span><span class="s2">&#34;tami5/lspsaga.nvim&#34;</span> <span class="p">)</span> <span class="c1">-- 新增</span>
</span></span></code></pre></div><p>打开 <code>lua/lsp/ui.lua</code> ，在 <code>lspkind</code> 配置后边加入代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">lspsaga</span> <span class="o">=</span> <span class="n">require</span> <span class="s1">&#39;lspsaga&#39;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">lspsaga.setup</span> <span class="p">{</span> <span class="c1">-- defaults ...</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">debug</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">use_saga_diagnostic_sign</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="c1">-- diagnostic sign</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="n">error_sign</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">warn_sign</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">hint_sign</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">infor_sign</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">diagnostic_header_icon</span> <span class="o">=</span> <span class="s2">&#34;   &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="c1">-- code action title icon</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">code_action_icon</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">code_action_prompt</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">enable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">sign</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">sign_priority</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">virtual_text</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">finder_definition_icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">finder_reference_icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">max_preview_lines</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="n">finder_action_keys</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="c1">-- open = &#34;o&#34;,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="n">open</span> <span class="o">=</span> <span class="s2">&#34;&lt;CR&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="n">vsplit</span> <span class="o">=</span> <span class="s2">&#34;s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="n">split</span> <span class="o">=</span> <span class="s2">&#34;i&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="c1">-- quit = &#34;q&#34;,</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="n">quit</span> <span class="o">=</span> <span class="s2">&#34;&lt;ESC&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="n">scroll_down</span> <span class="o">=</span> <span class="s2">&#34;&lt;C-f&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="n">scroll_up</span> <span class="o">=</span> <span class="s2">&#34;&lt;C-b&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="n">code_action_keys</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="c1">-- quit = &#34;q&#34;,</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="n">quit</span> <span class="o">=</span> <span class="s2">&#34;&lt;ESC&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="n">exec</span> <span class="o">=</span> <span class="s2">&#34;&lt;CR&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="n">rename_action_keys</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="c1">-- quit = &#34;&lt;C-c&gt;&#34;,</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="n">quit</span> <span class="o">=</span> <span class="s2">&#34;&lt;ESC&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="n">exec</span> <span class="o">=</span> <span class="s2">&#34;&lt;CR&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="n">definition_preview_icon</span> <span class="o">=</span> <span class="s2">&#34;  &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="n">border_style</span> <span class="o">=</span> <span class="s2">&#34;single&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="n">rename_prompt_prefix</span> <span class="o">=</span> <span class="s2">&#34;➤&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="n">rename_output_qflist</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">    <span class="n">enable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="n">auto_open_qflist</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="n">server_filetype_map</span> <span class="o">=</span> <span class="p">{},</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">  <span class="n">diagnostic_prefix_format</span> <span class="o">=</span> <span class="s2">&#34;%d. &#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="n">diagnostic_message_format</span> <span class="o">=</span> <span class="s2">&#34;%m %c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">  <span class="n">highlight_prefix</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这里基本上都是默认配置，我只修改了几个快捷键，注释的部分是原快捷键。</p>
<p>lspsaga 厉害之处是，安装后会有一系列新命令来替换原有功能，比如我们在之前看见过这个 rename 的操作。</p>
<p>你需要做的就是找到之前定义的快捷键，根据需要将原本的功能替换为 Lspsaga 提供的新命令。</p>
<p>这是我目前的设置，请参考，找到 <code>lua/keybindings.lua</code> 将之前的 mapLSP 函数替换为：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">-- lsp 回调函数快捷键设置</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">pluginKeys.mapLSP</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">mapbuf</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">-- rename</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="cm">--[[
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm">  Lspsaga 替换 rn
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm">  mapbuf(&#34;n&#34;, &#34;&lt;leader&gt;rn&#34;, &#34;&lt;cmd&gt;lua vim.lsp.buf.rename()&lt;CR&gt;&#34;, opt)
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm">  --]]</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;rn&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;Lspsaga rename&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">-- code action</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="cm">--[[
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">  Lspsaga 替换 ca
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">  mapbuf(&#34;n&#34;, &#34;&lt;leader&gt;ca&#34;, &#34;&lt;cmd&gt;lua vim.lsp.buf.code_action()&lt;CR&gt;&#34;, opt)
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="cm">  --]]</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;ca&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;Lspsaga code_action&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="c1">-- go xx</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="cm">--[[
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="cm">    mapbuf(&#39;n&#39;, &#39;gd&#39;, &#39;&lt;cmd&gt;Lspsaga preview_definition&lt;CR&gt;&#39;, opt)
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="cm">  --]]</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gd&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.lsp.buf.definition()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="cm">--[[
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="cm">  Lspsaga 替换 gh
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="cm">  mapbuf(&#34;n&#34;, &#34;gh&#34;, &#34;&lt;cmd&gt;lua vim.lsp.buf.hover()&lt;CR&gt;&#34;, opt)
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="cm">  --]]</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gh&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;Lspsaga hover_doc&lt;cr&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="cm">--[[
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="cm">  Lspsaga 替换 gr
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="cm">  mapbuf(&#34;n&#34;, &#34;gr&#34;, &#34;&lt;cmd&gt;lua vim.lsp.buf.references()&lt;CR&gt;&#34;, opt)
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="cm">  --]]</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gr&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;Lspsaga lsp_finder&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="cm">--[[
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="cm">  Lspsaga 替换 gp, gj, gk
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="cm">  mapbuf(&#34;n&#34;, &#34;gp&#34;, &#34;&lt;cmd&gt;lua vim.diagnostic.open_float()&lt;CR&gt;&#34;, opt)
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="cm">  mapbuf(&#34;n&#34;, &#34;gj&#34;, &#34;&lt;cmd&gt;lua vim.diagnostic.goto_next()&lt;CR&gt;&#34;, opt)
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="cm">  mapbuf(&#34;n&#34;, &#34;gk&#34;, &#34;&lt;cmd&gt;lua vim.diagnostic.goto_prev()&lt;CR&gt;&#34;, opt)
</span></span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="cm">  --]]</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="c1">-- diagnostic</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gp&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;Lspsaga show_line_diagnostics&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gj&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;Lspsaga diagnostic_jump_next&lt;cr&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;gk&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;Lspsaga diagnostic_jump_prev&lt;cr&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="n">mapbuf</span><span class="p">(</span><span class="s2">&#34;n&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;leader&gt;f&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;cmd&gt;lua vim.lsp.buf.formatting()&lt;CR&gt;&#34;</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="c1">-- 未用</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="c1">-- mapbuf(&#34;n&#34;, &#34;gD&#34;, &#34;&lt;cmd&gt;lua vim.lsp.buf.declaration()&lt;CR&gt;&#34;, opt)</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="c1">-- mapbuf(&#34;n&#34;, &#34;gi&#34;, &#34;&lt;cmd&gt;lua vim.lsp.buf.implementation()&lt;CR&gt;&#34;, opt)</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">  <span class="c1">-- mapbuf(&#39;n&#39;, &#39;&lt;leader&gt;q&#39;, &#39;&lt;cmd&gt;lua vim.diagnostic.setloclist()&lt;CR&gt;&#39;, opt)</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">  <span class="c1">-- mapbuf(&#34;n&#34;, &#34;&lt;C-k&gt;&#34;, &#34;&lt;cmd&gt;lua vim.lsp.buf.signature_help()&lt;CR&gt;&#34;, opt)</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="c1">-- mapbuf(&#39;n&#39;, &#39;&lt;space&gt;wa&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.add_workspace_folder()&lt;CR&gt;&#39;, opt)</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="c1">-- mapbuf(&#39;n&#39;, &#39;&lt;space&gt;wr&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.remove_workspace_folder()&lt;CR&gt;&#39;, opt)</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="c1">-- mapbuf(&#39;n&#39;, &#39;&lt;space&gt;wl&#39;, &#39;&lt;cmd&gt;lua print(vim.inspect(vim.lsp.buf.list_workspace_folders()))&lt;CR&gt;&#39;, opt)</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="c1">-- mapbuf(&#39;n&#39;, &#39;&lt;space&gt;D&#39;, &#39;&lt;cmd&gt;lua vim.lsp.buf.type_definition()&lt;CR&gt;&#39;, opt)</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div><h3 id="代码格式化">代码格式化<a class="anchor ms-1" href="#代码格式化"><i class="fas fa-link"></i></a></h3>
<p>null-ls 非常强大，可以作为一个通用 Language Server 来给编辑器注入代码补全，格式化，提示，code actions 等新功能。</p>
<p>简单来说就是你在编辑的同一个 buffer 时，不只可以挂一个 Language Server，还可以多挂一个通用的 null-ls Server 作为补充，这样无论我们使用哪个 Server 都可以共享 null-ls 提供的功能。</p>
<p>null-ls 不仅可以做为代码格式化的工具，他更像一个 Lua 语言与 Language Server 的桥梁，它可以通过注入的方式给编辑器带来更多有趣的功能。</p>
<p>我们先来安装，打开<code>lua/plugins.lua</code> 文件，增加代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln">1</span><span class="cl"> <span class="n">use</span><span class="p">({</span> <span class="s2">&#34;jose-elias-alvarez/null-ls.nvim&#34;</span><span class="p">,</span> <span class="n">requires</span> <span class="o">=</span> <span class="s2">&#34;nvim-lua/plenary.nvim&#34;</span> <span class="p">})</span>
</span></span></code></pre></div><h4 id="配置-null-lsnvim">配置 null-ls.nvim<a class="anchor ms-1" href="#配置-null-lsnvim"><i class="fas fa-link"></i></a></h4>
<p>继续添加配置文件 <code>lua/lsp/null-ls.lua</code>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">local</span> <span class="n">status</span><span class="p">,</span> <span class="n">null_ls</span> <span class="o">=</span> <span class="n">pcall</span><span class="p">(</span><span class="n">require</span><span class="p">,</span> <span class="s2">&#34;null-ls&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kr">if</span> <span class="ow">not</span> <span class="n">status</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">vim.notify</span><span class="p">(</span><span class="s2">&#34;没有找到 null-ls&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="kr">return</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kd">local</span> <span class="n">formatting</span> <span class="o">=</span> <span class="n">null_ls.builtins</span><span class="p">.</span><span class="n">formatting</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">null_ls.setup</span><span class="p">({</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">debug</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">sources</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="c1">-- Formatting ---------------------</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="c1">--  brew install shfmt</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">formatting.shfmt</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="c1">-- StyLua</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">formatting.stylua</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="c1">-- frontend</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">formatting.prettier</span><span class="p">.</span><span class="n">with</span><span class="p">({</span> <span class="c1">-- 只比默认配置少了 markdown</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">      <span class="n">filetypes</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="s2">&#34;javascript&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="s2">&#34;javascriptreact&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="s2">&#34;typescript&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="s2">&#34;typescriptreact&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="s2">&#34;vue&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="s2">&#34;css&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="s2">&#34;scss&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="s2">&#34;less&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="s2">&#34;html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="s2">&#34;json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="s2">&#34;yaml&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="s2">&#34;graphql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">      <span class="n">prefer_local</span> <span class="o">=</span> <span class="s2">&#34;node_modules/.bin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="c1">-- formatting.fixjson,</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="c1">-- formatting.black.with({ extra_args = { &#34;--fast&#34; } }),</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="c1">-- 保存自动格式化</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="n">on_attach</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="kr">if</span> <span class="n">client.resolved_capabilities</span><span class="p">.</span><span class="n">document_formatting</span> <span class="kr">then</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">      <span class="n">vim.cmd</span><span class="p">(</span><span class="s2">&#34;autocmd BufWritePre &lt;buffer&gt; lua vim.lsp.buf.formatting_sync()&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">  <span class="kr">end</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>简单解释一下代码，首先查找 null-ls 插件是否存在，如果不存在则提示并 return，不再继续执行。 然后注意看下边的 <code>null_ls.setup</code> 配置中一大串代码只是在配置一个参数 <code>sources</code>， null-ls 有很多内置源，需要哪个就把哪个列在这里就好了。本节只配置了几个常见的 Formatting 源。null-ls 不只内置有 Formatting 源，还有其他共功能的源可配置，也许后续章节会涉及，本节我们专注在代码格式化功能上。</p>
<p>null-ls 支持的 Formatting 源非常非常的多，你可以在其 GitHub 目录中查看：https://github.com/jose-elias-alvarez/null-ls.nvim/tree/main/lua/null-ls/builtins/formatting.上述目录中所有的源，在配置文件中都在 <code>null_ls.builtins.formatting</code> 命名空间下，需要哪个列上去就好了。</p>
<p>最后别忘了在 <strong>入口文件</strong> 中引入该文件，同时注释掉 formatter 插件。</p>
<p>当你重启并成功安装 null-ls.nvim 后，可以运行命令 <code>:LspInfo</code> 查看绑定的 Language Server 信息。null-ls 作为通用 LSP，可以在任何 filetypes 中运行。</p>
<p>我们可以运行 <code>:NullLsInfo</code> 查看源的激活情况</p></div></div>
  <div class="card-footer"><div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev">
    <i class="fas fa-fw fa-chevron-circle-down post-prev-icon" data-fa-transform="rotate-90"></i>
    <a href="/posts/e84c3531/">Vimtutor翻译
</a>
  </div><div class="post-nav post-next">
    <a href="/posts/0f0b28a1/">Oh My Zsh进入git目录卡顿
</a>
    <i class="fas fa-fw fa-chevron-circle-down post-next-icon" data-fa-transform="rotate-270"></i>
  </div></div></div>
</article><div class="post-copyright mb-3 row card component" id="post-copyright">
    <div class="card-header">
        <h2 class="card-title">版权</h2>
    </div>
    <div class="card-body"><a class="d-flex align-items-center flex-column" target="_blank" rel="license noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">
  <span><i class="fab fa-fw fa-2x fa-creative-commons"></i><i class="fab fa-fw fa-2x fa-creative-commons-by"></i><i class="fab fa-fw fa-2x fa-creative-commons-nc"></i><i class="fab fa-fw fa-2x fa-creative-commons-nd"></i></span>
  CC BY-NC-ND 4.0 
</a>


    </div>
</div><section class="related-posts row card component">
    <div class="card-header">
      <h2 class="card-title">相关文章</h2>
    </div>
    <div class="card-body">
      <ul class="post-list"><li>
          <a href="/posts/e84c3531/">Vimtutor翻译
</a>
          <span class="float-end post-date">2022-07-09
</span>
        </li><li>
          <a href="/posts/3aafaaaf/">将博客迁移到七牛云
</a>
          <span class="float-end post-date">2022-06-28
</span>
        </li><li>
          <a href="/posts/bf108eb3/">解决win端口没被占用提示access Permissions
</a>
          <span class="float-end post-date">2022-04-12
</span>
        </li><li>
          <a href="/posts/173a3c06/">服务器环境的配置
</a>
          <span class="float-end post-date">2022-04-11
</span>
        </li><li>
          <a href="/posts/642ecc47/">从hexo迁移到Hugo
</a>
          <span class="float-end post-date">2022-04-11
</span>
        </li></ul>
    </div>
  </section></div>
</div><aside class="col-lg-4 sidebar d-flex">
  <div class="container d-flex flex-column">
    
    <div class="card row text-center profile component">
  <div class="card-body">
    <div class="col-12 d-flex align-items-center justify-content-center"><picture><img class="profile-avatar rounded-circle" alt="jimyag" src="/images/spider-man.jpg" loading="lazy" data-viewer-invisible
     width="556" height="559"
     />
</picture>
</div>
    <div class="col-12 profile-meta"><div class="profile-name">jimyag</div><div class="profile-bio">Gopher</div><div class="profile-location"><i class="fas fa-fw fa-map-marker-alt"></i>Shanghai</div><div class="profile-about"><i class="fas fa-fw fa-user"></i><a href="/about/">About</a></div><nav class="social-links nav justify-content-center"><a class="nav-link social-link" href="mailto:i@jimyag.cn" title="Email">
      <i class="fas fa-fw fa-2x fa-envelope"></i>
    </a><a class="nav-link social-link" target="_blank" href="https://github.com/jimyag" title="GitHub" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-github"></i>
      </a><a class="nav-link social-link" target="_blank" href="/index.xml" title="RSS" rel="noopener noreferrer">
    <i class="fas fa-fw fa-2x fa-rss"></i>
  </a></nav>
</div>
  </div>
</div>
<div class="post-toc row mb-4 card component" id="postTOC">
  <div class="card-header">
    <h2 class="card-title">目录</h2>
  </div>
  <div class="card-body">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#安装-neovim">安装 Neovim</a>
      <ul>
        <li><a href="#mac">Mac</a></li>
      </ul>
    </li>
    <li><a href="#安装依赖的字体">安装依赖的字体</a>
      <ul>
        <li><a href="#mac-1">Mac</a></li>
      </ul>
    </li>
    <li><a href="#配置目录">配置目录</a></li>
    <li><a href="#配置入口文件">配置入口文件</a></li>
    <li><a href="#基础配置文件">基础配置文件</a>
      <ul>
        <li><a href="#作用域">作用域</a></li>
        <li><a href="#配置如下">配置如下</a></li>
      </ul>
    </li>
    <li><a href="#快捷键配置">快捷键配置</a>
      <ul>
        <li><a href="#分屏操作">分屏操作</a></li>
        <li><a href="#快捷键设置方法">快捷键设置方法</a></li>
      </ul>
    </li>
    <li><a href="#插件管理">插件管理</a>
      <ul>
        <li><a href="#安装">安装</a></li>
      </ul>
    </li>
    <li><a href="#主题">主题</a>
      <ul>
        <li><a href="#安装第三方插件">安装第三方插件</a></li>
      </ul>
    </li>
    <li><a href="#侧边栏管理">侧边栏管理</a>
      <ul>
        <li><a href="#配置">配置</a></li>
      </ul>
    </li>
    <li><a href="#标签页和底部信息栏">标签页和底部信息栏</a>
      <ul>
        <li><a href="#标签页">标签页</a></li>
        <li><a href="#底部信息栏">底部信息栏</a></li>
      </ul>
    </li>
    <li><a href="#搜索插件">搜索插件</a>
      <ul>
        <li><a href="#安装-1"><strong>安装</strong></a></li>
        <li><a href="#快捷键配置-1">快捷键配置</a></li>
        <li><a href="#配置-telescope-插件">配置 telescope 插件</a></li>
      </ul>
    </li>
    <li><a href="#启动页面">启动页面</a>
      <ul>
        <li><a href="#安装-2">安装</a></li>
      </ul>
    </li>
    <li><a href="#语法高亮">语法高亮</a>
      <ul>
        <li><a href="#安装-3">安装</a></li>
        <li><a href="#安装language-parser">安装Language parser</a></li>
        <li><a href="#配置-nvim-treesitter">配置 nvim-treesitter</a></li>
        <li><a href="#lsp-配置">LSP 配置</a></li>
        <li><a href="#lsp-补全">LSP 补全</a></li>
        <li><a href="#lsp-功能增强">LSP 功能增强</a></li>
        <li><a href="#左列符号图标">左列符号图标</a></li>
        <li><a href="#自动补全样式修改">自动补全样式修改</a></li>
        <li><a href="#配置-indent_blanklinenvim-插件">配置 indent_blankline.nvim 插件</a></li>
        <li><a href="#配置-lspsaganvim">配置 lspsaga.nvim</a></li>
        <li><a href="#代码格式化">代码格式化</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div><section class="recent-posts row card component">
  <div class="card-header">
    <h2 class="card-title">最近文章</h2>
  </div>
  <div class="card-body">
    <ul class="post-list"><li>
        <a href="/posts/6db6b747/">Google MapReduce翻译
</a>
      </li><li>
        <a href="/posts/f6adfb46/">6.824 Spring 2020 Lab1 MapReduce文档翻译
</a>
      </li><li>
        <a href="/posts/14976c16/">我的notion规划
</a>
      </li><li>
        <a href="/posts/9c78a390/">Git开发分支落后远程主分支
</a>
      </li><li>
        <a href="/posts/0f0b28a1/">Oh My Zsh进入git目录卡顿
</a>
      </li></ul>
  </div>
</section><section class="series-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/series">专栏</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/series/leetcode/" class="badge rounded post-taxonomy" title="leetcode">
            leetcode<span class="badge badge-sm text-white bg-accent ms-1">32</span></a><a href="/series/%E4%BB%8E0%E5%88%B01%E5%AE%9E%E7%8E%B0%E5%AE%8C%E6%95%B4%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6/" class="badge rounded post-taxonomy" title="从0到1实现完整的微服务框架">
            从0到1实现完整的微服务框架<span class="badge badge-sm text-white bg-accent ms-1">12</span></a><a href="/series/%E7%89%9B%E5%AE%A2top101/" class="badge rounded post-taxonomy" title="牛客TOP101">
            牛客TOP101<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/series/mit6.824/" class="badge rounded post-taxonomy" title="MIT6.824">
            MIT6.824<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/series/vim/" class="badge rounded post-taxonomy" title="vim">
            vim<span class="badge badge-sm text-white bg-accent ms-1">2</span></a></div>
      </div>
    </section><section class="categories-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/categories">分类</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/categories/leetcode/" class="badge rounded post-taxonomy" title="LeetCode">
            LeetCode<span class="badge badge-sm text-white bg-accent ms-1">32</span></a><a href="/categories/%E6%95%99%E7%A8%8B/" class="badge rounded post-taxonomy" title="教程">
            教程<span class="badge badge-sm text-white bg-accent ms-1">9</span></a><a href="/categories/go/" class="badge rounded post-taxonomy" title="Go">
            Go<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/categories/%E7%AE%97%E6%B3%95/" class="badge rounded post-taxonomy" title="算法">
            算法<span class="badge badge-sm text-white bg-accent ms-1">4</span></a><a href="/categories/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" class="badge rounded post-taxonomy" title="编译原理">
            编译原理<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/categories/%E8%B8%A9%E5%9D%91/" class="badge rounded post-taxonomy" title="踩坑">
            踩坑<span class="badge badge-sm text-white bg-accent ms-1">3</span></a><a href="/categories/hexo/" class="badge rounded post-taxonomy" title="Hexo">
            Hexo<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/categories/nvim/" class="badge rounded post-taxonomy" title="nvim">
            nvim<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/categories/vim/" class="badge rounded post-taxonomy" title="vim">
            vim<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/categories/web/" class="badge rounded post-taxonomy" title="Web">
            Web<span class="badge badge-sm text-white bg-accent ms-1">2</span></a><a href="/categories" class="badge rounded post-taxonomy" title='全部'>
          全部
          <span class="badge badge-sm text-white bg-accent ms-1">22</span>
        </a></div>
      </div>
    </section><section class="tags-taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tags">标签</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tags/%E6%95%99%E7%A8%8B/" class="badge rounded post-taxonomy" title="教程">
            教程<span class="badge badge-sm text-white bg-accent ms-1">30</span></a><a href="/tags/%E4%B8%AD%E7%AD%89/" class="badge rounded post-taxonomy" title="中等">
            中等<span class="badge badge-sm text-white bg-accent ms-1">14</span></a><a href="/tags/%E7%AE%80%E5%8D%95/" class="badge rounded post-taxonomy" title="简单">
            简单<span class="badge badge-sm text-white bg-accent ms-1">13</span></a><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="badge rounded post-taxonomy" title="微服务">
            微服务<span class="badge badge-sm text-white bg-accent ms-1">12</span></a><a href="/tags/grpc/" class="badge rounded post-taxonomy" title="gRPC">
            gRPC<span class="badge badge-sm text-white bg-accent ms-1">10</span></a><a href="/tags/go/" class="badge rounded post-taxonomy" title="Go">
            Go<span class="badge badge-sm text-white bg-accent ms-1">9</span></a><a href="/tags/%E6%A8%A1%E6%8B%9F/" class="badge rounded post-taxonomy" title="模拟">
            模拟<span class="badge badge-sm text-white bg-accent ms-1">7</span></a><a href="/tags/%E5%A4%8D%E4%B9%A0%E8%B5%84%E6%96%99/" class="badge rounded post-taxonomy" title="复习资料">
            复习资料<span class="badge badge-sm text-white bg-accent ms-1">6</span></a><a href="/tags/%E5%9B%B0%E9%9A%BE/" class="badge rounded post-taxonomy" title="困难">
            困难<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags/%E7%AE%97%E6%B3%95/" class="badge rounded post-taxonomy" title="算法">
            算法<span class="badge badge-sm text-white bg-accent ms-1">5</span></a><a href="/tags" class="badge rounded post-taxonomy" title='全部'>
          全部
          <span class="badge badge-sm text-white bg-accent ms-1">81</span>
        </a></div>
      </div>
    </section>
    
  </div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav justify-content-center mb-2"><a class="nav-link social-link" href="mailto:i@jimyag.cn" title="Email">
      <i class="fas fa-fw fa-2x fa-envelope"></i>
    </a><a class="nav-link social-link" target="_blank" href="https://github.com/jimyag" title="GitHub" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-github"></i>
      </a><a class="nav-link social-link" target="_blank" href="/index.xml" title="RSS" rel="noopener noreferrer">
    <i class="fas fa-fw fa-2x fa-rss"></i>
  </a></nav>
<div class="copyright mb-2">
  Copyright © 2019-2022 jimyag. All Rights Reserved. 陕ICP备2020018182号-1
</div>

<a href="https://www.netlify.com" target="_blank" rel="noopener noreferrer">
    <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify" width="114" height="51" />
</a>
</footer>
<script src="/assets/main/bundle.min.959233aeeaa1098ccb8a2bcab29196af60d6df3a52be4d3ba05da4d949213e27.js" integrity="sha256-lZIzruqhCYzLiivKspGWr2DW3zpSvk07oF2k2UkhPic=" crossorigin="anonymous" defer></script><script src="/assets/icons/bundle.min.dfcbe757302616d36e2f117823c56facf382204bf3ab9ea29dffd5f2fc56bdef.js" integrity="sha256-38vnVzAmFtNuLxF4I8VvrPOCIEvzq56inf/V8vxWve8=" crossorigin="anonymous" defer></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('\/service-worker.min.js').then(function(reg) {
      console.log('Successfully registered service worker', reg);
    }).catch(function(err) {
      console.warn('Error whilst registering service worker', err);
    });
  });
}
</script><script src="/assets/viewer/bundle.min.0ec873e11f754ed0ad81a68dca8496e24286666354e9c7c11ff339c390f086f0.js" integrity="sha256-Dshz4R91TtCtgaaNyoSW4kKGZmNU6cfBH/M5w5DwhvA=" crossorigin="anonymous" defer></script><script defer src="/assets/mermaid/bundle.min.e0678d67a61d9ab297dc3f1de9ca8e43614ce49e9e0d310b80787e532fca37a1.js" integrity="sha256-4GeNZ6YdmrKX3D8d6cqOQ2FM5J6eDTELgHh&#43;Uy/KN6E=" crossorigin="anonymous"></script>

</body>
</html>
